# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lsyncd
pkgver=2.1.5
pkgrel=0
pkgdesc="Live Syncing (Mirror) Daemon"
url="http://code.google.com/p/lsyncd/"
arch="all"
license="GPLv2+"
depends="rsync"
depends_dev=
makedepends="$depends_dev lua lua-dev"
install=""
subpackages="$pkgname-doc"
source="http://lsyncd.googlecode.com/files/lsyncd-$pkgver.tar.gz
	fix-realpath.patch
	lpostcmd.patch
	$pkgname.initd"

_builddir="$srcdir"/lsyncd-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	mkdir -p "$pkgdir/etc/lsyncd"
	cp "$_builddir"/examples/*.lua \
		"$pkgdir"/etc/lsyncd/
	install -Dm755 "$srcdir/$pkgname.initd" \
		"$pkgdir/etc/init.d/$pkgname" || return 1
	
}

md5sums="fb10547494ec5ec662fe88343047c364  lsyncd-2.1.5.tar.gz
a14565df7274ebd0b605301ca39ae885  fix-realpath.patch
5e0456755ffef5b3b0ebed597ad50d09  lpostcmd.patch
ad321a708d6565096d40c9715c8e5693  lsyncd.initd"
sha256sums="4a793056c4ed833edb59436d7711bb65f7e38a4d8d44371cc9dc5eb91fbc461f  lsyncd-2.1.5.tar.gz
26454c77bb005c165c10b05b232c587669d35ab98e0ac889a11923106126f98e  fix-realpath.patch
0a104143bbb754f8e9effbab6f5430be66497d1ef8313ae2c35531de4cb924c1  lpostcmd.patch
b14d545d1c3e66d6b430d241dcc134a8e8e504c03d01b249c89cb4777adab313  lsyncd.initd"
sha512sums="7be939e979525f8e4687432ffe952b1d09b8a34b4d7f92ebe86b5cddb765dbd602258682612529e9cc51305d6d001e72de9e6da62761397df23ecda30fd6a12b  lsyncd-2.1.5.tar.gz
2cebaf59d960321c2eda4ef1e0d850f62eb7eedb7ba8922a5db33a7f78c769d1a52839fbb597ae06ba576632e2abc7b92a6ba2eaf58b71b93bc877db83e25576  fix-realpath.patch
ffc97c1e7dcc3a15181f4ae6e8cd0e882a540657081621173fed10f19e05344eb09b1af1359b495d5787385f4f2a24eca5103b8cc85ee63963e18c9c73e173de  lpostcmd.patch
241ccc78e59bbf6aba38bdfc2705ff1b9c78b55b7f711ae76851406f7a928a66b6c4dab1bda2e4eeb781627ca5bd3a1507efa9ccf99961431fd5de25b93d0a4f  lsyncd.initd"
