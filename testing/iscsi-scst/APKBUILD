# Contributor: Carlo Landmeter
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

pkgname=iscsi-scst
pkgver=2.0.0
pkgrel=0
pkgdesc="ISCSI target for SCST - userspace tools"
url="http://iscsi-scst.sourceforge.net/"
arch="x86_64"
license="GPL-2"
depends=
install=
makedepends="openssl-dev bash"
subpackages=
_svn="3161"
source="http://alpine.nethq.org/distfiles/$pkgname-$pkgver-svn-$_svn.tar.gz
	http://alpine.nethq.org/distfiles/scst-$pkgver-svn-$_svn.tar.gz
	iscsi-scst.initd
        "

_builddir="$srcdir"/$pkgname
prepare() {
        cd "$_builddir"
	cp Makefile_user_space_only Makefile
}

build() {
        cd "$_builddir"
	make all SCST_INC_DIR="$srcdir"/scst/include || return 1
}

package() {
        cd "$_builddir"
	# make install is broken
	install -D usr/iscsi-scstd "$pkgdir"/usr/sbin/iscsi-scstd
	install -D usr/iscsi-scst-adm "$pkgdir"/iscsi-scst-adm
	install -D -m 755 "$srcdir"/iscsi-scst.initd "$pkgdir"/etc/init.d/iscsi-scst
}

md5sums="0980e7f0cc57d3a09cc57ba4b127ef12  iscsi-scst-2.0.0-svn-3161.tar.gz
73c1ec37231918e5183e78f1ec8f2302  scst-2.0.0-svn-3161.tar.gz
05efba84051393bf22ff1f2c718afbe9  iscsi-scst.initd"
