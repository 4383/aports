# Contributor: Mika Havela <mika.havela@gmail.com>
# Maintainer: Mika Havela <mika.havela@gmail.com>
pkgname=prosody
pkgver=0.4.2
pkgrel=0
pkgdesc="Lua based Jabber/XMPP server"
url="http://prosody.im/"
license="MIT"
depends="luasocket luaexpat"
makedepends="lua-dev libidn-dev openssl-dev"
install="prosody.pre-install prosody.post-install"
subpackages=""
source="http://prosody.im/downloads/source/$pkgname-$pkgver.tar.gz
	$pkgname.cfg.lua
	$pkgname.initd
	$install
	Makefile-0.4.2.patch
	"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	patch Makefile "$startdir/Makefile-0.4.2.patch" || return 1

	./configure --prefix=/usr \
		--sysconfdir=/etc/prosody \
		--with-lua=/usr/bin \
		--with-lua-lib=/usr/lib \
		--with-lua-include=/usr/include
	
	make || return 1
	make DESTDIR="$pkgdir" install

	install -d "$pkgdir/var/log/prosody" || return 1
	install -d "$pkgdir/var/run/prosody" || return 1
	install -D -m755 "$srcdir"/"$pkgname".initd "$pkgdir"/etc/init.d/"$pkgname"

	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}

md5sums="2669478311b3a67522669acdf03cf85c  prosody-0.4.2.tar.gz
f42039e5a342fe62cd7e491546338aaa  prosody.cfg.lua
c161a875295b45241229eb6db65211e8  prosody.initd
08484f183ba39233337d3fbc92cffadc  prosody.pre-install
8202a40bf6de7cbacbaf76f2985aa220  prosody.post-install
684d033dac42399a245c061c9a374e1b  Makefile-0.4.2.patch"
