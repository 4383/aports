# Contributor: Francesco Colista <francesco.colista@gmail.com>
# Maintainer: Francesco Colista <francesco.colista@gmail.com>
pkgname=usbip-utils
_pkgname=linux-stable
pkgver=1.1.1
_pkgver=ca89df9
pkgrel=1
pkgdesc="usbip for linux-stable from kernel.org"
url="http://git.kernel.org/?p=linux/kernel/git/stable/linux-stable.git;a=summary"
arch="all"
license="GPL"
depends=""
depends_dev="sysfsutils-dev automake autoconf libtool glib-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev"
source="saveas-http://git.kernel.org/?p=linux/kernel/git/stable/linux-stable.git;a=snapshot;h=ca89df931f296e469ed748da0a91c0af43e108d2;sf=tgz/usbip.tgz
	strnlen-uclibc.patch"
_builddir="$srcdir"/$_pkgname-$_pkgver

prepare() {
        local i
        cd "$_builddir"
           for i in $source; do
               case $i in
                  *.patch) msg $i; patch -p1 src/utils.c < "$srcdir"/$i || return 1;;
               esac
	   done	
}

build() {
        cd "$_builddir"
          ./autogen.sh || return 1
	  ./configure --prefix=/usr
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la
}

md5sums="152d41fbc8b1fc8a9e2cc2e873892d38  usbip.tgz
ddf740926a40d34d1808bb55587b35e1  strnlen-uclibc.patch"
