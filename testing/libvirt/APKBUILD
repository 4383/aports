# Maintainer: Leonardo Arena <rnalrd@gmail.com>
pkgname=libvirt
pkgver=0.8.6
pkgrel=1
pkgdesc="A virtualization API for several hypervisor and container systems"
url="http://libvirt.org/"
arch="x86 x86_64"
license="LGPL"
depends="python"
makedepends="bridge-utils-dev device-mapper e2fsprogs-dev libcap-ng-dev 
	libgpg-error-dev libxml2-dev libtasn1-dev lvm2-dev gnutls-dev 
	open-iscsi parted-dev perl zlib-dev"
install=
subpackages="$pkgname-dev $pkgname-doc"
source="http://libvirt.org/sources/$pkgname-$pkgver.tar.gz
	libvirt.confd
	libvirt.initd
	fix_undefined_symbol_error_when_macvtap_support_is_disabled.patch"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	patch -p1 < ../fix_undefined_symbol_error_when_macvtap_support_is_disabled.patch || return 1
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--libexec=/usr/lib/"$pkgname"
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install
	install -D -m755 $srcdir/$pkgname.initd $pkgdir/etc/init.d/libvirtd
	install -D -m755 $srcdir/$pkgname.confd $pkgdir/etc/conf.d/libvirtd
}

md5sums="9ed61a02983dc42d0ea0224711ace025  libvirt-0.8.6.tar.gz
1c84a7baeafe0a7f4e9d7ae5180311b7  libvirt.confd
3d32c12642cb9a84baf019c7b0971755  libvirt.initd
85045a97007ecd6355d4d79251f5051b  fix_undefined_symbol_error_when_macvtap_support_is_disabled.patch"
