# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=letsencrypt
pkgver=0.0.0_git20151108
_pkgver="${pkgver/_git/.dev}"
pkgrel=0
pkgdesc="An ACME client that can update Apache/Nginx configurations"
url="https://github.com/letsencrypt/letsencrypt"
arch="noarch"
license="Apache"
depends="py-setuptools py-mock py-acme py-configargparse py-configobj
	py-cryptography py-parsedatetime py-psutil py-dialog py-openssl
	py-rfc3339 py-tz py-requests py-six py-zope-component py-zope-interface
	py-zope-event py-cffi py-enum34 py-ipaddress py-idna"
# define acme deps here and add them to makedepends
# so they get pulled in when bootstrapping.
_depends_acme="py-setuptools py-cryptography py-ndg_httpsclient py-asn1 py-openssl
	py-tz py-rfc3339 py-requests py-six py-werkzeug"
depends_dev=""
makedepends="$depends_dev $_depends_acme"
install=""
subpackages="py-acme:acme"
source="letsencrypt-$_pkgver.tar.gz::https://github.com/letsencrypt/letsencrypt/archive/v$_pkgver.tar.gz"

_builddir="$srcdir"/letsencrypt-$_pkgver

prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	python setup.py build || return 1
}

package() {
	cd "$_builddir"
	python setup.py install --prefix=/usr --root="$pkgdir" || return 1
}

acme() {
	pkgdesc="ACME protocol implementation for Python"
	depends="$_depends_acme"
	cd "$_builddir"/acme
	python setup.py build || return 1
	python setup.py install --prefix=/usr --root="$subpkgdir" || return 1
}

md5sums="98b11cd9f44d6ee067f921062de11bc3  letsencrypt-0.0.0.dev20151108.tar.gz"
sha256sums="7d0d287366a322f306041a0396a4237f36e2c7ec1f96d10e7425fb22ae3d3edf  letsencrypt-0.0.0.dev20151108.tar.gz"
sha512sums="ed2e79786bea9b8a99c26bec21a17a77a094614f94152a1a27a28665bd9e46cc6d8ab8c685405f2c2aa54ba6e1cb9c196dddecd0c30472fdc6ce10707a583bba  letsencrypt-0.0.0.dev20151108.tar.gz"
