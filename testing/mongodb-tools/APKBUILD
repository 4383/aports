# Contributor: Marc Vertes <marc.vertes@ugrid.net>
# Maintainer: Marc Vertes <marc.vertes@ugrid.net>
pkgname=mongodb-tools
pkgver=r3.2.1
pkgrel=0
pkgdesc="The MongoDB tools provide import, export, and diagnostic capabilities."
url="https://github.com/mongodb/mongo-tools"
arch="all"
license="apache"
depends="libsasl"
depends_dev=""
makedepends="$depends_dev go cyrus-sasl-dev openssl-dev"
install=""
subpackages=""
source="https://github.com/mongodb/mongo-tools/archive/$pkgver/$pkgname-$pkgver.tar.gz"

_builddir="$srcdir"/mongo-tools-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	local ldflags
	cd "$_builddir"
	. ./set_gopath.sh
	mkdir -p bin
	ldflags="-X github.com/mongodb/mongo-tools/common/options.Gitspec=`git rev-parse HEAD`"
	for i in bsondump mongostat mongofiles mongoexport mongoimport mongorestore mongodump mongotop mongooplog
	do
		echo "Building $i"
		go build -ldflags "$ldflags" -o "bin/$i" -tags "ssl sasl" "$i/main/$i.go"
	done
}

package() {
	cd "$_builddir/bin"
	local bindir="$pkgdir/usr/bin"
	mkdir -p "$bindir" || return 1
	cp bsondump mongostat mongofiles mongoexport mongoimport mongorestore mongodump mongotop mongooplog "$bindir" || return 1
}

md5sums="86a7e98bddf41f5413155650a78c9baa  mongodb-tools-r3.2.1.tar.gz"
sha256sums="e2a0527b8987ae954fc9ca071987b4c58ff53aa2bc0a4d8b03337f4d8aff1d89  mongodb-tools-r3.2.1.tar.gz"
sha512sums="52e7402c232915e8bc481598a5f3a311ef7f4058448735ed14e142da180baf19aac95e641dbe58d0c71e114f35889d1cfa6a321114e4cf21edf7c525bf548249  mongodb-tools-r3.2.1.tar.gz"
