# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=linux-vserver
pkgver=2.6.28.7
pkgrel=0
pkgdesc="Linux kernel with vserver"
url=http://linux-vserver.org
makedepends="$pkgname-sources perl"
source="kernelconfig"
subpackages="$pkgname-mod $pkgname-dev"
license=GPL-2

build() {
	mkdir -p "$srcdir/$pkgname"
	cd "$srcdir/$pkgname"
	cp ../kernelconfig .config
	make -C /usr/src/linux-$pkgver-vserver "O=$PWD" silentoldconfig
	make || return 1

	mkdir -p $pkgdir/boot $pkgdir/lib/modules
	make modules_install install \
		INSTALL_MOD_PATH=$pkgdir \
		INSTALL_PATH=$pkgdir/boot
	cd "$pkgdir"/boot
	mv vmlinuz ${pkgname#linux-}
	mv System.map System-${pkgname#linux-}.map
}

dev()  {
	install -Dm644 "$srcdir/kernelconfig" \
		"$subpkgdir"/usr/share/$pkgname/config
}

md5sums="6ddcaf64abb1c6f7f52863e32d9d131c  kernelconfig"
