pkgname=uclibc
pkgver=0.9.30_rc2
_mynamever=uClibc-0.9.30-rc2

makedepends="binutils gcc linux-headers make uclibc-dev"
subpackages="dev"
source="http://uclibc.org/downloads/$_mynamever.tar.bz2
	uclibcconfig
	69_all_uClibc-0.9.29-fix-gethostent_r-failure-retval.patch
	72_all_uClibc-0.9.29-linuxthreads.patch
	74_all_uClibc-0.9.29-rm-whitespace.patch
	81_all_uClibc-gnu89-inline.patch"

_prepare() {
	local i
	cd $srcdir/$_mynamever/
	for i in ../*.patch; do
		if ! patch -p1 < $i; then
			echo "Patch failed: $i" >&2
			return 1
		fi
	done
}

_compile() {
	cd $srcdir/$_mynamever/
	cp ../uclibcconfig .config
	make silentoldconfig
	make || return 1
}

_install() {
	cd $srcdir/uClibc-0.9.30-rc2
	make install DESTDIR=$pkgdir
}

build() {
	_prepare && _compile && _install
}

md5sums="b1e58077d90c8bf43f56848d2f81c89d  uClibc-0.9.30-rc2.tar.bz2
61661bd8640603293d1d16de647c8528  uclibcconfig
f31b7fee0153ddc288a843d86f928997  69_all_uClibc-0.9.29-fix-gethostent_r-failure-retval.patch
c2a68efc3b1438657eb8ac68feafe6af  72_all_uClibc-0.9.29-linuxthreads.patch
cdf6ba2ca4450c8f32724a86a56c948f  74_all_uClibc-0.9.29-rm-whitespace.patch
0b2312ad80c7440c4f3715715ebe3444  81_all_uClibc-gnu89-inline.patch"
