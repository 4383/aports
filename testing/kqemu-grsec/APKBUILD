# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

_flavor=grsec
_realname=kqemu
# source the kernel version
if [ -f ../../main/linux-$_flavor/APKBUILD ]; then
	. ../../main/linux-$_flavor/APKBUILD
fi
_kernelver=$pkgver-r$pkgrel
_abi_release=$pkgver-${_flavor}
_kpkgrel=$pkgrel

pkgname=${_realname}-${_flavor}
pkgver=$pkgver
_realver=1.4.0pre1
_mypkgrel=0
pkgrel=$(($_kpkgrel + $_mypkgrel))
pkgdesc="$_flavor kernel modules for kemu $_realver"
url="http://www.nongnu.org/qemu/"
license="GPL"
depends="linux-${_flavor}=${_kernelver}"
install=
makedepends="linux-${_flavor}-dev=${_kernelver}"
subpackages=
source="http://www.nongnu.org/qemu/kqemu-$_realver.tar.gz"

# override kernel APKBUILD's prepare
prepare() {
	:
}

build() {
	cd "$srcdir"/$_realname-$_realver
	./configure --kernel-path=/lib/modules/${_abi_release}/build
	make || return 1
}

package() {
	cd "$srcdir"/$_realname-$_realver
	install -D -m644 kqemu.ko \
		"$pkgdir"/lib/modules/${_abi_release}/misc/kqemu.ko \
		|| return 1
} 
md5sums="d738d8ca7332211ab716ec3213d82ee1  kqemu-1.4.0pre1.tar.gz"
