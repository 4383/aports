# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=pulseaudio
pkgver=4.0
pkgrel=0
pkgdesc="A featureful, general-purpose sound server"
url="http://www.freedesktop.org/wiki/Software/PulseAudio"
arch="all"
license="LGPL"
depends=""
depends_dev="glib-dev json-c-dev libsndfile-dev tdb-dev udev-dev dbus-dev speex-dev
	bluez-dev gconf-dev avahi-dev gtk+3.0-dev libsamplerate-dev openssl-dev
	alsa-lib-dev jack-dev check-dev orc-dev libasyncns-dev fftw-dev"
makedepends="$depends_dev autoconf automake libtool intltool"
install=""
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang $pkgname-libs"
source="http://freedesktop.org/software/pulseaudio/releases/pulseaudio-$pkgver.tar.xz"

_builddir="$srcdir"/pulseaudio-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/usr/lib \
		--localstatedir=/var \
		--with-udev-rules-dir=/usr/lib/udev/rules.d \
		--with-database=tdb \
		--disable-tcpwrap \
		--disable-default-build-tests \
		|| return 1
	make || return 1
}

package() {
        cd "$_builddir"
        make DESTDIR="$pkgdir" install || return 1
        rm -f "$pkgdir"/usr/lib/*.la \
		"$pkgdir"/usr/lib/*/*.la
}

libs() {
	pkgdesc="Pulseaudio libraries"
	cd "$_builddir"
	mkdir -p "$subpkgdir"/etc/pulse \
		"$subpkgdir"/usr/bin \
		"$subpkgdir"/usr/lib/pulseaudio || return 1
	
	mv "$pkgdir"/etc/pulse/client.conf \
		"$subpkgdir"/etc/pulse || return 1
	
	for i in pacat pactl padsp pamon paplay parec parecord; do
		mv "$pkgdir"/usr/bin/$i \
			"$subpkgdir"/usr/bin/ || return 1
	done

	mv "$pkgdir"/usr/lib/libpulse-simple.so* \
		"$pkgdir"/usr/lib/libpulse-mainloop-glib.so* \
		"$subpkgdir"/usr/lib || return 1

	mv "$pkgdir"/usr/lib/pulseaudio/libpulsedsp.so \
		"$pkgdir"/usr/lib/pulseaudio/libpulsecommon-*.so \
		"$subpkgdir"/usr/lib/pulseaudio || return 1
}

md5sums="591f211db2790a7e4d222f2dc6858db3  pulseaudio-4.0.tar.xz"
sha256sums="35ceb36bb1822fe54f0b5e4863b4f486769fdfb8ff2111f01fd8778928f9cdae  pulseaudio-4.0.tar.xz"
sha512sums="7cfb57b15943ec5239f23b90637ab7ab421ac57cf05312030bb348ee7d72a70343716b9bf79035b2426e820984cf8179285548b8acf0b7232defcd8b9ad32e83  pulseaudio-4.0.tar.xz"
