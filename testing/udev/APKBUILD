# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=udev
pkgver=161
pkgrel=0
pkgdesc="The userspace dev tools (udev)"
url="http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html"
license="GPL"
subpackages="$pkgname-dev $pkgname-doc libgudev"
depends=
makedepends="gobject-introspection glib-dev gperf acl-dev libusb-compat-dev
	usbutils pciutils-dev libtool"
install=
source="http://www.kernel.org/pub/linux/utils/kernel/hotplug/$pkgname-$pkgver.tar.bz2
	write_root_link_rule
	move_tmp_persistent_rules.sh
	udev-mount.initd
	udev-postmount.initd
	udev.initd"

build () 
{ 
	cd "$srcdir"/$pkgname-$pkgver
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/lib/udev \
		--exec-prefix="" \
		|| return 1
	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install

	mkdir -p "$pkgdir"/usr/lib/pkgconfig
	mv "$pkgdir"/usr/share/pkgconfig/* \
		"$pkgdir"/lib/pkgconfig/* \
		"$pkgdir"/usr/lib/pkgconfig/ \
		&& rmdir "$pkgdir"/lib/pkgconfig "$pkgdir"/usr/share/pkgconfig \
		|| return 1
	mv "$pkgdir"/lib/*.la \
		"$pkgdir"/lib/girepository* \
		"$pkgdir"/usr/lib/ || return 1

	chmod +x "$pkgdir"/lib/udev/write_*_rules
	for _i in write_root_link_rule move_tmp_persistent_rules.sh; do
		install -Dm755 ../$_i "$pkgdir"/lib/udev/$_i
	done
	for _i in udev udev-mount udev-postmount; do
		install -Dm755 ../$_i.initd "$pkgdir"/etc/init.d/$_i
	done
}

libgudev() {
	pkgdesc="A GObject wrapper of the library gudev"
	mkdir -p "$subpkgdir"/lib
	mv "$pkgdir"/lib/libgudev* "$subpkgdir"/lib/
}

md5sums="95b6a0ffc9913f3e8021c65f51eb4f88  udev-161.tar.bz2
c9de7581099cdfdcd105666cd98a0f0a  write_root_link_rule
7bf11e11519117f743483c73e0767750  move_tmp_persistent_rules.sh
12760065a66ccbddc9e3a86a6cd2231c  udev-mount.initd
bffb42859ca508cfe1d9fa0a169ba810  udev-postmount.initd
e913f8f122e8879252d2a05de7dd7499  udev.initd"
