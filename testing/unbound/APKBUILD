# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=unbound
pkgver=1.4.10
pkgrel=3
pkgdesc="Unbound is a validating, recursive, and caching DNS resolver"
pkgusers="unbound"
pkggroups="unbound"
url="http://unbound.net/"
arch="all"
license="Custom"
depends=
depends_dev="openssl-dev expat-dev ldns-dev libevent-dev"
makedepends="$depends_dev"
install="$pkgname.pre-install"
subpackages="$pkgname-dev $pkgname-doc"
source="http://unbound.net/downloads/unbound-$pkgver.tar.gz
	unbound.initd
	unbound.confd"

_builddir="$srcdir"/unbound-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--with-pidfile=/var/run/unbound/unbound.pid \
		--with-pic \
		--with-username=unbound \
		--with-libevent \
		--with-ldns \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
        install -m755 -D "$srcdir"/unbound.initd \
                "$pkgdir"/etc/init.d/unbound || return 1
        install -m644 -D "$srcdir"/unbound.confd \
                "$pkgdir"/etc/conf.d/unbound || return 1
	install -d -o unbound -g unbound "$pkgdir"/var/run/unbound
	chown unbound:unbound -R "$pkgdir"/etc/unbound
}

md5sums="6bbae378db76abfe0bd72c404e484597  unbound-1.4.10.tar.gz
455b7893a08e2f3e4ebce923e97c9724  unbound.initd
10f8a73d14160571acea41fc89d914e7  unbound.confd"
