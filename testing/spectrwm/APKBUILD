# Contributor: Olivier Mauras <olivier@mauras.ch>
# Maintainer:
pkgname=spectrwm
pkgver=2.6.2
pkgrel=1
pkgdesc="A small dynamic tiling window manager for X11"
url="https://opensource.conformal.com/wiki/spectrwm"
arch="all"
license="ISC"
depends=""
depends_dev="xorg-server-dev libxrandr-dev libxcursor-dev libxft-dev xcb-util-dev xcb-util-wm-dev xcb-util-keysyms-dev libxt-dev"
makedepends="$depends_dev bsd-compat-headers"
install=""
subpackages="$pkgname-doc"
source="https://opensource.conformal.com/snapshots/$pkgname/$pkgname-$pkgver.tgz 0001-musl-fix.patch"

_builddir=$srcdir/$pkgname-$pkgver
prepare() {
	# Apply patches
	cd "$_builddir"
	for i in $source; do
                case $i in
                *.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
                esac
        done

	# Fix $PREFIX
	cd "$_builddir/linux"
	sed -i 's#^PREFIX.*#PREFIX  ?= /usr#' Makefile
}

build() {
	cd "$_builddir/linux"
	make
}

package() {
	cd "$_builddir/linux"
	make DESTDIR="$pkgdir" install || return 1
	# Copy sample scripts and conf
	mkdir "$pkgdir"/usr/share/$pkgname
	cp ../*.sh "$pkgdir"/usr/share/$pkgname
	cp ../*.conf "$pkgdir"/usr/share/$pkgname
}

md5sums="eba7cba0c85706435657f744bf9086bc  spectrwm-2.6.2.tgz
4b909368b341f50ecabf50be032fe141  0001-musl-fix.patch"
sha256sums="eb9b33ee05b0625d59607f886d9ba7f0723bd863b503d66bdb592f5461c59459  spectrwm-2.6.2.tgz
4c6ccdc4cf99a982fba4763236c236d0aaf1e21f52dd3b4cfb73c888110d19bb  0001-musl-fix.patch"
sha512sums="f1962df679ca07ca7d8c68a2d0b88331eda5c7cd35ecf1a5a63687984c1c67ef48fffb4e29d273fb1ccef9c9bb77a5ab12a09ef27b1d97abdc87dc20f38717f5  spectrwm-2.6.2.tgz
316d1d0dd834077f33d48a6f07f9e06094490a0737041cd63fad12e9dbba78a72fd357f64196e496b99cb9b7df65bbc55075cfefb0b0afad841bd456a15e718c  0001-musl-fix.patch"
