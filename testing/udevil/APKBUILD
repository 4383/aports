# Contributor: Stuart Cardall <developer@it-offshore.co.uk>
# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=udevil
pkgver=0.4.4
pkgrel=0
pkgdesc="Mount / unmount removable devices without a password (udisks alternative)"
url="http://ignorantguru.github.io/udevil"
arch="all"
license="GPL3+"
makedepends="$depends_dev glib-dev udev-dev intltool"
install="$pkgname.pre-install"
subpackages="$pkgname-lang"
pkggroups="plugdev"
source="$pkgname-$pkgver.tar.gz::https://github.com/IgnorantGuru/$pkgname/archive/$pkgver.tar.gz
	$pkgname.apk-post-msg
	"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--prefix=/usr \
		--disable-systemd || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	chown root:plugdev "$pkgdir"/usr/bin/udevil || return 1
        chmod u+s,go-s,o-x "$pkgdir"/usr/bin/udevil # remove SUID bit
	mkdir -p "$pkgdir/usr/share/apk-tools/$pkgname"
	install -m644 "$srcdir/$pkgname.apk-post-msg" "$pkgdir/usr/share/apk-tools/$pkgname/post-install-message" || return 1
#	chmod ugo-s,ugo+x "$pkgdir"/usr/bin/udevil #remove SUID bit completely
}

md5sums="281aa065d92c679cb41728069e72b272  udevil-0.4.4.tar.gz
cd426d9d4f6387eb6eca51c661525d1b  udevil.apk-post-msg"
sha256sums="ad2fd8375bd62622718a04235e9772119459089938dbb78e657955e595822b7c  udevil-0.4.4.tar.gz
be09f2c03a852eee3e2b94250664e8a63b33df631a098e500d730a56c839789a  udevil.apk-post-msg"
sha512sums="adce4916e06d1cc4965521abbcbc2901e53930691167f431cb18e28d3ef8bde740e95a6a5f40dfc58dfd7b4b661b4475d3dd2b6174a5d7a55ae7c65629b82327  udevil-0.4.4.tar.gz
060e17a1847a40f5ad1f19d803c14de8be2bcde205cf23fbbd73f0167c577f4be04749476e31e6e153033f0b92a70b264b553bb4cc3c077acdb39b117a0f9814  udevil.apk-post-msg"
