# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

pkgname=libreswan
pkgver=3.5
pkgrel=1
pkgdesc='IPsec implementation for Linux'
url='https://libreswan.org/'
arch='all'
license='GPL'
depends='nss-tools'
depends_dev='gmp-dev linux-pam-dev nss-dev unbound-dev libcap-ng-dev curl-dev nspr-dev'
makedepends="$depends_dev bison flex pkgconf coreutils bash"
subpackages="$pkgname-doc"
source="http://download.libreswan.org/libreswan-$pkgver.tar.gz
	ipsec.initd"

build() {
  cd "$srcdir"/$pkgname-$pkgver
  make programs || return 1
  #make module || return 1 
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make INC_MANDIR=share/man \
		INC_RCDEFAULT=/etc/init.d \
		INC_USRLOCAL=/usr \
		DESTDIR="$pkgdir" \
		INSTCONFFLAGS=-m644 \
		FINALBINDIR=/usr/libexec/ipsec \
		FINALLIBEXECDIR=/usr/libexec/ipsec \
		install || return 1
	install -Dm755 "$srcdir"/ipsec.initd "$pkgdir"/etc/init.d/ipsec \
		|| return 1
}

md5sums="7dbf9dbd79836b567e3231006eed3109  libreswan-3.5.tar.gz
014d8187d22a348a04dd2fdba4fc0d46  ipsec.initd"
sha256sums="0115f84c0171908b5c9b8b7d59aba42933bd50f2cb88483f752f72e16f2fd880  libreswan-3.5.tar.gz
f21668846fdf6d01a7d92672adf0a5dda63f827b317ab0253a7c627968656d8f  ipsec.initd"
sha512sums="bed9c56118b141e2054c7eead027df4aabbd2ff996d329e4c59411d418e70f35f329142a5ceb0f047cd2dafea2f45d5e0933f57c84b09387990b3d364ae81462  libreswan-3.5.tar.gz
c245b20e1ea8bd1a615f467e72ccbb3df7b63a60d1fcdb7b485a791377a0adfa75942ed73a6fb1c792eca472c92d3d524e33ba0594467738aac3aaa9123778b2  ipsec.initd"
