# Maintainer: Timo Ter√§s <timo.teras@iki.fi>
pkgname=raspberrypi
pkgver=0.20140919
_commitid=ffcc4bd7c4875b71376c4240116e251652c9bec0
pkgrel=0
pkgdesc="Raspberry Pi support tools"
url="https://github.com/raspberrypi/userland"
arch="armhf"
license="BSD"
depends=""
makedepends="cmake"
install=""
options="!fhs"
subpackages="$pkgname-dev $pkgname-libs"
source="raspberrypi-$pkgver.tar.gz::https://github.com/raspberrypi/userland/archive/$_commitid.tar.gz
	fix-musl.patch
	fix-stdc99.patch
	"

_sourcedir="$srcdir"/userland-$_commitid
_builddir="$srcdir"/build

prepare() {
	local i
	cd "$_sourcedir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	mkdir -p "$_builddir"
	cd "$_builddir"
	cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_RPATH=/opt/vc/lib $_sourcedir || return 1
	make
}

package() {
	cd "$_builddir"
	make install DESTDIR="$pkgdir" || return 1

	# nuke the unwanted stuff
	rm -rf "$pkgdir"/opt/vc/src
	rm -rf "$pkgdir"/opt/vc/lib/*.a
}

libs() {
	pkgdesc="Raspberry Pi support libraries"

	mkdir -p "$subpkgdir"/opt/vc/lib
	mv "$pkgdir"/opt/vc/lib/* "$subpkgdir"/opt/vc/lib
}

md5sums="6627660ea21c35859ada7d638247e049  raspberrypi-0.20140919.tar.gz
49a33897d575a07514b1b8d288361f63  fix-musl.patch
7da1da67742eac08b7a36b70cea6a50d  fix-stdc99.patch"
sha256sums="a9172bb498a1537dba74df5bcef67a1b83244e45282130b05fd2873c49e15ac0  raspberrypi-0.20140919.tar.gz
e8cbc558094d745f99a14f354720be0fdf81f2ebc48651fed32c4ae1ef1fd649  fix-musl.patch
6cd7d652073790b66760eea41042124eb5426b23a515ad6108dc4cb25b9f61b5  fix-stdc99.patch"
sha512sums="ee50855a2fff41c07761c9f3cabdee658f72a47b71a1ad82d478bde782c7577e9280e76f8b11432a373027f0566acb4349003b654e4a6e63ec70e9b03763fe99  raspberrypi-0.20140919.tar.gz
8092d59985d7380b533896c6f8aad6f4838e8cf414a8052c43fa4330bc07ce6be7d2d0cc3bc280f3f63b537687cb8f51c93ef608db82fe6638505d03b317581f  fix-musl.patch
1650cf7230da10d0ceedfcae170e93d2c33e799b670392a2cc1e44cf7108c9f46c47b6daa50a608bba4e1683d859d9b70eb7d2070640c956fe6c0d58a29ca89f  fix-stdc99.patch"
