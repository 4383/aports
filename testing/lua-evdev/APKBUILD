# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lua-evdev
pkgver=1.1
pkgrel=0
pkgdesc="Lua module for reading input events"
url="https://github.com/Tangent128/lua-evdev"
arch="all"
license="MIT"
depends=""
depends_dev=""
makedepends="$depends_dev lua5.2-dev"
install=""
subpackages="lua5.2-evdev:_split52"
source="lua-evdev-$pkgver.tar.gz::https://github.com/Tangent128/lua-evdev/archive/evdev-$pkgver.tar.gz
	cflags.patch"

_builddir="$srcdir"/lua-evdev-evdev-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	make CFLAGS="$CFLAGS $(pkg-config --cflags lua5.2)" || return 1
}

package() {
	cd "$_builddir"
	local _v=5.2
	rm -f "$pkgdir"/usr/lib/*.la
	for i in evdev.lua evdev/constants.lua; do
		install -D $i "$pkgdir"/usr/share/lua/$_v/$i || return 1
	done
	for i in evdev/core.so; do
		install -D $i "$pkgdir"/usr/lib/lua/$_v/$i || return 1
	done
}

_split52() {
	pkgdesc="$pkgdesc - Lua 5.2"
	mkdir -p "$subpkgdir"
	mv "$pkgdir"/usr "$subpkgdir"/
}


md5sums="e4ef501a77720498bc1dd8daf84a6c32  lua-evdev-1.1.tar.gz
b1c0f7d2c7212219e98ec40045a4c848  cflags.patch"
sha256sums="c9b5cfc741cac1ba7fd0208cc74375f72eb606da3ef7c00ed45c7ea415106291  lua-evdev-1.1.tar.gz
20042880b39a3a7bd04a3ee3df00f9df1bde507fc2a902835023fee8e67bc680  cflags.patch"
sha512sums="1b00f743145810ac3c15e18c5dddb52ba88d7fb593e01bee3b858f0cb5ddf6da20e564a75e56650d615be6d39a107b6fa2a6ac74ee6ef3cd222313c0e3a5f5ca  lua-evdev-1.1.tar.gz
2804adb8a07ec9ba1e7c139e7db26cf3bb809058cab4b09e52344d3e351c22923c08ae3c51d4883bbef2167ea3497addce13c4ed2c2f3e1e68b23f8bdf6c83d6  cflags.patch"
