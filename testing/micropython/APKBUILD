# Contributor: Marian <marian.buschsieweke@ovgu.de>
# Maintainer: Marian <marian.buschsieweke@ovgu.de>
pkgname=micropython
pkgver=1.9.1
pkgrel=0
pkgdesc="A lean and efficient Python implementation for MCUs and constrained systems"
url="http://www.micropython.org/"
arch="all"
license="MIT"
depends=""
makedepends="libffi-dev python3"
subpackages=""
source="${pkgname}-${pkgver}.tar.gz::https://github.com/${pkgname}/${pkgname}/archive/v${pkgver}.tar.gz
        0000-unix-mpconfigport.patch"
builddir="${srcdir}/${pkgname}-${pkgver}/unix"

prepare() {
	cd "${srcdir}"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$builddir"
	unset CFLAGS
	make
}

check() {
	cd "$builddir"
	make test
}

package() {
	cd "$builddir"
	mkdir -p "${pkgdir}/usr/bin"
	install -m755 micropython "${pkgdir}/usr/bin/micropython"
}

sha512sums="bc0eeb1e6d821034b7157613f2d421df304f2959e9fd62d2886641eba8d74575787861c9ff46fc3bcb9c14c6ad1f698043231801207f946af9b5d302bb253c63  micropython-1.9.1.tar.gz
926515a76dc856192de79a7c35c390bd533a38a2c163812ce5a3739280ca33881791f3d199922edb2e577ec9ac16265dc4891ad96f6c6eb4e7cf9d5ae8044a32  0000-unix-mpconfigport.patch"
