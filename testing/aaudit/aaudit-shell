#!/usr/bin/lua5.2

local json = require 'cjson'
local aas = require 'aaudit.server'

local req = json.decode(io.read("*all"))
req.remote_ip = (os.getenv("SSH_CLIENT") or ""):match("[^ ]+")
req.identity = arg[1]

local ok, msg = aas.handle(req)
print(json.encode{ok=ok,msg=msg})
