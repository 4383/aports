# Contributor:
# Maintainer: Leonardo Arena <rnalrd@gmail.com>
pkgname="backuppc"
_realname="BackupPC"
pkgver="3.2.0b1"
_realver="3.2.0beta1"
pkgrel=0
pkgdesc="High-performance, enterprise-grade backup system"
url="http://backuppc.sourceforge.net/"
license="GPL"
depends="perl busybox rsync"
makedepends=""
install="$pkgname.pre-install"
subpackages=""
source="http://downloads.sourceforge.net/project/$pkgname/$pkgname-beta/$_realver/$_realname-$_realver.tar.gz
configure.pl.patch"

prepare () {
	cd "$srcdir/$_realname-$_realver"
	mkdir -p "$pkgdir"/etc/BackupPC
	mkdir -p "$pkgdir"/var/www/cgi-bin
	patch -p2 < ../../configure.pl.patch
}

build() {
	cd "$srcdir/$_realname-$_realver"
	perl configure.pl \
	 --batch \
	 --backuppc-user=backuppc \
	 --bin-path bzip2=/usr/bin/bzip2 \
	 --bin-path cat=/bin/cat \
	 --bin-path df=/bin/df \
	 --bin-path tar=/bin/tar \
	 --bin-path hostname=/bin/hostname \
	 --bin-path nmblookup=/usr/bin/nmblookup \
	 --bin-path perl=/usr/bin/perl \
	 --bin-path ping=/bin/ping \
	 --bin-path rsync=/usr/bin/rsync \
	 --bin-path sendmail=/usr/bin/sendmail \
	 --bin-path smbclient=/usr/bin/smbclient \
	 --bin-path split=/usr/bin/split \
	 --bin-path ssh=/usr/bin/ssh \
	 --compress-level=3 \
	 --config-dir "$pkgdir"/etc/BackupPC \
	 --cgi-dir "$pkgdir"/var/www/cgi-bin \
	 --data-dir "$pkgdir"/var/lib/backup/data/BackupPC \
	 --hostname backuppc \
	 --html-dir "$pkgdir"/var/www/htdocs/BackupPC \
	 --html-dir-url /BackupPC \
	 --install-dir "$pkgdir"/usr/lib/BackupPC \
	 --log-dir "$pkgdir"/var/log/BackupPC \
	 --uid-ignore \
	 --no-set-perms || return 1
}

package() {
	cd "$srcdir/$_realname-$_realver"
#	make DESTDIR="$pkgdir" install
}

md5sums="34c85b43136954c81d543fa0a7b0b121  BackupPC-3.2.0beta1.tar.gz
f57ad7fdcce804f20f2fe82bee91e813  configure.pl.patch"
