# Contributor: Vitaliy Tokarev <vitaliy.tokarev@gmail.com>
# Maintainer:
pkgname=yaws
pkgver=1.96
pkgrel=0
pkgdesc="Yet Another Web Server, pure Erlang HTTP server/framework"
url="http://yaws.hyber.org/"
arch="all"
license="BSD"
depends=""
depends_dev="linux-pam-dev erlang"
makedepends="$depends_dev"
options="!emptydirs"
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.post-deinstall"
subpackages="$pkgname-doc $pkgname-web"
source="http://yaws.hyber.org/download/$pkgname-$pkgver.tar.gz
        yaws.init.d"

_builddir="$srcdir/$pkgname-$pkgver"
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
    export ERLCFLAGS="-W"
    ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var
    make || return 1
}

package() {
	cd "$_builddir"
    make DESTDIR="$pkgdir" install || return 1

    # XXX: from arch linux
    install -d "$pkgdir/usr/lib/erlang/lib"
    ln -s /usr/lib/yaws "$pkgdir/usr/lib/erlang/lib/$pkgname-$pkgver"

    # init.d
    install -Dm755 "$srcdir/yaws.init.d" "$pkgdir/etc/init.d/yaws"

    # License
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

web() {
    arch="noarch"
    depends="yaws"
    pkgdesc="Yet Another Web Server, pure Erlang HTTP server/framework (examples)"

    mkdir -p "$subpkgdir"/var
    mv "$pkgdir"/var/yaws "$subpkgdir"/var/
}

md5sums="7c9231b7d9880033c9d3bfba2aa3c901  yaws-1.96.tar.gz
3a1445696bd25ae71631d13457980693  yaws.init.d"
sha256sums="8d4f16d18937335ac021ca4c65c8ee81dc4d71f133718c7148856cc6bf1f55e2  yaws-1.96.tar.gz
313ce8cacd25e8eed5717dfd9e79d1683a4038a64cffff6e93aacfd2fb11c261  yaws.init.d"
sha512sums="821ffe530a265462df083a9408e1798616bf11f8c891955500f8de170f77de831defc65c2341d0552471dde253df16ae3d27d59eaa0ccd79b117f3070f49fb2c  yaws-1.96.tar.gz
07ff290eb98be729445d797361503d01dfba29f050639632d251202267aa485655fd04798f4de8d66a83bb0a798280116f8b06d5b9e8810d3cb2d20c1c1bd1d6  yaws.init.d"
