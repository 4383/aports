# Contributor: V.Krishn <vkrishn4@gmail.com>
# Maintainer: 
pkgname=php-zendopcache
pkgver=7.0.1
pkgrel=0
pkgdesc="Zend OPcache for PHP"
url="https://github.com/zend-dev/ZendOptimizerPlus"
arch="all"
license="PHP"
depends="php"
makedepends="php-dev autoconf pcre-dev"
subpackages=""
source="saveas-https://github.com/zend-dev/ZendOptimizerPlus/archive/v7.0.1.tar.gz/$pkgname-$pkgver.tar.gz
opcache.ini"
_builddir="$srcdir/ZendOptimizerPlus-$pkgver"

build() {
	cd "$_builddir"
	phpize || return 1
	./configure --enable-opcache \
		--with-php-config=/usr/bin/php-config
	make || return 1
}

package() {
	cd "$_builddir"
	make INSTALL_ROOT=$pkgdir install || return 1
	install -D -m644 "$srcdir"/opcache.ini "$pkgdir"/etc/php/conf.d/opcache.ini
	extension_dir=`grep '^extension_dir' /usr/bin/php-config | awk -F'=' '{print $2}' | replace "'" ""`
	sed -i -e "s|{{extension_dir}}|$extension_dir|" \
		"$pkgdir"/etc/php/conf.d/opcache.ini || return 1
}

md5sums="c5d41c2404916e5aaceff5c7f7d887ce  php-zendopcache-7.0.1.tar.gz
b80548491db141fb5d7a823445ec2ba9  opcache.ini"
