# Contributor: Daniel Sabogal <dsabogalcc@gmail.com>
# Maintainer:
pkgname=lua-mpack
pkgver=1.0.3
_lua_versions="5.1 5.2"
pkgrel=0
_pkgdesc="Libmpack bindings for Lua"
pkgdesc="$_pkgdesc"
url="https://github.com/tarruda/libmpack"
arch="all"
license="MIT"
depends=""
depends_dev=""
makedepends=""
install=""
subpackages=""
source="libmpack-$pkgver.tar.gz::https://github.com/tarruda/libmpack/archive/$pkgver.tar.gz"
for _v in $_lua_versions; do
        makedepends="$makedepends lua$_v-dev"
        subpackages="$subpackages lua$_v-mpack:split_${_v/./_}"
done

builddir="$srcdir"/libmpack-$pkgver

build() {
	cd "$builddir"
	gcc $CFLAGS -fPIC -c binding/lua/lmpack.c -o lmpack.o || return 1
	gcc -shared -o mpack.so lmpack.o || return 1
}

package() {
	arch="noarch"
	mkdir -p "$pkgdir"
}

_split() {
	local _ver="$1"
	install_if="lua$_ver $pkgname=$pkgver-r$pkgrel"
	pkgdesc="$_pkgdesc $_ver"
	cd "$srcdir"/libmpack-$pkgver || return 1
	install -Dm755 mpack.so \
		"$subpkgdir"/usr/lib/lua/$_ver/mpack.so || return 1
}

for _v in $_lua_versions; do
        eval "split_${_v/./_}() { _split $_v; }"
done

md5sums="7d855d6f989686fae713c10f202f5a1b  libmpack-1.0.3.tar.gz"
sha256sums="65eb21cfa9313204ac5296e3b305d752b8422c724b6375caecc6385f0a6d6e22  libmpack-1.0.3.tar.gz"
sha512sums="3024d2830d83a7572a648ee6074467e2096dc6af7c92aaf3c6531e4c25c1c57d9853a60f5b2d1f50039ceeb80bae83f8fdc7241fa48f789cb636bba32fc2a9ba  libmpack-1.0.3.tar.gz"
