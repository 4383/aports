# Contributor: Michael Mason <ms13sp@gmail.com>
pkgname=kamailio
pkgver=1.5.2
pkgrel=0
pkgdesc="Open Source SIP Server"
url="http://www.kamailio.org/"
license="GPL"
depends="expat postgresql"
makedepends="bison flex coreutils expat-dev libpq"
install=
subpackages="$pkgname-doc"
source="http://www.kamailio.org/pub/kamailio/$pkgver/src/$pkgname-$pkgver-notls_src.tar.gz
	kamailio.initd
	kamailio.pre-install
	kamailio.post-install"

build() {
	cd "$srcdir/$pkgname-$pkgver-notls"
	sed -i -e 's:^cfg-target.*:cfg-target = $(cfg-dir):' \
	                -e 's:^cfg-prefix.*:cfg-prefix = $(basedir):' Makefile.defs

	cd scripts
 		sed -i -e 's:/var/run/kamailio.pid:/var/run/kamailio/kamailio.pid:g' \
		kamctl.base kamctlrc
	cd ..

	make prefix=/usr || return 1
	make prefix=/usr basedir="$pkgdir" install

	 install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	# install -m644 -D "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

md5sums="6c6f4ed6fbcb4d008b8ac3de5b99ce99  kamailio-1.5.2-notls_src.tar.gz
e6b93397ec2a1ec094d23d93d87771bd  kamailio.initd
c646af2dd31f5c4289a2f802c873d98f  kamailio.pre-install
3fbaf633ff1620d0d526fc4047c7bed9  kamailio.post-install"
