# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=android-tools
pkgver=5.1.1_p13
_realver=${pkgver/_p/_r}
pkgrel=0
pkgdesc="Android platform tools"
url="http://tools.android.com/"
arch="all"
license="Apache BSD"
depends=""
depends_dev="openssl-dev pcre-dev"
makedepends="$depends_dev linux-headers bsd-compat-headers"
install=""
subpackages=""
source="http://dev.alpinelinux.org/archive/$pkgname/$pkgname-core-$_realver.tar.gz
	http://dev.alpinelinux.org/archive/$pkgname/$pkgname-extras-$_realver.tar.gz
	http://dev.alpinelinux.org/archive/$pkgname/$pkgname-libselinux-$_realver.tar.gz
	http://dev.alpinelinux.org/archive/$pkgname/$pkgname-f2fs-tools-$_realver.tar.gz

	Makefile"

_giturl="https://android.googlesource.com/platform"
_gittag="android-$_realver"

snapshot() {
	mkdir -p "$srcdir" && cd "$srcdir"

	local r=
	for r in system/core system/extras external/libselinux external/f2fs-tools; do
		local n="${r##*/}.git"
		local f=$pkgname-"${r##*/}"

		if [ -d "$n" ]; then
			git --git-dir $n fetch || return 1
		else
			git clone --bare $_giturl/$r || return 1
		fi

		git --git-dir $n archive --prefix ${f#$pkgname-}/ -o "$srcdir"/$f-$_realver.tar.gz $_gittag
		scp "$srcdir"/$f-$_realver.tar.gz dev.alpinelinux.org:/archive/$pkgname/
	done
}

prepare() {
	cd "$srcdir"
	sed -e 's/f2fs_sparse_file = NULL/f2fs_sparse_file = 0/g' \
		-i extras/f2fs_utils/f2fs_utils.c || return 1
}

build() {
	make -C "$srcdir"
}

package() {
	make DESTDIR="$pkgdir" \
		-C "$srcdir" install
}

md5sums="872508bf26b5e3cb04aa73d4ba558d9d  android-tools-core-5.1.1_r13.tar.gz
c1451c39af87f6e59330f222f69e143f  android-tools-extras-5.1.1_r13.tar.gz
e6eb1bb16898e4ef2000f0dab4e921bd  android-tools-libselinux-5.1.1_r13.tar.gz
9087604b3553d1e6f5070f72b9299ec5  android-tools-f2fs-tools-5.1.1_r13.tar.gz
fab5e5dda238b0658d241029894a2da7  Makefile"
sha256sums="d3ce45dafe5d5388ad6092186753c5482993a81995fb44ffb24bbe756f996c9e  android-tools-core-5.1.1_r13.tar.gz
08487b9009067dba2ccd436330873350b9a556fe0a19bd191468e145f99fd14c  android-tools-extras-5.1.1_r13.tar.gz
d010434fe8dffe7e7bd649c3b071fd21676b17b861457055637451d3fdb418bb  android-tools-libselinux-5.1.1_r13.tar.gz
f9a4c9747bbebbdde5b712e9aac644d8af2b1c8ab2ef340c22824c3e64fa3f49  android-tools-f2fs-tools-5.1.1_r13.tar.gz
7913d8ba35873e8224e2efe38f035d2eaebfd24fcdf06c4ea6d0795a4010192d  Makefile"
sha512sums="46081c68fb9907ac454ffbb6d9c783eec31a112b9a87d0fd77f6b5cba3b1b6ccc1f9c05b05699d0fe3f6fb82e71900ecf5b4813fdae393f02ff518c5a7500ad6  android-tools-core-5.1.1_r13.tar.gz
318a8ea0dc9b956d329405eb807d61972579ea04ec1692ea0b1c7f273339a14353f52f15b4f5f5e61357fee1cf010ddee116ef8b6428a76de8c4adbba23900a1  android-tools-extras-5.1.1_r13.tar.gz
2f301ebbe079eff510df3312b6d63bdd6e456c0e418f6a94a6718f5560f94c402851dcf5edfda71315570fd6a8fcd6306d8c640a74ee36efb39e73318e8d570f  android-tools-libselinux-5.1.1_r13.tar.gz
9bc54d777f4ead1878e389932f1b60027b146a6a1afa78f187e20dd473826b8a02dbadaced87ef3f764941712f99c81e8113cc6e5cb1f0e7975c7af747d7c3aa  android-tools-f2fs-tools-5.1.1_r13.tar.gz
07aedfba9a401e329aa7790b696b43f4d6993cbaa9cd6f5022b4bcd79c55b7cf8394fd812c697d9837496d1d5bda0db8912f4d8f460b9f6a834ce590aab05476  Makefile"
