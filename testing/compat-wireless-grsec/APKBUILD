# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

_flavor=grsec
_realname=compat-wireless
# source the kernel version
if [ -f ../../main/linux-$_flavor/APKBUILD ]; then
	. ../../main/linux-$_flavor/APKBUILD
fi
_kernelver=$pkgver-r$pkgrel

pkgname=${_realname}-${_flavor}
pkgver=2.6.30
pkgrel=0
pkgdesc="$_flavor kernel backported wifi drivers"
url="http://linuxwireless.org/en/users/Download/stable/"
license="GPL-2"
depends="linux-${_flavor}=${_kernelver}"
install=
makedepends="linux-${_flavor}-dev=${_kernelver}"
subpackages=
source="http://www.orbit-lab.org/kernel/compat-wireless-2.6-stable/v$pkgver/compat-wireless-$pkgver.tar.bz2
	makefile.patch
	"

build() {
	local _abi_release=$(cat /usr/share/linux-$_flavor/kernel.release)
	cd "$srcdir"/$_realname-$pkgver
	patch -p1 -i ../makefile.patch || return 1
	unset ARCH
	make KLIB="/lib/modules/${_abi_release}" DEPMOD=: MODPROBE=: \
		|| return 1
	make KLIB="/lib/modules/${_abi_release}" DEPMOD=: MODPROBE=: \
		DESTDIR="$pkgdir" install-kernel || return 1
}
md5sums="d1e4d0f2b30ffe2931c6fad8d6607e17  compat-wireless-2.6.30.tar.bz2
9ad34341eeaccb739c6f8e638af67088  makefile.patch"
