# Contributor: Danilo Godec <danilo.godec@agenda.si>
# Maintainer:
_flavor=grsec
_realname=openswan
pkgname="$_realname-$_flavor"
pkgver=2.6.35
pkgrel=0
pkgdesc="IPsec Implementation which Allows Building of VPNs"
url="http://www.openswan.org/"
arch="all"
license="GPL"
depends=""
depends_dev="gmp-dev bison flex linux-grsec-dev"
makedepends="$depends_dev"
install=""
source="http://www.openswan.org/download/$_realname-$pkgver.tar.gz"

_builddir="$srcdir"/$_realname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	# make INC_RCDEFAULT=/etc/init.d INC_USRLOCAL=/usr programs || return 1
	export GCC_SPECS=/usr/share/gcc/hardenednopie.specs
	export INSTALL_MOD_PATH="$pkgdir"
	export INSTALL_MOD_DIR=misc
	make KERNELSRC=/lib/modules/`uname -r`/build module || return 1
}

package() {
	cd "$_builddir"
	make INC_RCDEFAULT=/etc/init.d INC_USRLOCAL=/usr DESTDIR="$pkgdir" minstall
}

md5sums="7909a251fbbb807914545b7f42437013  openswan-2.6.35.tar.gz"
