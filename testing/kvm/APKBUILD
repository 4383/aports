# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=kvm
pkgver=87
pkgrel=0
pkgdesc="kernel-based virtual machine"
url="http://www.linux-kvm.org/"
license='GPL'
depends=
makedepends="ncurses-dev linux-grsec-dev pciutils-dev alsa-lib-dev curl-dev"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz"
subpackages=""

build() {
	cd "$srcdir/$pkgname-$pkgver"

	# lets use kernel modules from mainline kernel
	rm -r kvm/kernel

	# we need -lrt linker flag for uclibc
	sed -i -e 's/^LIBS+=-lz/LIBS+=-lz -lrt/' Makefile.target || return 1

	./configure --prefix=/usr \
		--extra-ldflags=-nopie \
		--disable-nptl \
		--audio-drv-list="alsa oss" \
		--disable-sdl 

	make || return 1
	make DESTDIR="$pkgdir"/ kcmd="#" install
}

md5sums="a03ccefb0d096f8efee2b07b56555b33  kvm-87.tar.gz"
