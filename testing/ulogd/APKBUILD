# Contributor: Carlo Landmeter <clandmeter@gmail.com>
pkgname=ulogd
pkgver=2.0.0_beta3
_pkgver=2.0.0beta3
pkgrel=0
pkgdesc="A userspace logging daemon for netfilter/iptables related logging"
url="http://netfilter.org/projects/ulogd/index.html"
license="GPL"
depends="libnfnetlink libnetfilter_conntrack libnetfilter_log"
makedepends="sqlite-dev mysql-dev postgresql-dev libpcap-dev libnfnetlink-dev
libnetfilter_conntrack-dev libnetfilter_log-dev pkgconfig openssl-dev"
subpackages="$pkgname-doc $pkgname-dev $pkgname-sqlite $pkgname-pgsql $pkgname-mysql"
source="http://netfilter.org/projects/ulogd/files/ulogd-2.0.0beta3.tar.bz2
	ulogd.initd"

build() {
	cd "$srcdir/$pkgname-$_pkgver"

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info
	make || return 1
	make DESTDIR="$pkgdir" install
	install -Dm644 ulogd.conf "$pkgdir"/etc/ulogd.conf
	install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
}

sqlite() {
	depends="$pkgname sqlite"
	mkdir -p "$subpkgdir"/usr/lib/ulogd/
	mv "$pkgdir"/usr/lib/ulogd/ulogd_output_SQLITE3.so "$subpkgdir"/usr/lib/ulogd/
}

pgsql() {
        depends="$pkgname libpq"
	mkdir -p "$subpkgdir"/usr/lib/ulogd/
	mv "$pkgdir"/usr/lib/ulogd/ulogd_output_PGSQL.so "$subpkgdir"/usr/lib/ulogd/
}

mysql() {
        depends="$pkgname libmysqlclient openssl"
        mkdir -p "$subpkgdir"/usr/lib/ulogd/
        mv "$pkgdir"/usr/lib/ulogd/ulogd_output_MYSQL.so "$subpkgdir"/usr/lib/ulogd/
}


md5sums="be8137d3b7ae70ebbce7ca8852b9e901  ulogd-2.0.0beta3.tar.bz2
5f5eb551b60591aed49376ed2fa149be  ulogd.initd"
