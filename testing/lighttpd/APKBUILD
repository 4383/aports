pkgname=lighttpd
pkgver=1.4.20
pkgrel=1
pkgdesc="a secure, fast, compliant and very flexible web-server"
url="http://www.lighttpd.net/"
license="custom"
install="$pkgname.install"
depends="pcre openssl zlib bzip2 lua"
makedepends="flex pcre-dev openssl-dev zlib-dev bzip2-dev lua-dev pkgconfig"
source="http://www.$pkgname.net/download/$pkgname-$pkgver.tar.bz2
	$pkgname.initd
	$pkgname.confd
	$pkgname.install
	$pkgname.logrotate"
subpackages="$pkgname-dev $pkgname-doc"

build () 
{ 
	cd $srcdir/$pkgname-$pkgver
	./configure --prefix=/usr \
		--enable-lfs \
		--libdir=/usr/lib/lighttpd \
		--without-mysql \
		--without-ldap \
		--without-attr \
		--without-kerberos5 \
		--without-fam \
		--without-webdav-props \
		--without-webdav-locks \
		--without-gdbm \
		--without-memcache \
		--with-bzip2 \
		--with-openssl \
		--with-lua || return 1
	make || return 1
	make DESTDIR="$pkgdir" install || return 1
	install -D -m755 ../lighttpd.initd $pkgdir/etc/init.d/lighttpd
	install -D -m644 ../lighttpd.logrotate $pkgdir/etc/logrotate.d/lighttpd
	install -d -m755 $pkgdir/var/run/lighttpd/
	install -d -m755 $pkgdir/var/log/lighttpd/
	install -D -m644 doc/lighttpd.conf $pkgdir/etc/lighttpd/lighttpd.conf
	sed 	-e 's|/srv/www/htdocs/|/srv/http/|' \
		-e 's|/srv/www/|/srv/http/|' \
		-e 's|#server.username.*|server.username            = "lighttpd"|' \
		-e 's|#server.groupname.*|server.groupname           = "lighttpd"|' \
		-e 's|#server.pid-file.*|server.pid-file            = "/var/run/lighttpd/lighttpd.pid"|' \
		-e 's|/usr/local/bin/php-cgi|/usr/bin/php-cgi|' \
		-i ${pkgdir}/etc/lighttpd/lighttpd.conf || return 1
}
md5sums="ed6ee0bb714f393219a32768d86984d8  lighttpd-1.4.20.tar.bz2
6910842e8ba496e8aa984ab30a46eb72  lighttpd.initd
0dede109282bfe685bdec6b35f0e4b6b  lighttpd.confd
43b7be0663ee373047f17ec14def5d21  lighttpd.install
ad091c9157134890499f26d170352c9f  lighttpd.logrotate"
