# Contributor: Michael Mason <ms13sp@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=opensips
pkgver=1.5.0
pkgrel=3
pkgdesc="Flexible and customizable sip routing engine"
url="http://www.opensips.org/"
license="GPL"
depends="uclibc expat"
makedepends="bison flex expat-dev coreutils"
install="$pkgname.pre-install $pkgname.post-install"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver-notls_src.tar.gz
	$install
	$pkgname.initd"

build() {
	cd "$srcdir/$pkgname-$pkgver-notls"
	sed -i -e 's:^cfg-target.*:cfg-target = $(cfg-dir):' \
		-e 's:^cfg-prefix.*:cfg-prefix = $(basedir):' Makefile.defs

	cd scripts
	sed -i -e 's:/var/run/opensips.pid:/var/run/opensips/opensips.pid:g' \
		opensipsctl.base opensipsctlrc osipsconsole osipsconsolerc
	cd ..

	make prefix=/usr || return 1
	make prefix=/usr basedir="$pkgdir" install
	chmod 750 "$pkgdir"/etc/opensips/opensips.cfg
	install -d "$pkgdir"/var/run/opensips
	install -Dm755 ../$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
}

md5sums="ba99592a6e42e8b4dc2d38964420dfec  opensips-1.5.0-notls_src.tar.gz
3a8a5d3c4c23ce9f2fc60b449ad61820  opensips.pre-install
d9b551148d2b60466c05b4295b935091  opensips.post-install
6606574b4872cbc5114e490f962ca096  opensips.initd"
