# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=keybase-client
pkgver=1.0.9_p1
_ver=${pkgver/_p/-}
pkgrel=0
pkgdesc="Keybase command line client"
url="https://github.com/keybase/client"
arch="all"
license="BSD"
depends=""
depends_dev=""
makedepends="$depends_dev go"
install=""
subpackages=""
options="!strip"
source="$pkgname-$pkgver.tar.gz::https://github.com/keybase/client/archive/v${_ver}.tar.gz"

_builddir="$srcdir"/client-$_ver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$srcdir"
	export GOPATH="$PWD"
	export GO15VENDOREXPERIMENT=1

	mkdir -p src/github.com/keybase
	cp -r "$srcdir"/client-$_ver src/github.com/keybase/client
	cd src/github.com/keybase/client/go/keybase
	go build -v -a -tags production -o "$srcdir"/keybase
}

package() {
	install -Dm755 "$srcdir"/keybase "$pkgdir"/usr/bin/keybase || return 1
}

md5sums="747375ebaaab12e1a65c5bec9eaca1b0  keybase-client-1.0.9_p1.tar.gz"
sha256sums="24bbd10e54cb489882c8c72e5f89e01df90d0ef91547311516f7397f4c04bf00  keybase-client-1.0.9_p1.tar.gz"
sha512sums="26c7d53d70c3b3ac9019c77173f7e8679a866dcfb44247e657d12d2d11d85662f2f56a5e6babb4453c3784652d774c28c9a89e2da9679f9153e98a4d6c2d41c7  keybase-client-1.0.9_p1.tar.gz"
