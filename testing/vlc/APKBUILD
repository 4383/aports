# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=vlc
pkgver=1.0.0
pkgrel=0
pkgdesc="A multi-platform MPEG, VCD/DVD, and DivX player"
url="http://www.videolan.org/vlc/"
license="GPL-2"
subpackages="$pkgname-dev $pkgname-doc"
#depends="libnotify a52dec fluidsynth zvbi libdvbpsi lirc-utils libdca hal 
#	libproxy sdl_image libdvdnav>=4.1.3 lua libxv libv4l libcddb smbclient
#	libmatroska taglib sysfsutils libmpcdec ffmpeg>=0.5 libshout libmad
#	qt fribidi libmpeg2 libmodplug avahi ttf-dejavu"
depends="ttf-dejavu"
makedepends="
	a52dec-dev
	alsa-lib-dev
	dbus-dev
	ffmpeg-dev
	fribidi-dev
	gtk+-dev
	libgcrypt-dev
	libice-dev
	libiconv-dev
	libmad-dev
	libmpeg2-dev
	libnotify-dev
	libogg-dev
	libsm-dev
	libx11-dev
	libxext-dev
	libxv-dev
	lua-dev
	mesa-dev
	pkgconfig
	sdl-dev
	sysfsutils-dev
	x264-dev
	"
source="http://download.videolan.org/pub/videolan/$pkgname/$pkgver/$pkgname-$pkgver.tar.bz2
	uclibc.patch
	"

build ()
{
	cd "$srcdir"/$pkgname-$pkgver
	sed -i -e 's:/usr/share/fonts/truetype/freefont/FreeSerifBold.ttf:/usr/share/fonts/TTF/DejaVuSerif-Bold.ttf:' modules/misc/freetype.c

	patch -p1 < ../uclibc.patch || return 1
	export CFLAGS="$CFLAGS -D_GNU_SOURCE"

	./configure --prefix=/usr \
		--disable-mmx \
		--disable-nls \
		--disable-optimizations \
		--disable-qt4 --disable-skins2 \
		--disable-rpath \
		--enable-httpd \
		--enable-realrtsp \
		--enable-sout \
		--enable-vlm \
		|| return 1

#		--enable-dvdread \
#		--enable-dvdnav \
#		--enable-qt4 \
#		--enable-faad \
#		--enable-skins2 \
#		--enable-dvb \
#		--enable-v4l \
#		--enable-theora \
#		--enable-flac \
#		--enable-snapshot \
#		--enable-hal \
#		--enable-dbus \
#		--enable-dbus-control \
#		--enable-lirc \
#		--enable-shout \
#		--enable-pvr \

	make || return 1
	make DESTDIR="$pkgdir"/ install || return 1
	for res in 16 32 48 128; do
		install -D -m644 share/vlc${res}x${res}.png \
			"$pkgdir"/usr/share/icons/hicolor/${res}x${res}/apps/vlc.png || return 1
	done
	rm -rf "$pkgdir"/usr/lib/mozilla
}

md5sums="fc78904ab5fa73f518d8fe4e852e7f67  vlc-1.0.0.tar.bz2
2a16bf6c14a94f41490872aa189db755  uclibc.patch"
