# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=tarantool
pkgver=1.7.4.99
pkgrel=0
pkgdesc="Lua application server integrated with a database management system"
url="https://tarantool.org"
arch="all"
license="BSD-2-Clause"
pkgusers="$pkgname"
pkggroups="$pkgname"
install="$pkgname.pre-install"
depends=""
depends_dev=""
makedepends="cmake ncurses-dev readline-dev zlib-dev yaml-dev libressl-dev
	perl msgpuck-dev $depends_dev
	"
subpackages="$pkgname-dev $pkgname-doc"
source="http://download.tarantool.org/tarantool/1.7/src/tarantool-$pkgver.tar.gz
	$pkgname.initd
	$pkgname.pre-install
	"
builddir="$srcdir/tarantool-$pkgver"

build() {
	cd "$builddir"
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_SYSCONFDIR=/etc \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		-DENABLE_BUNDLED_LIBYAML=OFF \
		-DENABLE_BUNDLED_MSGPUCK=OFF \
		-DCMAKE_SKIP_RPATH=ON \
		-DENABLE_DIST=ON \
		-DWITH_SYSVINIT=OFF \
		-DWITH_SYSTEMD=OFF 
	make
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	install -Dm755 "$srcdir"/tarantool.initd "$pkgdir"/etc/init.d/tarantool
}

check() {
	"$builddir"/src/tarantool --help > /dev/null
}

sha512sums="aa62258c18495ca472996c16067dabc94044dcc2edfafd19c147b2093cc7806965e0998ec5ce79d99fd7a93def97b6ca28656de7c2a635d1d5e11f20b387773e  tarantool-1.7.4.99.tar.gz
fe463c4b6ab8708ea6ec17bb6a887677ae131a489d2ce299ce951790b7c134ff356bc1a4d4745878beec3600ec702944c2329a3f02645f8ab0a0eb24edb6215a  tarantool.initd
f0673de6267e68a6f6638286447613b7d00dc86bc6153bead1127160f07c663cbbbfd52582d739d6b07041fdcec4608098ffcbd88ad33cfe13b2d80c7f29c7c1  tarantool.pre-install"
