# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@alpinelinux.org>

pkgname=uptimed
pkgver=0.3.17
pkgrel=0
pkgdesc='System uptime record daemon'
arch="all"
url='http://podgorny.cz/uptimed/'
license='GPL'
makedepends='autoconf libtool'
source="http://podgorny.cz/$pkgname/releases/$pkgname-$pkgver.tar.bz2
        uptimed.init"

prepare() {
  cd "$srcdir"/$pkgname-$pkgver

  for M in M*; do
    sed -i "s|/var/spool/uptimed|/var/log/uptimed|" $M
  done
  sed -i 's|spool|log|' libuptimed/urec.h 
  sed -i 's|AM_CONFIG_HEADER|AC_CONFIG_HEADER|g' configure.ac

  autoreconf
  libtoolize --force
}

build() {
  cd "$srcdir"/$pkgname-$pkgver
  ./configure --prefix=/usr --sysconfdir=/etc
  make
}

package() {
  cd "$srcdir"/$pkgname-$pkgver
  make install DESTDIR="$pkgdir"
  rm "$pkgdir"/usr/lib/libuptimed.la

  mv "$pkgdir"/etc/uptimed.conf-dist "$pkgdir"/etc/uptimed.conf
  install -Dm755 "$srcdir"/uptimed.init "$pkgdir"/etc/init.d/uptimed
}
md5sums="528b62c33454b33537c3bf2366977bdb  uptimed-0.3.17.tar.bz2
c79ad78e6a20b35a62d5ee019a39bce4  uptimed.init"
sha256sums="524ce8984c0d0a780a32025ba3ffb980e5eec3d78e65cf68c91edec7fe833a06  uptimed-0.3.17.tar.bz2
687589dbae26e42af4d0693baad6ac86270b5eb2d2f5fcbacf3554a6cbd24f85  uptimed.init"
sha512sums="d462fa435b07bc335738dfccddd374aaa94fe2671a652afb8cb85d5e69e2148c296dec2a575ef074675e64e5453cb2d0807f80b191d9aeb5233168a617e842c5  uptimed-0.3.17.tar.bz2
513cffb666c821d60a2a1d5bbb36b854bff84c4249d8ac27779e82b5ca9e9824aa432c0812d247c469e9a9ab4dadf104cddaa8224b891e39d0a2c0ebc409134e  uptimed.init"
