# Contributor: Jeff Bilyk <jbilyk@alpinelinux.org>
# Maintainer:
pkgname=apache-mod-auth-radius
_pkgname=mod_auth_radius
pkgver=1.5.8
pkgrel=0
pkgdesc="Apache authentication module to become RADIUS client for AAA requests"
url="http://freeradius.org/mod_auth_radius/"
arch="all"
license="GPL"
depends="apache2"
makedepends="apache2-dev freeradius-dev"
install=""
source="ftp://ftp.freeradius.org/pub/radius/$_pkgname-$pkgver.tar
	mod-auth-radius.conf
	remote-ip.patch"

_builddir="$srcdir"/$_pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	apxs -c mod_auth_radius-2.0.c 
}

package() {
	cd "$_builddir"
	mkdir -p "$pkgdir"/etc/apache2/conf.d
	mkdir -p "$pkgdir"/usr/lib/apache2
	/usr/share/apache2/build/instdso.sh SH_LIBTOOL='/usr/share/build-1/libtool' mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	/usr/share/build-1/libtool --mode=install install mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	install -D -m644 ../../mod-auth-radius.conf "$pkgdir"/etc/apache2/conf.d/mod-auth-radius.conf
	rm "$pkgdir"/usr/lib/apache2/*.la
}

md5sums="87d8ef049736254cc09f8b34667f0e59  mod_auth_radius-1.5.8.tar
b0e6eb036f57f06972e626dc9ddf4983  mod-auth-radius.conf
8a68838a41b3dc32ab6f4adc58439a3b  remote-ip.patch"
