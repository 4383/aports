# Maintainer: Timo Ter√§s <timo.teras@iki.fi>
pkgname=omxplayer
pkgver=0.20140922
_commitid=6ee9a0a5488119786990b6f91990d59d6e35427c
pkgrel=0
pkgdesc="Commandline OMX player for Raspberry Pi"
url="https://github.com/popcornmix/omxplayer"
arch="armhf"
license="GPLv2"
depends="ttf-dejavu"
makedepends="raspberrypi-dev ffmpeg-dev pcre-dev boost-dev freetype-dev dbus-dev"
install=""
subpackages="$pkgname-doc"
source="omxplayer-$pkgver.tar.gz::https://github.com/popcornmix/omxplayer/archive/$_commitid.tar.gz
	fix-makefile.patch
	default-font.patch
	"

_srcdir="$srcdir"/$pkgname-$_commitid

prepare() {
	local i
	cd "$_srcdir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_srcdir"
	cat <<EOF > Makefile.include
INCLUDES:=-I/opt/vc/include -I/opt/vc/include/interface/vcos/pthreads -I/opt/vc/include/interface/vmcs_host/linux
INCLUDES+=$(pkg-config --cflags freetype2 dbus-1)
LDFLAGS:=-L/opt/vc/lib -Wl,-rpath,/opt/vc/lib
LDFLAGS+=$(pkg-config --libs freetype2 dbus-1)
STRIP:=/usr/bin/strip
EOF
	make omxplayer.bin omxplayer.1
}

package() {
	cd "$_srcdir"
	make install DIST="$pkgdir" || return 1
	rm -rf "$pkgdir"/usr/lib/omxplayer
}

md5sums="abaf77da1d74cc7147291b1167ccc3da  omxplayer-0.20140922.tar.gz
d8f335e1dff4b34faf36c25ad2c2b881  fix-makefile.patch
79197742a37d4493e1224675c6803eba  default-font.patch"
sha256sums="31dd025e169857436ab2bad36322c259f96814144c5d94321c0096078282965e  omxplayer-0.20140922.tar.gz
799b0aba6aef8c665a685777cd912268315309d0d74ce76be5fdfd0dcffbb422  fix-makefile.patch
0d283b33189d6dc4d3a576f6ac2a0ab1285b86a04be555efc139a9296df91631  default-font.patch"
sha512sums="94fb58cbaa67ac0aaf60b0439a216553b03f4c8be5d053f926e50e94ae723bcb717737b9fdafdaed6b9cf66d603359e67e8c5ca888ebe82438cde396253fcde3  omxplayer-0.20140922.tar.gz
3210242f9b834ffec9d3077d5a25caf8be84aa7f4f13c73eb7f61c0a406ec787e4055951fc5a6236f1da7897c95db94a5e11e25d1b3e859a6ea67f31fc6eb517  fix-makefile.patch
70762237e6f6d810da91f8ec46bcc68310d8ff44c6d103c0a77a7c4f6f6a39b1e6440a74799490b0e27a8e50848300a12f701850c3c3475c5497d33802304d0f  default-font.patch"
