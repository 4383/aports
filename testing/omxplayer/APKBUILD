# Maintainer: Timo Ter√§s <timo.teras@iki.fi>
pkgname=omxplayer
pkgver=0.20140220
_commitid=7af21f596378e5efeceebedff9c4a298e2d06d98
pkgrel=0
pkgdesc="Commandline OMX player for Raspberry Pi"
url="https://github.com/popcornmix/omxplayer"
arch="armhf"
license="GPLv2"
depends=""
makedepends="raspberrypi-dev ffmpeg-dev pcre-dev boost-dev freetype-dev dbus-dev"
install=""
subpackages="$pkgname-doc"
source="omxplayer-$pkgver.tar.gz::https://github.com/popcornmix/omxplayer/archive/$_commitid.tar.gz
	fix-makefile.patch
	"

_srcdir="$srcdir"/$pkgname-$_commitid

prepare() {
	local i
	cd "$_srcdir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_srcdir"
	cat <<EOF > Makefile.include
INCLUDES:=-I/opt/vc/include -I/opt/vc/include/interface/vcos/pthreads -I/opt/vc/include/interface/vmcs_host/linux
INCLUDES+=$(pkg-config --cflags freetype2 dbus-1)
LDFLAGS:=-L/opt/vc/lib -Wl,-rpath,/opt/vc/lib
LDFLAGS+=$(pkg-config --libs freetype2 dbus-1)
STRIP:=/usr/bin/strip
EOF
	make
}

package() {
	cd "$_srcdir"
	make install DIST="$pkgdir" || return 1
	rm -rf "$pkgdir"/usr/lib/omxplayer
}

md5sums="2e6617526222462a381ea2d2e51b71cb  omxplayer-0.20140220.tar.gz
d2e426af74fc1ccad6f01159c29e46f4  fix-makefile.patch"
sha256sums="02c597538f9c0b7a2372e593e409684b50cceda72fa2f6cae93378acf28a6a78  omxplayer-0.20140220.tar.gz
f7b62b3ac32f0f37710d347ad2a73f3588161d5e2469487bee9fa3c88b444dd9  fix-makefile.patch"
sha512sums="3aae6a6184ce9418cfae82c831f9be8a2529b672ed8597fc12383cb84cffe68de4a5ec489bcc2321a2872e238e610d64a8321f69b795afb921e5dca711cc138e  omxplayer-0.20140220.tar.gz
4efde13e52b129ca04833d50e1195ff9d2901a5de920ca7c2ebeb156db7383ea6fac66f49e450858528eedda63a853d5464fed055b57a3eea906cf6e7c840e55  fix-makefile.patch"
