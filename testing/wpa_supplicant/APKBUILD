# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=wpa_supplicant
pkgver=0.6.9
pkgrel=0
pkgdesc="A utility providing key negotiation for WPA wireless networks"
url="http://hostap.epitest.fi/wpa_supplicant"
license="GPL"
subpackages="$pkgname-doc"
depends=
makedepends="openssl-dev dbus-dev"
source="http://hostap.epitest.fi/releases/$pkgname-$pkgver.tar.gz
	defconfig
	"

build() { 
	cd "$srcdir"/$pkgname-$pkgver/$pkgname
	cp "$srcdir"/defconfig .config
	sed -i 's@/usr/local@$(PREFIX)@g' Makefile
	sed -i 's@dynamic_eap_methods@@g' Makefile
	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver/$pkgname
	make PREFIX=/usr DESTDIR="$pkgdir" install || return 1
	install -Dm644 wpa_supplicant.conf "$pkgdir"/etc/wpa_supplicant.conf
	install -Dm644 doc/docbook/wpa_supplicant.conf.5 \
		"$pkgdir"/usr/share/man/man5/wpa_supplicant.conf.5 || return 1
	
	for i in wpa_background wpa_cli wpa_passphrase wpa_supplicant; do
		install -Dm644 doc/docbook/$i.8 \
			"$pkgdir"/usr/share/man/man8/$i.8 || return 1
	done
	install -m755 -d "$pkgdir"/usr/share/dbus-1/system-services
	sed -e 's/sbin/usr\/sbin/' -i dbus-wpa_supplicant.service 
	install -m644 dbus-wpa_supplicant.service \
		"$pkgdir"/usr/share/dbus-1/system-services/fi.epitest.hostap.WPASupplicant.service || return 1
	install -m755 -d "$pkgdir"/etc/dbus-1/system.d
	install -m644 dbus-wpa_supplicant.conf "$pkgdir"/etc/dbus-1/system.d/fi.epitest.hostap.WPASupplicant.conf || return 1
}
md5sums="0efb8fcedf0a8acf6f423dfdb0658fdd  wpa_supplicant-0.6.9.tar.gz
5bff1c58cf6c01cdf6274bf4392e714a  defconfig"
