# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=openldap
pkgver=2.4.11
pkgrel=0
pkgdesc="LDAP Server"
url="http://www.openldap.org/"
license="custom"
depends="db openssl uclibc"
makedepends="db-dev openssl-dev groff"
subpackages="$pkgname-dev $pkgname-doc libldap"
source="ftp://ftp.$pkgname.org/pub/OpenLDAP/$pkgname-release/$pkgname-$pkgver.tgz
	openldap-2.4-ppolicy.patch
	openldap-2.4.11-libldap_r.patch
	"

# berkdb crypt ipv6 ssl 
build () {
	cd "$srcdir"/$pkgname-$pkgver

	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done

	./configure --prefix=/usr \
		--libexecdir=/usr/sbin \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var/lib/openldap \
		--enable-slapd \
		--enable-bdb \
		--enable-hdb \
		--enable-crypt \
		--enable-dynamic \
		--enable-dnssrv=mod \
		--enable-ldap=mod \
		--enable-meta=mod \
		--enable-monitor=mod \
		--enable-null=mod \
		--enable-passwd=mod \
		--enable-relay=mod \
		--enable-shell=mod \
		--enable-sock=mod \
		--with-tls=openssl 
	
	make || return 1
	make DESTDIR="$pkgdir" install
}

libldap() {
	depends="uclibc openssl"
	pkgdesc="OpenLDAP libraries"
	mkdir -p "$subpkgdir"/usr "$subpkgdir"/etc/openldap
	mv "$pkgdir"/usr/lib "$subpkgdir"/usr/
	mv "$pkgdir"/etc/openldap/ldap.conf "$subpkgdir"/etc/openldap/
}

md5sums="920fedbbb5bc61c2ca52c56edeef770a  openldap-2.4.11.tgz
2524e490ba334a760fa57057c16da7a9  openldap-2.4-ppolicy.patch
d19d0502f046078ecd737e29e7552fa8  openldap-2.4.11-libldap_r.patch"
