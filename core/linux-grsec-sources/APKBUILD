# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
_suff=grsec
pkgname=linux-$_suff-sources
pkgver=2.6.28.9
pkgdesc="Linux kernel sources with grsecurity patch"
_kernver=2.6.28
_grsecver=2.1.13-$_kernver.8-200903191958
pkgrel=0
options="!strip"
license=GPL-2
url=http://kernel.org
source="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-$_kernver.tar.bz2
	ftp://ftp.kernel.org/pub/linux/kernel/v2.6/patch-$pkgver.bz2
	http://www.grsecurity.net/test/grsecurity-$_grsecver.patch
	0001-linux-2.6.28.5-ipgre-strict-binding.patch
	0002-linux-2.6.28.5-ipgre-optimize-hash-lookup.patch
	"

build() {
	cd $srcdir/linux-$_kernver
	if [ "$_kernver" != "$pkgver" ]; then
		bunzip2 -c < ../patch-$pkgver.bz2 | patch -p1 || return 1
	fi

	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done

	mkdir -p "$pkgdir/usr/src"
	cd "$srcdir"
	mv "linux-$_kernver" "$pkgdir/usr/src/linux-$pkgver-$_suff"
}

md5sums="d351e44709c9810b85e29b877f50968a  linux-2.6.28.tar.bz2
27a43f76cf4b90db18df6d1c5e72789b  patch-2.6.28.9.bz2
e98fdd8e286579c61822ef264b56dee4  grsecurity-2.1.13-2.6.28.8-200903191958.patch
7673b4521283ad41434a18ca18b16ad8  0001-linux-2.6.28.5-ipgre-strict-binding.patch
8f405c738b150c532c46eaad5390cca2  0002-linux-2.6.28.5-ipgre-optimize-hash-lookup.patch"
