_suff=grsec
pkgname=linux-$_suff-sources
pkgver=2.6.26.7
pkgdesc="Linux kernel sources with grsecurity patch"
_kernver=2.6.26
_grsecver=2.1.12-2.6.26.6-200810131006
pkgrel=1
makedepends=patch
arch=i486
license=GPL-2
url=http://kernel.org
source="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-$_kernver.tar.bz2
	ftp://ftp.kernel.org/pub/linux/kernel/v2.6/patch-$pkgver.bz2
	http://www.grsecurity.net/test/grsecurity-$_grsecver.patch
	"

build() {
	cd $srcdir/linux-$_kernver
	if [ "$_kernver" != "$pkgver" ]; then
		bunzip2 -c < ../patch-$pkgver.bz2 | patch -p1 || return 1
	fi

	patch -p1 < ../grsecurity-$_grsecver.patch || return 1

	mkdir -p "$pkgdir/usr/src"
	cd "$srcdir"
	mv "linux-$_kernver" "$pkgdir/usr/src/linux-$pkgver-$_suff"
}

md5sums="5169d01c405bc3f866c59338e217968c  linux-2.6.26.tar.bz2
70e7706e289f759925f6474f26c74b89  patch-2.6.26.7.bz2
5398417243c0abbcd8d94f5e52eff4bc  grsecurity-2.1.12-2.6.26.6-200810131006.patch"
