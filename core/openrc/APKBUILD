# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=openrc
pkgver=0.4.3
pkgrel=3
pkgdesc="OpenRC manages the services, startup and shutdown of a host"
url="http://roy.marples.name/openrc"
license='BSD-2'
depends="uclibc"
subpackages="$pkgname-doc $pkgname-dev"
install="$pkgname.post-install"
source="http://roy.marples.name/downloads/$pkgname/$pkgname-$pkgver.tar.bz2
	openrc-0.4.3-mkmntdirs.patch
	openrc-gendepends-speedup.patch
	hostname.initd
	keymaps.initd
	modules.initd
	networking.initd
	$install
	"

build() {
	cd "$srcdir/$pkgname-$pkgver"
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done

	make
	make DESTDIR="$pkgdir/" install

	# we cannot have anything turned on by default
	rm -f "$pkgdir"/etc/runlevels/*/*

	rm -f "$pkgdir"/lib/rc/net/* "$pkgdir"/etc/init.d/net.lo

	# we override some of the scripts
	for i in ../*.initd; do
		j=${i##*/}
		install -Dm755 $i "$pkgdir"/etc/init.d/${j%.initd}
	done

}

md5sums="57ca95533e629f06a0775e176e19bdb5  openrc-0.4.3.tar.bz2
8c2c1c2ee0509b63966b7187a2079f4b  openrc-0.4.3-mkmntdirs.patch
dcdcb34591e3d9eaaaf82db736cc5135  openrc-gendepends-speedup.patch
c32e15b0858eef708497e7ee6355a055  hostname.initd
33ca3e558c42cdd17adccbc7807298f7  keymaps.initd
894c7f72448bfd7884314725ed83072a  modules.initd
747168eee535e845179eaef5a3fcb334  networking.initd
6e834194b246563fc5acd77e91e038c4  openrc.post-install"
