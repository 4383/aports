# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xtables-addons
_kernflavor=grsec
_kernver=2.6.28.9
pkgver=1.13
pkgrel=0
pkgdesc="Xtables-addons is the successor to patch-o-matic(-ng)"
url="http://jengelh.medozas.de/projects/xtables/"
license="GPL"
depends="linux-grsec"
makedepends="linux-grsec-dev linux-grsec-sources iptables-dev pkgconfig"
install=
subpackages="$pkgname-doc $pkgname-grsec:mod"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2
	$pkgname-1.12-readlink.patch"

build() {
	local kout="$srcdir"/grsec
	mkdir -p "$kout"
	cd "$kout"
	cp /usr/share/linux-grsec/config .config
	make -C /usr/src/linux-$_kernver-grsec O=$PWD silentoldconfig \
		|| return 1
	make modules_prepare

	cd "$srcdir/xtables-addons-$pkgver"
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return
	done

	./configure --prefix=/usr \
		--with-kbuild="$kout"

	make || return 1
	make DESTDIR="$pkgdir" install
}

md5sums="7c9cd60a00c2d4b9bed76cf4cec22fa1  xtables-addons-1.13.tar.bz2
22bb434696be0960a6c758de17420e18  xtables-addons-1.12-readlink.patch"
