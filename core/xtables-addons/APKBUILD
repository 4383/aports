# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xtables-addons
_kernflavor=grsec
_kernver=2.6.28.5
pkgver=1.9
pkgrel=0
pkgdesc="Xtables-addons is the successor to patch-o-matic(-ng)"
url="http://jengelh.medozas.de/projects/xtables/"
license="GPL"
depends="linux-grsec"
makedepends="linux-grsec-dev linux-grsec-sources iptables-dev"
install=
subpackages="$pkgname-doc $pkgname-grsec:mod"
source="http://dev.medozas.de/files/xtables/xtables-addons-$pkgver.tar.bz2
	$pkgname-1.9-readlink.patch"

build() {
	local kout="$srcdir"/grsec
	mkdir -p "$kout"
	cd "$kout"
	cp /usr/share/linux-grsec/config .config
	make -C /usr/src/linux-$_kernver-grsec O=$PWD silentoldconfig \
		|| return 1
	make modules_prepare

	cd "$srcdir/xtables-addons-$pkgver"
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return
	done

	./configure --prefix=/usr \
		--with-kbuild="$kout"

	make || return 1
	make DESTDIR="$pkgdir" install
}

md5sums="578176c969a70858bfc06d9ee3b5dbda  xtables-addons-1.9.tar.bz2
eb9b3874ba74a291627898e537e2e8ab  xtables-addons-1.9-readlink.patch"
