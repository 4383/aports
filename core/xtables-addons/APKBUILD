# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
_kflavor=${FLAVOR:-grsec}
_kernver=2.6.28.9

pkgname=xtables-addons
pkgver=1.14
pkgrel=1
pkgdesc="Xtables-addons is the successor to patch-o-matic(-ng)"
url="http://jengelh.medozas.de/projects/xtables/"
license="GPL"
depends="linux-$_kflavor"
makedepends="linux-${_kflavor}-dev linux-${_kflavor}-sources iptables-dev pkgconfig"
install=
subpackages="$pkgname-doc $pkgname-${_kflavor}:mod"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2
	$pkgname-1.12-readlink.patch"

build() {
	local kout="$srcdir"/$_kflavor
	mkdir -p "$kout"
	cd "$kout"
	cp /boot/config-$_kflavor .config || return 1
	cp /boot/Module.symvers-$_kflavor Module.symvers || return 1
	make -C /usr/src/linux-$_kernver-$_kflavor O=$PWD silentoldconfig \
		|| return 1
	make modules_prepare

	cd "$srcdir/$pkgname-$pkgver"
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return
	done

	./configure --prefix=/usr \
		--with-kbuild="$kout"

	make CC="$CC" || return 1
	make DESTDIR="$pkgdir" install
}

md5sums="a17b178d137480b870a7aeb54aea44f8  xtables-addons-1.14.tar.bz2
22bb434696be0960a6c758de17420e18  xtables-addons-1.12-readlink.patch"
