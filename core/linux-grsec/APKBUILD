# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=linux-grsec
pkgver=2.6.26.8
pkgrel=2
pkgdesc="Linux kernel with grsecurity"
url=http://grsecurity.net
arch=i486
makedepends="$pkgname-sources perl"
source="kernelconfig"
subpackages="$pkgname-mod"
license=GPL-2

build() {
	mkdir -p "$srcdir/$pkgname"
	cd "$srcdir/$pkgname"
	cp ../kernelconfig .config
	make -C /usr/src/linux-$pkgver-grsec "O=$PWD" silentoldconfig
	make || return 1

	mkdir -p $pkgdir/boot $pkgdir/lib/modules
	make modules_install install \
		INSTALL_MOD_PATH=$pkgdir \
		INSTALL_PATH=$pkgdir/boot
	mv "$pkgdir"/boot/vmlinuz "$pkgdir"/boot/${pkgname#linux-}
}

md5sums="7bff4dd7b5f8ef83e6a3c2e2e5d5fbec  kernelconfig"
