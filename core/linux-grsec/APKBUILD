# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=linux-grsec
pkgver=2.6.28.5
pkgrel=0
pkgdesc="Linux kernel with grsecurity"
url=http://grsecurity.net
arch=i486
makedepends="$pkgname-sources perl"
source="kernelconfig"
subpackages="$pkgname-mod $pkgname-dev"
license=GPL-2

build() {
	mkdir -p "$srcdir/$pkgname"
	cd "$srcdir/$pkgname"
	cp ../kernelconfig .config
	make -C /usr/src/linux-$pkgver-grsec "O=$PWD" silentoldconfig
	make || return 1

	mkdir -p $pkgdir/boot $pkgdir/lib/modules
	make modules_install install \
		INSTALL_MOD_PATH=$pkgdir \
		INSTALL_PATH=$pkgdir/boot
	cd "$pkgdir"/boot
	mv vmlinuz ${pkgname#linux-}
	mv System.map System-${pkgname#linux-}.map
}

dev()  {
	install -Dm644 "$srcdir/kernelconfig" \
		"$subpkgdir"/usr/share/$pkgname/config
}

md5sums="ce38feed44b24776e7befb92eedbe959  kernelconfig"
