# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
_flavor=grsec
pkgname=linux-$_flavor
pkgver=2.6.28.9
pkgrel=4
pkgdesc="Linux kernel with grsecurity"
url=http://grsecurity.net
arch=i486
makedepends="$pkgname-sources perl"
source="kernelconfig"
subpackages="$pkgname-mod $pkgname-dev"
license=GPL-2

build() {
	mkdir -p "$srcdir/$pkgname"
	cd "$srcdir/$pkgname"
	cp ../kernelconfig .config
	make -C /usr/src/linux-$pkgver-grsec "O=$PWD" HOSTCC="$CC" \
		silentoldconfig
	make CC="$CC" || return 1

	mkdir -p $pkgdir/boot $pkgdir/lib/modules
	make modules_install install \
		INSTALL_MOD_PATH=$pkgdir \
		INSTALL_PATH=$pkgdir/boot
	cd "$pkgdir"/boot
	mv vmlinuz $_flavor
}

dev()  {
	install -Dm644 "$srcdir"/$pkgname/Module.symvers \
		"$subpkgdir"/boot/Module.symvers-$_flavor
	install -Dm644 "$srcdir/kernelconfig" \
		"$subpkgdir"/boot/config-$_flavor
	mv "$pkgdir"/boot/System.map "$subpkgdir"/boot/System.map-$_flavor
}

md5sums="2b13beaff480758b99eba6cb2191952b  kernelconfig"
