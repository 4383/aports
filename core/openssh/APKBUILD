# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=openssh
pkgver=5.2_p1
_myver=5.2p1
pkgrel=0
pkgdesc="Port of OpenBSD's free SSH release"
url="http://www.openssh.org/portable.html"
license="as-is"
depends="openssl zlib"
makedepends="openssl-dev zlib-dev"
subpackages="$pkgname-doc"
source="ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/$pkgname-$_myver.tar.gz
	sshd.initd
	sshd.confd
	"

build () 
{ 
	cd $startdir/src/$pkgname-$_myver
	sed -i -e '/_PATH_XAUTH/s:/usr/X11R6/bin/xauth:/usr/bin/xauth:' \
		pathnames.h || return 1

	./configure --prefix=/usr \
		--with-mantype=man \
		--mandir=/usr/share/man \
	        --with-ldflags="${LDFLAGS}" \
	        --disable-strip \
	        --sysconfdir=/etc/ssh \
        	--datadir=/usr/share/openssh \
	        --with-privsep-path=/var/empty \
	        --with-privsep-user=sshd \
	        --with-md5-passwords \
	        --with-ssl-engine \
		--libexecdir=/usr/lib/ssh \
		--without-tcp-wrappers \
		--without-pam

	make || return 1
	make DESTDIR="$pkgdir" install
	mkdir -p "$pkgdir"/var/empty
	install -D -m755 "$srcdir"/sshd.initd "$pkgdir"/etc/init.d/sshd
	install -D -m644 "$srcdir"/sshd.confd "$pkgdir"/etc/conf.d/sshd
}
md5sums="ada79c7328a8551bdf55c95e631e7dad  openssh-5.2p1.tar.gz
f71564ffab359faead63717920c3086b  sshd.initd
b35e9f3829f4cfca07168fcba98749c7  sshd.confd"
