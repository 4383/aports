# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=uclibc
pkgver=0.9.30.1
pkgrel=6
pkgdesc="C library for developing embedded Linux systems"
url=http://uclibc.org
license="LGPL-2"
_mynamever=uClibc-$pkgver

subpackages="$pkgname-dev"
depends_dev="linux-headers"

source="http://uclibc.org/downloads/$_mynamever.tar.bz2
	$pkgname-0.9.30.1-resolv.patch
	uclibc-0.9.30.1-pthread_getattr_np.patch
	0001-ldd-segfault-fix.patch
	ppoll.patch
	uclibcconfig
	"

_prepare() {
	local i gcc_major
	cd "$srcdir/$_mynamever/"
	# patches goes here
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done
}

_compile() {
	cd "$srcdir/$_mynamever/"
	cp ../uclibcconfig .config
	make silentoldconfig
	make || return 1
}

_install() {
	cd "$srcdir/$_mynamever/"
	make install DESTDIR="$pkgdir" install_utils
	install -Dm755 extra/scripts/getent "$pkgdir"/usr/bin/getent
}

build() {
	_prepare && _compile && _install
}

md5sums="1a4b84e5536ad8170563ffa88c34679c  uClibc-0.9.30.1.tar.bz2
ea91460617601b6e084ead66bc3948f5  uclibc-0.9.30.1-resolv.patch
cf80c0d44a41e02f389be427ee615d61  uclibc-0.9.30.1-pthread_getattr_np.patch
4079b20c763727863bc53408e4988434  0001-ldd-segfault-fix.patch
60738298e377295d359768a09adac0bb  ppoll.patch
a4512d5594f1b450ffbf2ff9eda6263b  uclibcconfig"
