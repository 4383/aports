pkgname=uclibc
pkgver=0.9.30_rc3
pkgdesc="C library for developing embedded Linux systems"
url=http://uclibc.org
license="LGPL-2"
_mynamever=uClibc-0.9.30-rc3

subpackages="$pkgname-dev"

source="http://uclibc.org/downloads/$_mynamever.tar.bz2
	uclibcconfig
	69_all_uClibc-0.9.29-fix-gethostent_r-failure-retval.patch
	72_all_uClibc-0.9.29-linuxthreads.patch
	74_all_uClibc-0.9.29-rm-whitespace.patch
	81_all_uClibc-gnu89-inline.patch"

_prepare() {
	local i
	cd $srcdir/$_mynamever/
	for i in ../*.patch; do
		if ! patch -p1 < $i; then
			echo "Patch failed: $i" >&2
			return 1
		fi
	done
}

_compile() {
	cd $srcdir/$_mynamever/
	cp ../uclibcconfig .config
	make silentoldconfig
	make || return 1
}

_install() {
	cd $srcdir/$_mynamever/
	make install DESTDIR=$pkgdir
}

build() {
	_prepare && _compile && _install
}

md5sums="4f530567cd9601ee24a934d7dfdec581  uClibc-0.9.30-rc3.tar.bz2
db865a8cc28e9650490fee1b8fe61a5c  uclibcconfig
f31b7fee0153ddc288a843d86f928997  69_all_uClibc-0.9.29-fix-gethostent_r-failure-retval.patch
c2a68efc3b1438657eb8ac68feafe6af  72_all_uClibc-0.9.29-linuxthreads.patch
cdf6ba2ca4450c8f32724a86a56c948f  74_all_uClibc-0.9.29-rm-whitespace.patch
0b2312ad80c7440c4f3715715ebe3444  81_all_uClibc-gnu89-inline.patch"
