pkgname=alpine-baselayout
pkgver=1.13
pkgrel=1
pkgdesc="Alpine base dir structure and init scripts"
url=http://dev.alpinelinux.org/alpine/alpine-baselayout
depends="uclibc"
source="http://dev.alpinelinux.org/alpine/$pkgname/$pkgname-$pkgver.tar.gz
	modloop.initd
	install-D.patch
	"
license=GPL-2

build() {
	cd "$srcdir/$pkgname-$pkgver"
	patch -p1 < ../install-D.patch
	make install PREFIX= DESTDIR="$pkgdir" || return 1
	mkdir -p \
		$pkgdir/etc/modules.d 			\
		$pkgdir/etc/network/if-down.d		\
		$pkgdir/etc/network/if-post-down.d	\
		$pkgdir/etc/network/if-pre-up.d		\
		$pkgdir/etc/network/if-up.d		\
		$pkgdir/etc/periodic/15min		\
		$pkgdir/etc/periodic/hourly		\
		$pkgdir/etc/periodic/daily		\
		$pkgdir/etc/periodic/weekly		\
		$pkgdir/etc/periodic/monthly		\
		$pkgdir/media/cdrom			\
		$pkgdir/media/floppy			\
		$pkgdir/media/usb			\
		$pkgdir/mnt				\
		$pkgdir/proc				\
		$pkgdir/sys				\
		$pkgdir/dev				\
		$pkgdir/home				\
		$pkgdir/root				\
		$pkgdir/usr/bin				\
		$pkgdir/usr/sbin			\
		$pkgdir/usr/local/bin			\
		$pkgdir/usr/local/sbin			\
		$pkgdir/var/lib/misc			\
		$pkgdir/var/log				\
		$pkgdir/var/run				\
		$pkgdir/var/lock/subsys			\
		$pkgdir/var/tmp				\
		$pkgdir/tmp

		chmod 0700 "$pkgdir/root"
		chmod 1777 "$pkgdir/tmp"

		ln -s /.alpine-release "$pkgdir"/etc/alpine-release
		ln -s /proc/mounts $pkgdir/etc/mtab

		echo "deadline-iosched" > $pkgdir/etc/modules
		echo "af_packet" >> $pkgdir/etc/modules

		install -m 755 $srcdir/modloop.initd $pkgdir/etc/init.d/modloop

}

md5sums="76247daeb45cf873069ef7363d69e2a8  alpine-baselayout-1.13.tar.gz
55a86bd1eca2cccd6cb6f62b78ba60ae  modloop.initd
bcb24ca480935cb11116a6512f07fa63  install-D.patch"
