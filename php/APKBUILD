# Contributor: Carlo Landmeter <clandmeter at gmail>
# Maintainer: Carlo Landmeter <clandmeter at gmail>
pkgname=php
pkgver=5.2.8
pkgrel=0
pkgdesc="The PHP language runtime engine"
url="http://www.php.net/"
license="PHP-3"
depends=""
makedepends="pcre-dev libxml2-dev libiconv-dev openssl-dev zlib-dev bzip2-dev
curl-dev libpng-dev libjpeg-dev freetype-dev libmcrypt-dev mysql-dev sqlite-dev"
subpackages="$pkgname-doc $pkgname-dev $pkgname-bcmath $pkgname-bz2
$pkgname-calendar $pkgname-curl $pkgname-exif
$pkgname-ftp $pkgname-gd $pkgname-iconv $pkgname-json $pkgname-mcrypt 
$pkgname-mime_magic $pkgname-mysql $pkgname-mysqli
$pkgname-openssl $pkgname-pdo $pkgname-pdo_mysql $pkgname-pdo_sqlite
$pkgname-posix $pkgname-session $pkgname-shmop 
$pkgname-soap $pkgname-sockets $pkgname-sqlite $pkgname-sysvmsg $pkgname-sysvsem
$pkgname-sysvshm $pkgname-xmlrpc $pkgname-zip $pkgname-zlib"
source="http://www.php.net/distributions/${pkgname}-${pkgver}.tar.bz2"

build() {
        cd "$srcdir/$pkgname-$pkgver"

        ./configure \
        --prefix=/usr --sysconfdir=/etc/php --with-layout=GNU \
        --with-config-file-path=/etc/php \
	--with-config-file-scan-dir=/etc/php/conf.d \
        --enable-inline-optimization --disable-debug --disable-rpath \
        --disable-static --enable-shared --mandir=/usr/share/man \
        --with-openssl=shared --with-zlib=shared --enable-bcmath=shared \
        --with-bz2=shared --enable-calendar=shared --with-curl=shared \
        --enable-exif=shared --enable-ftp=shared --with-gd=shared \
        --with-jpeg-dir=shared,/usr --with-png-dir=shared,/usr \
	--enable-gd-native-ttf --enable-mbstring=shared --with-mcrypt=shared \
	--with-mysql=shared --with-mysql-sock=/tmp/mysql.sock \
	--with-mysql=shared --with-mysqli=shared --with-pear=/usr/share/pear \
        --enable-pdo=shared --with-pdo-mysql=shared \
	--with-pdo-sqlite=shared,/usr --enable-fastcgi \
        --with-sqlite=shared --enable-sqlite-utf8 --enable-shmop=shared \
        --enable-soap=shared --enable-sysvmsg=shared --enable-sysvsem=shared \
        --enable-sysvshm=shared --enable-zip=shared --enable-posix=shared \
        --enable-sockets=shared --enable-xml --with-ttf=shared \
        --enable-session=shared --with-regex=php --with-pcre-regex=/usr \
        --enable-mbstring=all --enable-mbregex --enable-json=shared \
        --with-iconv=shared --with-xmlrpc=shared --enable-cgi \
	--with-freetype-dir=shared,/usr --with-mime-magic=shared \
        --enable-discard-path --enable-force-cgi-redirect --disable-cli

        make || return 1
        make -j1 INSTALL_ROOT="$pkgdir" install || return 1
        install -D -m644 php.ini-recommended "$pkgdir"/etc/php/php.ini
}

bcmath() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/bcmath.so" \
	"${subpkgdir}/usr/lib/php/20060613/bcmath.so"
}

bz2() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/bz2.so" \
	"${subpkgdir}/usr/lib/php/20060613/bz2.so"
}

calendar() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/calendar.so" \
	"${subpkgdir}/usr/lib/php/20060613/calendar.so"
}

curl() {
	depends="$pkgname curl"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/curl.so" \
	"${subpkgdir}/usr/lib/php/20060613/curl.so"
}

exif() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/exif.so" \
	"${subpkgdir}/usr/lib/php/20060613/exif.so"
}

ftp() {
	depends="$pkgname openssl"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/ftp.so" \
	"${subpkgdir}/usr/lib/php/20060613/ftp.so"
}

gd() {
	depends="$pkgname freetype libpng libjpeg zlib"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/gd.so" \
	"${subpkgdir}/usr/lib/php/20060613/gd.so"
}

iconv() {
	depends="$pkgname libiconv"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/iconv.so" \
	"${subpkgdir}/usr/lib/php/20060613/iconv.so"
}

json() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/json.so" \
	"${subpkgdir}/usr/lib/php/20060613/json.so"
}

mcrypt() {
	depends="$pkgname libmcrypt"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/mcrypt.so" \
	"${subpkgdir}/usr/lib/php/20060613/mcrypt.so"
}

mime_magic() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/mime_magic.so" \
	"${subpkgdir}/usr/lib/php/20060613/mime_magic.so"
}


mysql() {
	depends="$pkgname mysql"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/mysql.so" \
	"${subpkgdir}/usr/lib/php/20060613/mysql.so"
}

mysqli() {
	depends="$pkgname mysql zlib openssl"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/mysqli.so" \
	"${subpkgdir}/usr/lib/php/20060613/mysqli.so"
}

openssl() {
	depends="$pkgname openssl"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/openssl.so" \
	"${subpkgdir}/usr/lib/php/20060613/openssl.so"
}

pdo() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/pdo.so" \
	"${subpkgdir}/usr/lib/php/20060613/pdo.so"
}

pdo_mysql() {
	depends="$pkgname mysql zlib openssl"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/pdo_mysql.so" \
	"${subpkgdir}/usr/lib/php/20060613/pdo_mysql.so"
}

pdo_sqlite() {
	depends="$pkgname sqlite"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/pdo_sqlite.so" \
	"${subpkgdir}/usr/lib/php/20060613/pdo_sqlite.so"
}

posix() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/posix.so" \
	"${subpkgdir}/usr/lib/php/20060613/posix.so"
}

session() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/session.so" \
	"${subpkgdir}/usr/lib/php/20060613/session.so"
}

shmop() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/mysqli.so" \
	"${subpkgdir}/usr/lib/php/20060613/mysqli.so"
}

soap() {
	depends="$pkgname libxml2 zlib"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/soap.so" \
	"${subpkgdir}/usr/lib/php/20060613/soap.so"
}

sockets() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/sockets.so" \
	"${subpkgdir}/usr/lib/php/20060613/sockets.so"
}

sqlite() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/sqlite.so" \
	"${subpkgdir}/usr/lib/php/20060613/sqlite.so"
}

sysvmsg() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/sysvmsg.so" \
	"${subpkgdir}/usr/lib/php/20060613/sysvmsg.so"
}

sysvsem() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/sysvsem.so" \
	"${subpkgdir}/usr/lib/php/20060613/sysvsem.so"
}

sysvshm() {
	depends="$pkgname"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/sysvshm.so" \
	"${subpkgdir}/usr/lib/php/20060613/sysvshm.so"
}

xmlrpc() {
	depends="$pkgname libiconv libxml2 zlib"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/xmlrpc.so" \
	"${subpkgdir}/usr/lib/php/20060613/xmlrpc.so"
}

zip() {
	depends="$pkgname zlib"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/zip.so" \
	"${subpkgdir}/usr/lib/php/20060613/zip.so"
}

zlib() {
	depends="$pkgname zlib"
	install -D -m755 "${srcdir}/${pkgname}-${pkgver}/modules/zlib.so" \
	"${subpkgdir}/usr/lib/php/20060613/zlib.so"
}

md5sums="8760a833cf10433d3e72271ab0d0eccf  php-5.2.8.tar.bz2"
