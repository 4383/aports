# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=quagga
pkgver=0.99.11
pkgrel=4
pkgdesc="A free routing daemon replacing Zebra supporting RIP, OSPF and BGP."
url="http://quagga.net/"
license="GPL-2"
depends="uclibc readline ncurses"
makedepends="readline-dev ncurses-dev
	autoconf automake libtool"
install=quagga.install
subpackages="$pkgname-dev $pkgname-doc"
source="http://www.quagga.net/download/$pkgname-$pkgver.tar.gz
	$pkgname-0.99.11-link-libcap.patch
	$pkgname-0.99.11-ipv6.patch
	$pkgname-0.99.11-checksum.patch
	$pkgname-0.99.11-ipv6-only.patch
	$pkgname-0.99.11-del-routes.patch
	$pkgname-0.99.11-zombie.patch
	bgpd.initd
	ospf6d.initd
	ospfd.initd
	ripd.initd
	ripngd.initd
	zebra.initd
	zebra.confd
	$install
	"

build() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done

	msg "Running autotools..."
	aclocal || return 1
	autoconf || return 1
	automake || return 1
	libtoolize || return 1

	./configure --prefix=/usr \
		--disable-static \
		--enable-ipv6 \
		--enable-ospf6d \
		--enable-rtadv \
		--enable-user=quagga \
		--enable-group=quagga \
		--enable-vty-group=quagga \
		--enable-vtysh \
		--sysconfdir=/etc/quagga \
		--enable-exampledir=/usr/share/doc/quagga/ \
		--localstatedir=/var/run/quagga \
		|| return 1

#		--with-cflags="${CFLAGS}" \
	make || return 1
	make DESTDIR="$pkgdir" install

	install -d "$pkgdir"/var/run/quagga
	for i in zebra ripd ospfd bgpd ripngd ospf6d; do
		install -Dm755 "$srcdir"/$i.initd "$pkgdir"/etc/init.d/$i
	done
	install -Dm644 "$srcdir/zebra.confd" "$pkgdir"/etc/conf.d/zebra
}
md5sums="903e40c744730ad4d62bee872eeb813b  quagga-0.99.11.tar.gz
8f99d41a8ed79e51704e8f655d255f29  quagga-0.99.11-link-libcap.patch
d73000d128eaf20a17ffb15b5ca1805a  quagga-0.99.11-ipv6.patch
7e1c0152d4733b713613e10df207e3a9  quagga-0.99.11-checksum.patch
44c517e988273e0e5076d24f3959a125  quagga-0.99.11-ipv6-only.patch
1cbcf60a637b2577dee4d6df711e1247  quagga-0.99.11-del-routes.patch
ce345725f2e7240cebe0fd5ac2b2fc48  quagga-0.99.11-zombie.patch
cc109a746273bc0d6aee9d758e7524ab  bgpd.initd
44547b687343ebfed7524cebc5626067  ospf6d.initd
89b0cf4e70172bfcd195b2869cae28da  ospfd.initd
39b8cb21b55de53af38c94c2f5d85917  ripd.initd
120ab1b53975ec86e78266f31e935ab6  ripngd.initd
6d51e9fca8d206a6d9d1d9fde793b48f  zebra.initd
c38e884372406e9e59616e436cd26388  zebra.confd
6d2ca71d32ed9d9517f7779986db91da  quagga.install"
