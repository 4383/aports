# Contributor: Michael Mason <ms13sp@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=dovecot
pkgver=1.1.11
pkgrel=1
pkgdesc="IMAP and POP3 server"
url="http://www.dovecot.org/"
license="LGPL-2.1"
depends="uclibc libcap zlib openssl"
makedepends="libcap-dev zlib-dev openssl-dev"
install="dovecot.pre-install"
subpackages="$pkgname-doc $pkgname-dev"
source="http://www.dovecot.org/releases/1.1/$pkgname-$pkgver.tar.gz
	dovecot.initd
	dovecot-1.1.11-4736327a8740.patch
	dovecot-1.1.11-bdc5391e52df.patch
	dovecot-1.1.11-c08c602ca0dc.patch
	$install
	"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	for i in ../*.patch; do
		msg "Applying $i.."
		patch -p1 < $i || return 1
	done

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--enable-ipv6 \
		--with-pop3d \
		--with-ssl=openssl || return 1

	make || return 1
	make DESTDIR="$pkgdir" install

	install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
}

md5sums="c973eb41aca79fb16630a16f0d84f765  dovecot-1.1.11.tar.gz
573e14589a6f8424d55753a2794ab99a  dovecot.initd
7e1cd399255fbacff197c0ba79b0c2c2  dovecot-1.1.11-4736327a8740.patch
f95cc06111ba3b83399a28cb1459fca0  dovecot-1.1.11-bdc5391e52df.patch
d15abfa0c41426b99423d140d35b2fbd  dovecot-1.1.11-c08c602ca0dc.patch
f0f8893411f5e482e14f40a81a177b19  dovecot.pre-install"
