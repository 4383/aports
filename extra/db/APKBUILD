# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=db

# openldap does not build against 4.7.x so we keep an old version here for now.
pkgver=4.5.20.2
_ver=${pkgver%.*}
pkgrel=2
pkgdesc="The Berkeley DB embedded database system 4.5"
url="http://www.oracle.com/technology/software/products/berkeley-db/index.html"
license="custom"
depends="uclibc"
subpackages="$pkgname-dev $pkgname-doc"
# Patches were found here:
# http://www.oracle.com/technology/products/berkeley-db/db/update/4.6.20/patch.4.6.20.html
source="http://download-uk.oracle.com/berkeley-db/db-$_ver.tar.gz
	patch.$_ver.1
	patch.$_ver.2
	"

build () { 
	cd "$srcdir"/db-$_ver
	for i in ../patch.*; do
		msg "Applying $i..."
		patch -p0 < $i || return 1
	done

	cd build_unix
	../dist/configure --prefix=/usr \
		--mandir=/usr/share/man \
		--enable-compat185 \
		--enable-shared \
		--disable-static \
		--disable-cxx
	make LIBSO_LIBS=-lpthread || return 1
	make DESTDIR="$pkgdir" install

	mkdir -p "$pkgdir"/usr/share/doc
	mv "$pkgdir"/usr/docs "$pkgdir"/usr/share/doc/$pkgname

	install -D -m644 "$srcdir"/db-$_ver/LICENSE \
		"$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

md5sums="b0f1c777708cb8e9d37fb47e7ed3312d  db-4.5.20.tar.gz
a571e239b9041d7990df287cbc59ad6f  patch.4.5.20.1
b7a7086a067ba116f5a8464362c9a9a7  patch.4.5.20.2"
