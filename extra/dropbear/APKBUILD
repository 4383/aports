# Contributor: Carlo Landmeter <clandmeter at gmail>
pkgname=dropbear
pkgver=0.52
pkgrel=0
pkgdesc="small SSH 2 client/server designed for small memory environments"
url="http://matt.ucc.asn.au/dropbear/dropbear.html"
license='MIT'
depends="zlib"
makedepends="zlib-dev"
source="http://matt.ucc.asn.au/dropbear/releases/${pkgname}-${pkgver}.tar.bz2
dropbear.initd
dropbear.confd"

build() {
        cd "$srcdir/$pkgname-$pkgver"

        ./configure --prefix=/usr \
        --disable-lastlog
        progs="dbclient dropbearkey dropbearconvert scp"
        make PROGRAMS="dropbear ${progs}" MULTI=1 || return 1
        install -Dm755 "$srcdir/$pkgname-$pkgver"/dropbearmulti "$pkgdir"/usr/bin/dropbearmulti
        for i in ${progs}; do
          msg "linking ${i##*/}"
          ln -s "$srcdir/$pkgname-$pkgver"/dropbearmulti "$pkgdir"/usr/bin/"$i"
        done
	msg "linking dropbear"
	mkdir -p "$pkgdir"/usr/sbin
	ln -s "$srcdir/$pkgname-$pkgver"/dropbearmulti "$pkgdir"/usr/sbin/dropbear
        install -D -m755 "$srcdir"/dropbear.initd "$pkgdir"/etc/init.d/dropbear
        install -D -m644 "$srcdir"/dropbear.confd "$pkgdir"/etc/conf.d/dropbear
}

md5sums="a1fc7adf601bca53330a792a9c873439  dropbear-0.52.tar.bz2
34fea1c967596ebcd6d10d38444f2b92  dropbear.initd
af73c487e2be37d65d0e8bf80489357e  dropbear.confd"

