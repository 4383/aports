pkgname=bzip2
pkgver=1.0.5
pkgrel=0
pkgdesc="A high-quality data compression program"
url="http://sources.redhat.com/bzip2"
license="BZIP2"
depends="uclibc"
source="http://www.bzip.org/$pkgver/$pkgname-$pkgver.tar.gz
	bzip2-1.0.4-POSIX-shell.patch
	bzip2-1.0.4-makefile-CFLAGS.patch
	bzip2-1.0.4-man-links.patch
	bzip2-1.0.4-saneso.patch
	"
subpackages="$pkgname-dev $pkgname-doc"

build () { 
	local i
	cd "$srcdir"/$pkgname-$pkgver
	for i in ../*.patch; do
		msg "Applying ${i##*/}"
		patch -p1 < $i || return 1
	done

	# Fix man path
	# Generate relative symlinks
	sed -i \
		-e 's:\$(PREFIX)/man:\$(PREFIX)/share/man:g' \
		-e 's:ln -s -f $(PREFIX)/bin/:ln -s :' \
		Makefile || return 1

	# fixup broken version stuff
	sed -i \
		-e "s:1\.0\.4:$pkgver:" \
		bzip2.1 bzip2.txt Makefile-libbz2_so manual.* || return 1

	make -f Makefile-libbz2_so all || return 1
	make all || return 1
	make PREFIX="$pkgdir"/usr install || return 1
}
md5sums="3c15a0c8d1d3ee1c46a1634d00617b1a  bzip2-1.0.5.tar.gz"
