# Contributor: Carlo Landmeter <clandmeter@gmail.com>
pkgname=nfs-utils
pkgver=1.1.5
pkgrel=1
pkgdesc="kernel-mode NFS"
url="http://nfs.sourceforge.net/"
license="GPL"
depends="uclibc portmap libblkid"
makedepends="e2fsprogs-dev g++"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/nfs/$pkgname-$pkgver.tar.bz2
	nfs.initd
	nfs.confd
	nfs.exports
	nfs-utils-rpc.patch
	nfs-utils-no-exec.patch
	nfs-utils-mtab-sym.patch"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	for i in "$srcdir"/*.patch; do
		patch -p0 -i "${i}" || return 1
	done

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--without-tcp-wrappers \
		--disable-nfsv4 \
		--enable-uuid \
		--disable-gss \
		--enable-mount \
		--enable-nfsv3 \
		--with-statedir=/var/lib/nfs

	make || return 1
	make -j1 DESTDIR="$pkgdir" install

	install -m755 -D "$srcdir"/nfs.initd "$pkgdir"/etc/init.d/nfs
	install -m644 -D "$srcdir"/nfs.confd "$pkgdir"/etc/conf.d/nfs
	install -m644 -D "$srcdir"/nfs.exports "$pkgdir"/etc/exports
	#mkdir -p "$pkgdir"/usr/lib/nfs
	install -m755 -D tools/rpcgen/rpcgen "$pkgdir"/usr/bin/rpcgen
}

md5sums="2848072a5e53840b9bc520fbb6782b57  nfs-utils-1.1.5.tar.bz2
4538f67470c916f8da9c76a17e314906  nfs.initd
09135438d6df50b868bbe5a2260f973c  nfs.confd
4f1bb7b2412ce5952ecb5ec22d8ed99d  nfs.exports
dd9a90ce39cf8c725fdbf65d1139447f  nfs-utils-rpc.patch
5e0963b0889e779ff36af0299d17d6cb  nfs-utils-no-exec.patch
a3a7338f8de3ac37c1ffc05bdcb77d16  nfs-utils-mtab-sym.patch"
