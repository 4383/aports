# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=valgrind
pkgver=3.4.1
pkgrel=0
pkgdesc="A tool to help find memory-management problems in programs"
url="http://valgrind.org/"
license="GPL"
depends="uclibc"
# it seems like busybox sed works but the configure script requires GNU sed
makedepends="sed"
subpackages="$pkgname-dev $pkgname-doc"
source="http://$pkgname.org/downloads/$pkgname-$pkgver.tar.bz2
	$pkgname-3.4.0-uclibc.patch
	"

build() {
	local i
	cd "$srcdir/$pkgname-$pkgver"
	for i in ../*.patch; do
		msg "Applying $i"
		patch -p1 < $i || return 1
	done

	# make sure our CFLAGS are respected
	sed -e 's:^CFLAGS="-Wno-long-long":CFLAGS="$CFLAGS -Wno-long-long":' \
		-i configure.in
	./configure --prefix=/usr \
		 --without-mpicc \
		--mandir=/usr/share/man || return 1

	make || return 1
	make DESTDIR="$pkgdir" install || return 1
}

md5sums="b5f039dd2271aaf9ae570ab4116f87c7  valgrind-3.4.1.tar.bz2
37bc90d0783bc0f8ba5754c8407e3dcc  valgrind-3.4.0-uclibc.patch"
