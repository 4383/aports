# Automatically generated by apkbuild-cpan, template 1
# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=perl-rt-authen-externalauth
_realname=RT-Authen-ExternalAuth
pkgver=0.17
pkgrel=1
pkgdesc="RT Authentication using External Sources"
url="http://search.cpan.org/~tsibley"
arch="noarch"
license="GPL PerlArtistic"
cpandepends=""
cpanmakedepends="   "
depends="$cpandepends rt4 perl-dbi perl-ldap perl-net-ssleay"
makedepends="perl-dev $cpanmakedepends"
subpackages="$pkgname-doc"
source="http://search.cpan.org/CPAN/authors/id/T/TS/TSIBLEY/${_realname}-${pkgver}.tar.gz
	use-DESTDIR-perl-rt-authen-externalauth.patch
	dont-install-in-local-perl-rt-authen-externalauth.patch
	"

_builddir="$srcdir/$_realname-$pkgver"

prepare() {
	cd "$_builddir"
	patch -p1 < ../use-DESTDIR-perl-rt-authen-externalauth.patch || return 1
	patch -p1 < ../dont-install-in-local-perl-rt-authen-externalauth.patch || return 1
	export CFLAGS=`perl -MConfig -E 'say $Config{ccflags}'`
	PERL_MM_USE_DEFAULT=1 perl Makefile.PL INSTALLDIRS=vendor DESTDIR="$pkgdir" \
	 RTHOME="/usr/lib/rt4" PREFIX="/usr/lib/rt4"
}

build() {
	cd "$_builddir"
	export CFLAGS=`perl -MConfig -E 'say $Config{ccflags}'`
	make DESTDIR="$pkgdir" RTHOME="/usr/lib/rt4" PREFIX="/usr/lib/rt4"
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" RTHOME="/usr/lib/rt4" PREFIX="/usr/lib/rt4" install || return 1
	mkdir -p "$pkgdir"/etc/rt4/plugins
	mv "$pkgdir"/usr/lib/rt4/plugins/RT-Authen-ExternalAuth/etc \
	 "$pkgdir"/etc/rt4/plugins/RT-Authen-ExternalAuth || return 1
	find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
	# leftover empty dirs
	rm -rf "$pkgdir"/home
}

md5sums="f1d17f4c83d7ec2615db2e42f7b82d19  RT-Authen-ExternalAuth-0.17.tar.gz
6e2fa78c896de4f10b3f4a3030dd8659  use-DESTDIR-perl-rt-authen-externalauth.patch
b1c1136f726af56af275021b9ce8b12e  dont-install-in-local-perl-rt-authen-externalauth.patch"
sha256sums="cd12c0c223c4cd4588feb5de76eb234ab62c6cbc865f3f82249f0023c21f5aca  RT-Authen-ExternalAuth-0.17.tar.gz
6b254295f06fca929ebe96fdcd08d8f1c9fbae0ffaf9e1a9cd83ce57572f5bdc  use-DESTDIR-perl-rt-authen-externalauth.patch
2944a8139356ae9877020389e98cdb12db9e0e0239a88848d9d3cea8a1695c5c  dont-install-in-local-perl-rt-authen-externalauth.patch"
sha512sums="5110f21c46887049f0a43772cbc3d22bd24b29140a5753572dd3e29a75597bd3aaebb32dc73fb82482d98e321a1473cc2b8929b8d921702ef52adf08cb3ec85f  RT-Authen-ExternalAuth-0.17.tar.gz
880d36550d7272595407b032c5d08da32a949255c1cb772df5c19150b75be599023d5d263fbbc679531751ec878d2dfe6023c4e271738d11446a21cdb1434eed  use-DESTDIR-perl-rt-authen-externalauth.patch
8ddc26ff26ed190b4c2801dc7514e41cdedffe485d083de49d787cf71ce1adf6d8e3fdb68df8c64396e977c4acebe853c982bb0735ab38f451de98d22424b65a  dont-install-in-local-perl-rt-authen-externalauth.patch"
