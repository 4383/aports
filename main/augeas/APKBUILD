# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=augeas
pkgver=1.3.0
pkgrel=0
pkgdesc="A configuration editing tool"
url="http://augeas.net"
arch="all"
license="LGPL2+"
depends=""
depends_dev="libxml2-dev"
makedepends="$depends_dev readline-dev"
install=""
subpackages="$pkgname-dev $pkgname-doc $pkgname-tests $pkgname-libs"
source="http://download.augeas.net/augeas-$pkgver.tar.gz
	0001-Dnsmasq-add-structure-to-address-and-server-options.patch
	0001-Shellvars-allow-partial-quoting-mixing-multiple-styl.patch
	0002-Shellvars-allow-wrapping-builtin-arguments-to-multip.patch
	0003-Shellvars-Allow-almost-any-command.patch
	0004-Shellvars-test-case-for-wrapping-command-arguments.patch
	0005-Shellvars-case-support-on-same-line-with-multiple-co.patch"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		|| return 1
	make || return 1
	make tests || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm -rf "$pkgdir"/usr/lib/charset.alias
	rmdir -p "$pkgdir"/usr/lib 2>/dev/null
	rm "$pkgdir"/usr/lib/*.la || return 1
}

tests() {
	pkgdesc="Tests for Augeas lenses"
	arch="noarch"
	mkdir -p "$subpkgdir"/usr/share/augeas/lenses/dist/
	mv "$pkgdir"/usr/share/augeas/lenses/dist/tests \
		"$subpkgdir"/usr/share/augeas/lenses/dist/
}

libs() {
	pkgdesc="Libraries for augeas"
	replaces="augeas"
	mkdir -p "$subpkgdir"/usr/ "$subpkgdir"/usr/share/augeas/
	mv "$pkgdir"/usr/lib "$subpkgdir"/usr/ || return 1
	mv "$pkgdir"/usr/share/augeas/lenses \
		"$subpkgdir"/usr/share/augeas/ || return 1
}

md5sums="c8890b11a04795ecfe5526eeae946b2d  augeas-1.3.0.tar.gz
b140791828aec2037c411164102ef8cd  0001-Dnsmasq-add-structure-to-address-and-server-options.patch
b4cb2352d2291f59cf337a85581155d5  0001-Shellvars-allow-partial-quoting-mixing-multiple-styl.patch
c46a285bbb12463a8464d94e1aa83477  0002-Shellvars-allow-wrapping-builtin-arguments-to-multip.patch
e53532cb842babf3b785369d23437005  0003-Shellvars-Allow-almost-any-command.patch
c14dfc123474916f8329a9cf94eb9209  0004-Shellvars-test-case-for-wrapping-command-arguments.patch
73c032499a48ed2d5847a9a627131eb5  0005-Shellvars-case-support-on-same-line-with-multiple-co.patch"
sha256sums="80763031af76515a8ea66013ddc3c466742a15d2e907c7c8e2e3b7410262e2af  augeas-1.3.0.tar.gz
0cb29dfdef3f293c5a4db06704072a6672ce728c82d4b2a7260da341522efc37  0001-Dnsmasq-add-structure-to-address-and-server-options.patch
23a952a8f77e86656d009ad417f109e6e31b1635beb49ff6fcc232bbea6236f4  0001-Shellvars-allow-partial-quoting-mixing-multiple-styl.patch
914ccac060da5a164c7a37e2cfdb05ea20b583a9bb84631b5bafb9ae37f18214  0002-Shellvars-allow-wrapping-builtin-arguments-to-multip.patch
95775c884e42e89136511afcc96802f1ac60872ef4933800b88c92b01413dad9  0003-Shellvars-Allow-almost-any-command.patch
d53ab29203e2d443317e6ac848b0ba421d774bb08c80719863841897e8695c02  0004-Shellvars-test-case-for-wrapping-command-arguments.patch
3ced5d61df3c509c68c135bbe78f855adf92b5bf1cfa25aa6c4ffeb25a930cff  0005-Shellvars-case-support-on-same-line-with-multiple-co.patch"
sha512sums="92cc2cf83faa42e83621fe0f73fe9f7247d802f17da781e51d068056d20b1645de1f0ea0d5070c0d5729a3f6554d64a95e31111bf3e44b959386559619843e79  augeas-1.3.0.tar.gz
f2cdf6fcd84de4f86bc54d89292d3c4c19070b1c6d5149af6a8d7c49678e2a7527b6549ad114e5ccec53d4d9582814153732f69a4c0228243aac96c48a0e1d1d  0001-Dnsmasq-add-structure-to-address-and-server-options.patch
e89edad7188eff4bffa8710af0f4cb79f4f1c1d37019ebd82b545465abfd276289b79d6980a3a065159d01574ab77bffb8bb0e54daeb05d7e5476f7da73552a7  0001-Shellvars-allow-partial-quoting-mixing-multiple-styl.patch
76552267238f097431b61f2aa381846a850b0cec22072e471fbcbc1bb455dc887a4119b7d5ac592e10c509fda43159ea958f7ab6267c05f7963306aff0502a7c  0002-Shellvars-allow-wrapping-builtin-arguments-to-multip.patch
6286efd526f8d4ad75198a0fc02732cf560285cf0a51731faf60cf3c0c75a364852fff399dcc99e1102585c39563c2b2518ee2a4e113bafeadf5e4400a0bff59  0003-Shellvars-Allow-almost-any-command.patch
6d7284139a1ab59fb8d189a1e851592095b511fb88cf1603213d299e0b0ca3b3afcad9ba22da0225cdb3b53a8cb1837047cec04d9a859bfc2fc73f9b78877967  0004-Shellvars-test-case-for-wrapping-command-arguments.patch
4c1b64373dec24eee0eb11d163468852afcf24336795e116e7501804b7c1273a2bfdc78fe1bce1f327f3b4fa80c560854a71bb56ab44ac1a492f6b0905aeb18a  0005-Shellvars-case-support-on-same-line-with-multiple-co.patch"
