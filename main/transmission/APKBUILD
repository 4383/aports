# Maintainer:Carlo Landmeter
pkgname=transmission
pkgver=2.81
pkgrel=2
pkgdesc="Lightweight GTK BitTorrent client"
url="http://www.tansmissionbt.com"
install="transmission-daemon.pre-install transmission-daemon.post-upgrade"
arch="all"
license="MIT"
depends=
pkgusers="transmission"
pkggroups="transmission"
makedepends="openssl-dev pkgconfig curl-dev gtk+3.0-dev intltool libevent-dev
	libnotify-dev dbus-glib-dev autoconf automake tar libcanberra-dev gconf-dev"
source="http://download.m0k.org/transmission/files/transmission-$pkgver.tar.xz
	uclibc-quota.patch
	transmission-daemon.initd
	transmission-daemon.confd
	"
subpackages="$pkgname-cli $pkgname-daemon $pkgname-doc $pkgname-lang"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
}

build() {
        cd "$_builddir"

	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--enable-utp \
		--with-inotify \
		|| return 1
	make || return 1
}

package() {
        cd "$_builddir"
        make DESTDIR="$pkgdir" install || return 1
}

daemon() {
	pkgdesc="Lightweight BitTorrent client (daemon and webinterface)"
	install -d "$subpkgdir"/usr/share \
		"$subpkgdir"/usr/bin || return 1
	install -d -o transmission -g transmission \
		"$subpkgdir"/var/lib/transmission \
		"$subpkgdir"/var/log/transmission || return 1
	mv "$pkgdir"/usr/bin/transmission-daemon \
		"$subpkgdir"/usr/bin/ || return 1
	mv "$pkgdir"/usr/share/transmission \
		"$subpkgdir"/usr/share/ || return 1
        install -D -m755 "$srcdir"/transmission-daemon.initd \
		"$subpkgdir"/etc/init.d/transmission-daemon || return 1
        install -D -m644 "$srcdir"/transmission-daemon.confd \
		"$subpkgdir"/etc/conf.d/transmission-daemon || return 1
}

cli() {
	pkgdesc="Lightweight BitTorrent client (cli  and remote)"
	install -d "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/transmission-cli \
		"$pkgdir"/usr/bin/transmission-create \
		"$pkgdir"/usr/bin/transmission-edit \
		"$pkgdir"/usr/bin/transmission-show \
		"$pkgdir"/usr/bin/transmission-remote \
		"$subpkgdir"/usr/bin/ || return 1
}

md5sums="db1ad10ecff07150486dab2365ccb3a8  transmission-2.81.tar.xz
c3b19aca8d871526b13e5ed856ca5ec2  uclibc-quota.patch
b44e7e7bcfb7fd1c59b3e1191d4dabb9  transmission-daemon.initd
5caf0fc25dfd67c61627f1e0313f4245  transmission-daemon.confd"
sha256sums="bbb571f5825466aa45e6ef4ad286176135a1a9c0234ffea3527ebd8001cc56ab  transmission-2.81.tar.xz
7e0b47664e26646acc078f0b826420481d0e8d72e74d2285a2015558fa42ee9a  uclibc-quota.patch
4c3a0e666e39e3780ae280e2ff99f80cce9d671139580e8219c4a07563517e70  transmission-daemon.initd
4b47acf195a14a322550cfcaa735a59aac38410d1c2c63ffa824ff131c55ca70  transmission-daemon.confd"
sha512sums="4b646b1c8498499e5557c3084e2a4350526b2e009e5f369ccf24f9d81dad8df05442744db17614486c8567c3bd90cef8567a564fad1f1f6f8b234740c7679dee  transmission-2.81.tar.xz
becbfcf9ed80c4794b8eef23c508eaed9cb650b775d49bf7f0216f14d34644bd5f728624ff491465952adea4bcecb22aee42726649220d7791aa57eb0a19ad9d  uclibc-quota.patch
366d04e1f4770eb8a98ab292660097c2ff1dd73a6ad695cb1af6baae984d047860e33bbb7b68d44948c2309f3ec8fc2f3ff11b8e85afc22458d061c7d598bbb6  transmission-daemon.initd
a3b9ac2b7bbe30e33060c8b6a693dc7072d3c6ac44f92ddd567969d8f57a0bfc1a561e781ae167703ccb4b2fd5b0e6d8f8a66c5ba14fe01d8d89a501d4501474  transmission-daemon.confd"
