# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=fakeroot
pkgver=1.19
pkgrel=0
pkgdesc="Gives a fake root environment, useful for building packages as a non-privileged user"
arch="all"
license='GPL'
url="http://fakeroot.alioth.debian.org/"
depends=
makedepends="libcap-dev"
subpackages="$pkgname-doc"
source="http://ftp.debian.org/debian/pool/main/f/$pkgname/${pkgname}_${pkgver}.orig.tar.bz2
	busybox-getopt.patch
	fakeroot-stdint.patch
	fakeroot-uclibc.patch"

prepare() {
	cd $startdir/src/$pkgname-$pkgver
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd $startdir/src/$pkgname-$pkgver

	# musl does not have _STAT_VER, it's really not used for
	# anything, so define it as zero (just like uclibc does)
	[ "${CHOST#*musl}" != "$CHOST" ] && CFLAGS="-D_STAT_VER=0 $CFLAGS"

	CONFIG_SHELL=/bin/sh \
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--disable-static \
		|| return 1
	make || return 1
}

package() {
	cd $startdir/src/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la
}

md5sums="3a00a1264cb31a815552050ef0c2468b  fakeroot_1.19.orig.tar.bz2
bdbf1db14f2cfdff0f5b4c35da78b9fe  busybox-getopt.patch
50a899380cfd5eae8ce3aaf878fb17b2  fakeroot-stdint.patch
7a54ab51fdb90bc44e366e0a66811bfe  fakeroot-uclibc.patch"
sha256sums="eafa6885535ff57a42248aec090fe17cfa5ca85b62cefa0d13637c9de8996868  fakeroot_1.19.orig.tar.bz2
e915ce6cf414da590d39c735e1e522725717f43bfe6da77bd62cd1be365a06ec  busybox-getopt.patch
8739c0b79c3f2b0e46cd0dffa8b73d946efbe994f61f69f7d1115c2dcec22df1  fakeroot-stdint.patch
e325ad9aad310caa71002adea220795f706c621c5794093f16c0f319b3d58977  fakeroot-uclibc.patch"
sha512sums="ff3f50cdf168deafab337d3d98299ccd4129ed2a9befa5f28171d92c2ddfa08c8f42424f32b3fbcbb1f83c16f22952e571946f4152246d08b0d18bab77c458e9  fakeroot_1.19.orig.tar.bz2
3a3cfcddbfe6685111d2a9dd93ebe5816bacab664aa19004cc39e18c00b5ef8045cb153755f66cabb204f17e2495ce38e2fb37fdc8da01cc69ec62e4694e3001  busybox-getopt.patch
ed7a58b0d201139545420f9e5429f503c00e00f36dea84473e77ea99b23bb8d421da1a8a8ce98ff90e72e378dff4cb9ea3c1a863a969899a5f50dfac3b9c5fac  fakeroot-stdint.patch
783ceaf00c6c1c190327dbc3f67761488aaeb23e40b3a249bcaf301f99334721a864f8a730abfb0e17467bad24f5db9127d83379dea3ef24b6f708ff7dfb3f98  fakeroot-uclibc.patch"
