# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xf86-video-geode
pkgver=2.11.14
pkgrel=2
pkgdesc="AMD Geode GX and LX video driver"
url="http://xorg.freedesktop.org/"
arch="x86"
license="custom"
subpackages="$pkgname-doc"
depends=
makedepends="pkgconfig xorg-server-dev libxi-dev fontsproto randrproto
	videoproto renderproto xf86dgaproto"

patches="mibstore.patch"
source="http://xorg.freedesktop.org/releases/individual/driver/$pkgname-$pkgver.tar.bz2
	$patches"

prepare() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in $patches; do
		msg $i
		patch -p1 -i "$srcdir"/$i || return 1
	done
}

build() {
	cd "$srcdir"/$pkgname-$pkgver
	export LDFLAGS="$LDFLAGS -Wl,-z,lazy"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/xorg/modules/*/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="c9a4e1c5438240e5bdce332f92df9163  xf86-video-geode-2.11.14.tar.bz2
241b9d715ad8e22e8d556b5cf6d4dd07  mibstore.patch"
sha256sums="4c750b46c932934faa008919922f5ac8a572afcfe265ac8d7c203b8167a0cfcc  xf86-video-geode-2.11.14.tar.bz2
f5958126b5361b856607fb0c575086f18f148bfff97ae11ed83638fcecb0c69d  mibstore.patch"
sha512sums="d974bb0b00d09c0c3454ccf5363838acc8c3baa62daf8664f1bf310177c23997924db9adcf57323c355f7add43a0560fb54f3ede97e4ed11082d0c793312559b  xf86-video-geode-2.11.14.tar.bz2
b2757d5647c79e94f5c77604941fb059ffe570b84d04b1d76fd53b7200deade837d6c805196e1a306d7bc2ae512d868b7f87ccfbdce164b11c0fd68af2c071a0  mibstore.patch"
