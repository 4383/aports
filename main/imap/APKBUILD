# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

# at this point its only php who wants this for imap support
# if more packages needs the c-client lib we might want to
# build it shared
pkgname=imap
pkgver=2007e
pkgrel=1
pkgdesc="An IMAP/POP server"
url="http://www.washington.edu/imap"
license="APACHE"
subpackages="$pkgname-dev"
depends=
makedepends="openssl-dev"
source="ftp://ftp.cac.washington.edu/$pkgname/$pkgname-$pkgver.tar.gz"

build ()
{
	cd $srcdir/$pkgname-$pkgver
	sed -e "s:-g -fno-omit-frame-pointer -O6:\${CFLAGS}:" \
		-e "s:SSLDIR=/usr/local/ssl:SSLDIR=/usr:" \
		-e "s:SSLCERTS=\$(SSLDIR)/certs:SSLCERTS=/etc/ssl/certs:" \
		-e "s:^CC=.*:CC=${CC:-cc}:" \
		-i src/osdep/unix/Makefile || return 1

	export GCCCFLAGS="$CFLAGS"
	make slx SPECIALAUTHENTICATORS=ssl EXTRACFLAGS="$CFLAGS -fPIC" \
		|| return 1
	
	mkdir -p $pkgdir/usr/sbin
	install -D -m755 imapd/imapd $pkgdir/usr/sbin/imapd
	install -D -m755 ipopd/ipop2d $pkgdir/usr/sbin/ipop2d
	install -D -m755 ipopd/ipop3d $pkgdir/usr/sbin/ipop3d
	for i in c-client mail imap4r1 rfc822 linkage misc smtp nntp osdep \
			env_unix env fs ftl nl tcp sslio utf8 utf8aux; do
		install -D -m644 c-client/$i.h \
			"$pkgdir"/usr/include/imap/$i.h
	done
	install -D -m644 c-client/c-client.a "$pkgdir"/usr/lib/c-client.a
	ln -sf c-client.a "$pkgdir"/usr/lib/libc-client.a
}
md5sums="7903800dc2604000016de070e0c55840  imap-2007e.tar.gz"
