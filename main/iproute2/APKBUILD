# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=iproute2
pkgver=3.7.0
_realver=$pkgver
pkgrel=0
pkgdesc="IP Routing Utilities"
url="http://www.linuxfoundation.org/collaborate/workgroups/networking/iproute2"
arch="all"
license="GPL2"
depends=
install="$pkgname.post-install"
makedepends="bison flex bash"
subpackages="$pkgname-doc"
source="http://kernel.org/pub/linux/utils/net/iproute2/iproute2-$pkgver.tar.xz
	"

prepare() {
	cd "$srcdir"/$pkgname-$_realver

	for i in $source; do
		case $i in
		*.patch) msg "$i";  patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done

	sed -i '/^TARGETS=/s: arpd : :' misc/Makefile
	sed -i 's:/usr/local:/usr:' tc/m_ipt.c include/iptables.h || return 1
	sed -i 's:=/share:=/usr/share:' Makefile || return 1
}

build() {
	cd "$srcdir"/$pkgname-$_realver
	./configure || return 1
	make CCOPTS="-D_GNU_SOURCE $CFLAGS" LIBDIR=/lib || return 1
}

package() {
	cd "$srcdir"/$pkgname-$_realver
	make -j1 DESTDIR="$pkgdir" install
}

md5sums="b07241b267036de9a79ca5b69acf8593  iproute2-3.7.0.tar.xz"
sha256sums="6b0e76d7adb8b9b65f70571f75d72db7c2548eff7813cace9e267065c3c0cb34  iproute2-3.7.0.tar.xz"
sha512sums="2569931d0b2190ba5ec1a6567946d85d662cf58c75c4c4dcbc94e399003ee3794354bd8b306f186933a57340e10a227ee65a90bf0cb36d6c48ed3bc5780c69dd  iproute2-3.7.0.tar.xz"
