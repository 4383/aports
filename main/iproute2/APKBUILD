# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=iproute2
pkgver=3.11.0
_realver=$pkgver
pkgrel=0
pkgdesc="IP Routing Utilities"
url="http://www.linuxfoundation.org/collaborate/workgroups/networking/iproute2"
arch="all"
license="GPL2"
depends=
install="$pkgname.post-install"
makedepends="bison flex bash iptables-dev"
subpackages="$pkgname-doc"
source="http://kernel.org/pub/linux/utils/net/iproute2/iproute2-$pkgver.tar.xz
	fix-includes.patch
	"

prepare() {
	cd "$srcdir"/$pkgname-$_realver

	for i in $source; do
		case $i in
		*.patch) msg "$i";  patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done

	sed -i '/^TARGETS=/s: arpd : :' misc/Makefile
	sed -i 's:/usr/local:/usr:' tc/m_ipt.c include/iptables.h || return 1
	sed -i -e 's:=/share:=/usr/share:' \
		-e 's:-Werror::' Makefile || return 1
}

build() {
	cd "$srcdir"/$pkgname-$_realver
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		|| return 1
	make CCOPTS="-D_GNU_SOURCE $CFLAGS" LIBDIR=/lib || return 1
}

package() {
	cd "$srcdir"/$pkgname-$_realver
	make -j1 DESTDIR="$pkgdir" install
}

md5sums="d7ffb27bc9f0d80577b1f3fb9d1a7689  iproute2-3.11.0.tar.xz
914a7876074d4dca39eb80b98bf65091  fix-includes.patch"
sha256sums="0ab31b52b5fd5ff0d3cf03f2068f05eeb4f0b37d107070fbbaacac94df5e88b7  iproute2-3.11.0.tar.xz
14bd5601ebdb7a02a2f2c2eebed6adfe33249e4a394e5e5ecea75387ad82c4a3  fix-includes.patch"
sha512sums="39f2df3d152b44c0bc02c10627929a758386f34df1bff2ffdc4b91adccba48754ebfc4abab1d5a02f586f9e780367803e8c22268743c407c53f1832797abe2bb  iproute2-3.11.0.tar.xz
9bdc960ea5c6cdc8db6f5197624f1faa778170122ac3c3d4e091921c761ba66edf660eebf9c64d467586cb18dd6a630cfbfb379ed45a9acad91cd4b37f4d0b16  fix-includes.patch"
