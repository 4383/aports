# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=vim
pkgver=7.3.1070
_srcver=${pkgver%.*}
_patchver=${pkgver##*.}
pkgrel=0
pkgdesc="advanced text editor"
url="http://www.vim.org"
arch="all"
license='GPL'
depends=
makedepends="ncurses-dev lua-dev"
subpackages="$pkgname-doc"
source="http://dev.alpinelinux.org/archive/vim/vim-$pkgver.tar.xz
	vim-gcc47.patch
	vimrc
	"
_builddir="$srcdir"/${pkgname}-${pkgver}

prepare() {
	cd "$_builddir"
	patch -p0 -i "$srcdir"/vim-gcc47.patch || return 1

	# Read vimrc from /etc/vim
	echo '#define SYS_VIMRC_FILE "/etc/vim/vimrc"' >> src/feature.h
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--enable-luainterp \
		--without-x \
		--disable-nls \
		--enable-multibyte \
		--enable-gui=no
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir/" install
	install -D "$srcdir"/vimrc "$pkgdir"/etc/vim/vimrc
}

md5sums="28e8cc0c70fd8473c1bba050ca8d04d0  vim-7.3.1070.tar.xz
a2e71b09d38921d43d2a552d4f0bd1aa  vim-gcc47.patch
97aecde2ab504e543a96bec84b3b5638  vimrc"
sha256sums="38d61e5e8cb977ac44450d175240cc9bd5e402573437d42f463936358e0d7ec2  vim-7.3.1070.tar.xz
9997f5a3c36e5b41008ac2d84165dda4d20124043cbc033d1d69e5d884fb4334  vim-gcc47.patch
7ac7e5fd75fe315fd8b3ca4172056ebb9f06df0b5985d3ff88133dfcdd87076b  vimrc"
sha512sums="ceb6c1921ccdf8cf0db664c20586f18536351a731f8059089ac5dbae47f9c5e83136b49b8379d042fa6145baf4242f6d6539b35cf3decf8ee8dd6fe93e578a1d  vim-7.3.1070.tar.xz
a212404de5e4bf70bd584e3f46a22c3e246f206cf995c5771a020be9eb7b6bc71d422788b309eb677b2822df94266854704c29802f2f8e47cea6905d68833460  vim-gcc47.patch
d9586b777881973cb5e48e18750336a522ed72c3127b2d6b6991e2b943468ca5b694476e7fa39ab469178c1375fc8f52627484e0fe377aea5811a513e35a7b02  vimrc"
