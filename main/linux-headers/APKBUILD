# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=linux-headers
pkgver=2.6.29.5
_kernver=2.6.29
pkgrel=0
pkgdesc="Linux system headers"
url="http://kernel.org"
license='GPL-2'
makedepends="perl"
options="!strip !tracedeps"
source="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-$_kernver.tar.bz2
	ftp://ftp.kernel.org/pub/linux/kernel/v2.6/patch-$pkgver.bz2
	linux-nbma-mroute-v4-2.6.29.diff
	"

build() {
	cd $srcdir/linux-$_kernver
	if [ "$_kernver" != "$pkgver" ]; then
		bunzip2 -c < ../patch-$pkgver.bz2 | patch -p1 || return 1
	fi

	# opennhrp needs this ABI compat breaker
	patch -p1 < ../linux-nbma-mroute-v4-2.6.29.diff || return 1

	mkdir -p "$pkgdir/usr"
	make headers_install INSTALL_HDR_PATH="$pkgdir/usr" 

	find "$pkgdir/usr" \( -name .install -o -name ..install.cmd \) -exec \
		rm -f {} \;

	# provided by libdrm
	rm -rf "$pkgdir"/usr/include/drm
}

md5sums="64921b5ff5cdadbccfcd3820f03be7d8  linux-2.6.29.tar.bz2
bd23086872a85c9fd00163e9ab78038a  patch-2.6.29.5.bz2
0b9670600a6af0261f8c994fc585ef82  linux-nbma-mroute-v4-2.6.29.diff"
