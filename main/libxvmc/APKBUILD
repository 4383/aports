# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxvmc
pkgver=1.0.8
pkgrel=1
pkgdesc="X11 Video Motion Compensation extension library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-dev"
depends=
depends_dev="xproto videoproto libxv-dev libx11-dev libxext-dev"
makedepends="$depends_dev libtool autoconf automake util-macros"
source="http://xorg.freedesktop.org/releases/individual/lib/libXvMC-$pkgver.tar.bz2
	CVE-2016-7953.patch
	"

# secfixes:
#   1.0.8-r1:
#   - CVE-2016-7953

_builddir="$srcdir"/libXvMC-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la
}
md5sums="2e4014e9d55c430e307999a6b3dd256d  libXvMC-1.0.8.tar.bz2
214b3716fc0efe08f9c29165e4419cc0  CVE-2016-7953.patch"
sha256sums="5e1a401efa433f959d41e17932b8c218c56b931348f494b8fa4656d7d798b204  libXvMC-1.0.8.tar.bz2
1a26c55e6c454fc64877c55b8e4650a04ad7b74d10d248c36247e1543550d5a5  CVE-2016-7953.patch"
sha512sums="781a53ad1d60a06019ed24150b85a96f2608e6ca0d876de9f06511c0e086cdf837804994e33b51ee8b3714150dc1d6060449e89ab7458476c8535b5b336147bf  libXvMC-1.0.8.tar.bz2
c5a6eef61ccffe6167b968e11b1b45d50007b9e2942f1374ff5a406064e08123f7994572a434c007c37dbd2dd47f9b8c9f611290aca7dd855d9bc678183cabc3  CVE-2016-7953.patch"
