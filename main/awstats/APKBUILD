# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=awstats
pkgver=7.1.1
pkgrel=0
pkgdesc="AWStats is short for Advanced Web Statistics."
url="http://awstats.sourceforge.net/"
arch="noarch"
license="GPL-2"
depends="perl perl-uri"
subpackages="$pkgname-doc"
source="http://www.awstats.org/files/$pkgname-$pkgver.tar.gz"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local file
	cd "$_builddir"
	for file in tools/* wwwroot/cgi-bin/*; do
		[ -f "${file}" ] || continue
		sed -e "s:/usr/local/awstats/wwwroot:/usr/lib/awstats:g" \
			-i "$file"
	done
}

build() {
	return 0
}

package() {
	cd "$_builddir"
#	logpath="awstats_log"
#	sed -e "s|^\(LogFile=\).*$|\1\"/var/log/${logpath}\"|" \
#	-e "s|^\(SiteDomain=\).*$|\1\"localhost\"|"
#	-e "s|^\(DirIcons=\).*$|\1\"/awstats/icon\"|"
#	-e "s|^\(DirCgi=\).*$|\1\"/cgi-bin\"|" 
#	-i "${S}"/wwwroot/cgi-bin/awstats.model.conf || die "sed failed"
#	if use ipv6; then
#	sed -e "s|^#\(LoadPlugin=\"ipv6\"\)$|\1|" -i "${S}"/wwwroot/cgi-bin/awstats.model.conf || die "sed failed"
#	fi
	
	install -d "$pkgdir"/usr/share/doc/awstats \
		"$pkgdir"/var/lib/awstats \
		"$pkgdir"/usr/lib/awstats \
		"$pkgdir"/usr/bin \
		"$pkgdir"/etc/awstats
	# docs
	cp -a docs tools/xslt "$pkgdir"/usr/share/doc/awstats || return 1

	# cgi-bin
	cp -a wwwroot/* "$pkgdir"/usr/lib/awstats
	mv "$pkgdir"/usr/lib/awstats/cgi-bin/awstats.model.conf \
		"$pkgdir"/etc/awstats/
	ln -s /etc/aswtats/awstats \
		"$pkgdir"/usr/lib/awstats/cgi-bin/awstats.model.conf

	# tools
	cp tools/*.pl "$pkgdir"/usr/bin/ || return 1
	ln -s /usr/lib/awstats/cgi-bin/awstats.pl "$pkgdir"/usr/bin/
}
md5sums="bbec0233a83cf6ac1eebcf91b555aae7  awstats-7.1.1.tar.gz"
sha256sums="b0051595a38b8b7776f553f20e431760d306bbad1a9e83cf2aca52ef0205f2c0  awstats-7.1.1.tar.gz"
sha512sums="c2bc1604bd15629a057ee7fbbbe4bb0e54992cbd0ed4cd38e4cb9fcbadaa28cd5defd6691352ee8a3f84e98f17b19f9ad953705de4ab36fe4ece95b99b9b685d  awstats-7.1.1.tar.gz"
