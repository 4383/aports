https://bugzilla.mindrot.org/show_bug.cgi?id=1882

diff -u -p -r1.13 openssl-compat.c
--- a/openbsd-compat/openssl-compat.c	21 Jan 2011 22:37:06 -0000	1.13
+++ b/openbsd-compat/openssl-compat.c	6 May 2011 02:04:48 -0000
@@ -134,9 +134,9 @@ RSA_get_default_method(void)
 
 #ifdef	USE_OPENSSL_ENGINE
 void
-ssh_SSLeay_add_all_algorithms(void)
+ssh_OpenSSL_add_all_algorithms(void)
 {
-	SSLeay_add_all_algorithms();
+	OpenSSL_add_all_algorithms();
 
 	/* Enable use of crypto hardware */
 	ENGINE_load_builtin_engines();
diff -u -p -r1.18 openssl-compat.h
--- a/openbsd-compat/openssl-compat.h	21 Jan 2011 22:37:06 -0000	1.18
+++ b/openbsd-compat/openssl-compat.h	6 May 2011 02:04:48 -0000
@@ -106,10 +106,10 @@ RSA_METHOD *RSA_get_default_method(void)
 #  endif
 
 # ifdef USE_OPENSSL_ENGINE
-#  ifdef SSLeay_add_all_algorithms
-#   undef SSLeay_add_all_algorithms
+#  ifdef OpenSSL_add_all_algorithms
+#   undef OpenSSL_add_all_algorithms
 #  endif
-#  define SSLeay_add_all_algorithms()  ssh_SSLeay_add_all_algorithms()
+#  define OpenSSL_add_all_algorithms()  ssh_OpenSSL_add_all_algorithms()
 # endif
 
 # ifndef HAVE_BN_IS_PRIME_EX
@@ -129,6 +129,6 @@ int ssh_EVP_CipherInit(EVP_CIPHER_CTX *,
     unsigned char *, int);
 int ssh_EVP_Cipher(EVP_CIPHER_CTX *, char *, char *, int);
 int ssh_EVP_CIPHER_CTX_cleanup(EVP_CIPHER_CTX *);
-void ssh_SSLeay_add_all_algorithms(void);
+void ssh_OpenSSL_add_all_algorithms(void);
 #endif	/* SSH_DONT_OVERLOAD_OPENSSL_FUNCS */
 
