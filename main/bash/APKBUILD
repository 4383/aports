# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=bash
pkgver=4.2.048
_patchlevel=${pkgver##*.}
_myver=${pkgver%.*}
_patchbase=${_myver%.*}${_myver#*.}
pkgrel=0
pkgdesc="The GNU Bourne Again shell"
url="http://www.gnu.org/software/bash/bash.html"
arch="all"
license="GPL3+"
makedepends="readline-dev ncurses-dev bison flex"
depends=""
subpackages="$pkgname-doc"
source="http://ftp.gnu.org/gnu/bash/bash-${_myver}.tar.gz
	bash-noinfo.patch
	bash_4.3-fix-setuid.patch
	"
# generate url's to patches. note: no forks allowed!
_i=1
_pad="00"
while [ $_i -le $_patchlevel ]; do
	[ $_i -ge 10 ] && _pad="0"
	[ $_i -ge 100 ] && _pad=
	source="$source http://ftp.gnu.org/gnu/bash/bash-$_myver-patches/bash$_patchbase-$_pad$_i"
	_i=$(( $_i + 1))
done

# run 'abuild _gensrc >> APKBUILD' to generate the patch list
#_gensrc() {
#	for _i in $(seq 1 $_patchlevel); do
#		# seq -w unsupported by busybox
#		_p=$(printf "%0.3i" $_i)
#		echo -e "\thttp://ftp.gnu.org/gnu/bash/bash-${_myver}-patches/bash${_patchbase}-$_p"
#	done
#}

_builddir="$srcdir"/$pkgname-$_myver
prepare() {
	local p
	cd "$_builddir"
	update_config_sub || return 1
	for p in ../bash${_patchbase}-??? ../*.patch; do
		msg "applying patch ${p##*/}"
		patch -p0 -i $p || return 1
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--bindir=/bin \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-curses \
		--disable-nls \
		--enable-readline \
		--without-bash-malloc \
		--with-installed-readline \
		|| return 1
	# parallel build workarounds
	make y.tab.c && make builtins/libbuiltins.a && make || return 1
}

package() {
	cd ${startdir}/src/${pkgname}-${_myver}
	make DESTDIR=${pkgdir} install || return 1

	rm -rf "$pkgdir"/usr/share/locale
}
md5sums="3fb927c7c33022f1c327f14a81c0d4b0  bash-4.2.tar.gz
80fec5f3d60a63756a4999c877e31a8e  bash-noinfo.patch
c87b8d9e12d628eac829dc08f4607a20  bash_4.3-fix-setuid.patch
1100bc1dda2cdc06ac44d7e5d17864a3  bash42-001
30e7948079921d3261efcc6a40722135  bash42-002
9ea06decec43a198f3d7cf29acc602f8  bash42-003
fb48f6134d7b013135929476aa0c250c  bash42-004
e70e45de33426b38153b390be0dbbcd4  bash42-005
ce4e5c484993705b27daa151eca242c2  bash42-006
88d1f96db29461767602e2546803bda7  bash42-007
24c574bf6d6a581e300823d9c1276af6  bash42-008
4c5835f2fbab36c4292bb334977e5b6d  bash42-009
0a51602b535ef661ee707be6c8bdb373  bash42-010
58deacf3d57cbd75575444ff6a3b0806  bash42-011
72d5059820015231483bb7415d09e9db  bash42-012
608336ebe215984ef126e3c29d2d3409  bash42-013
ed19da878e3f630834c62b9d9dcc6fce  bash42-014
2d07daba0b8ca8f876d2aa052ff594b4  bash42-015
53d246537e1fffd1aaa02ba5c056211c  bash42-016
304fd129a58fee2d8a34f8b4704db0aa  bash42-017
6921a0b4228fe89b6537a5c29f027c89  bash42-018
1195d85447f3d048d2c9bcd075fa765c  bash42-019
b09000bba08da6ac753124593850cdf7  bash42-020
09d3f96a16b881334cfaee0cf320b47e  bash42-021
597bf71a2aac6feb510b7505cdd3d4f7  bash42-022
3fab459b4e09daea529cacad025b13b3  bash42-023
4ad8d11e72afc6090e701073ff034cf4  bash42-024
c7d2493e44490f01dd20bdc8feb0a6a7  bash42-025
9f19c199dd8d1fa9254eebe738759272  bash42-026
a6ed82daf034587aee2f2581ba5fe829  bash42-027
da9265aa2527fd4a7481baa3e0550287  bash42-028
ec444d229e8899fbaaf6fc7de2d82ae6  bash42-029
b4bc1c4dc1b508ff9cdfc44f1a5039b5  bash42-030
89390ff6a3c2ef7e09dd4b8b097a8e56  bash42-031
eee08003395c417f677d1a4bf8c548ee  bash42-032
2fe070dd6d75d8ff16f269184a16e9c4  bash42-033
4e610506c1711bf3483b965800ac3d5d  bash42-034
7cd9bfdf7cbfd45274d07620ee94c8d9  bash42-035
9c3142956064d175a880bcb186e51ef9  bash42-036
c10692f447d4966c879f8fb8d7c8ebc9  bash42-037
9ef3c308cde413e95866c1266cfb4e98  bash42-038
cd48f57a404498d4e5c73a3501c4b1a5  bash42-039
00a2371b6c05acbfce6bc850c6d982f8  bash42-040
7bc4942a66ca4024ee964db7ede07896  bash42-041
1cf7701017ebfc8e129de92c8f8b798c  bash42-042
9e61168fca692d8d1a733c389a63712e  bash42-043
b4b11d64b45ea9ec50dcc74c6c3861f6  bash42-044
1661bcc83c4715f54368877452ff2247  bash42-045
1b68157ac0f7140e1ceafbbad4a14fee  bash42-046
10fbe341bd6b5dd1e94c2384f24e98b4  bash42-047
87c31c1ace423d3ce8d1e26ba13bc724  bash42-048"
sha256sums="a27a1179ec9c0830c65c6aa5d7dab60f7ce1a2a608618570f96bfa72e95ab3d8  bash-4.2.tar.gz
363bc919d98cadbfca27660be0d1d4bb6cfe1c5f86a7830966e456df36e46792  bash-noinfo.patch
3deb20a2ad093ad318a0aac7a2b69674ba325a59c9e5d2dc67f852d40a6cc177  bash_4.3-fix-setuid.patch
8d6ca028576c4af23e660a2fbc2112221a11c8a785c0b37f033967e5cd12b47a  bash42-001
febac927e199aceeba2004908d971d4afb49b521796c3f42d1166f9fbbfbcef9  bash42-002
5a0a7c15018c87348ea87cb0beea14345faf878dbb0e25c17fa70677194cb4cd  bash42-003
4e34b0f830d2583d56e14225a66937abc81f45bbafcd2eb49daf61c9462140c1  bash42-004
a81749e73004b81cfdf0fe075bec365dc1fef756ee5e3fd142821e317d1459a0  bash42-005
c91148945a2ddafa792682d7c8668c59e7e645eae1334b15b0d5d9ad22634bd1  bash42-006
405826acf443dd1084f236a15cb76d7f0ee2dbe5edff45c5fb836db571fb7e95  bash42-007
23080d11a60a78941210e2477f6bca066b45db03defa60da86fd765107ba2437  bash42-008
e7ed5440b4c19765786e90e4f1ded43195d38b3e4d1c4b39fcc23de9a74ccb20  bash42-009
acfc5482c25e6923116fcf4b4f7f6345b80f75ad7299749db4b736ad67aa43dc  bash42-010
a491ae359a7ebbd7321aede561728289d71e1fc84777f402766a8afd4d261532  bash42-011
354433f1d2da02f1b9652cd20a5b85bbfb5bc2aaf79c42461ebd929d89b9b7b8  bash42-012
3412c5c6cbbce6c88592604aec054d8182ce64410038b5ecea69fc3968cf85ea  bash42-013
b5a678e609858532735f94faedb5fabce00dfd6577a4e9ec5eec85fe682c8b33  bash42-014
2d876a8304bdf3d664e87e0a8d73bc4ccc100a9dd8c0d054e8649472d8748a98  bash42-015
2895ccbcf7fc98da73a8fa3ba7440aaf2bfaef6c0af8bdd3a9c39403cf03e2a6  bash42-016
73552444498c761d6073dd67ccfe043b36ef24bb418c266d91d9750884daee7f  bash42-017
e2a9457172370d454d31b84bbcba758ee6394316dbe755374553b52aadbb494d  bash42-018
a8b7cd02207656976016d93cab48e073cb5da002ceb27b7a63fc5ea62007eb56  bash42-019
494773f0d0078cb35372d24caa523b00d8fdbbaed71e41dc14c9e47579da3c6f  bash42-020
a887a97be226575ecf483be2c76655bd6d1edde1cdfe199c27bd2e6baf32badc  bash42-021
9dcdf69df7f8cd2ba88d18c45a0d8f55fbe4f0e273411179db94dd6198b85c6b  bash42-022
5dc11394f1a6c887373c081396efd4f4cc04492696722c57a4811c207965f0bf  bash42-023
99c826bdd33bee281d0a9191550d62a24d0b256cd41c90afd10abd63a66b99e6  bash42-024
0db0646fd7a559d5702911192bdd387acbbc61cf3c29a34007c3ec840e275515  bash42-025
e7e90cfaabbce3b4b9c699994e9d9ea4a2f084fd9f37788a80b0b70b47d323d2  bash42-026
0c1f6b7256fcc17f42c05f9bbb4138f8e8bb67e79c622c3485711b6f37f7ed42  bash42-027
204226de39ba81aaf3dd5a29cd59de052ec9f648538bb9e7f1c8150852b1ed7a  bash42-028
d0b08c0817bc5acdb28b466727622a8422ca4d61188313cf162443b7f338f581  bash42-029
12594366591a136d8ccdcb8e218010f2ddab6be28a7f96d0ed32ca927e44afae  bash42-030
55f38c4d34775fbb063510c4222b195d998dd86f88288b64a6103e3812f8d9f9  bash42-031
e3a8b563dbb1e5cb7ca85a53515da8b2941213973496d48c4cc5a11c604791ed  bash42-032
f5d12790d69fdfb2f47ac86fa1ea1ecc088880141570273f38dfd3fa4a46434b  bash42-033
01c1f332101389cedf347c7736102966722a3b213900954e5d625bbc2f1e41b8  bash42-034
cecde463b038b4849635ff0993d9b264fc92403e7ae0accb52c7877aeaed78df  bash42-035
fe293a1bc92ac4d272ae9b9a0de3afef7c06145a2b52337a09cacccc5305aafa  bash42-036
c7578cddd3bb2430689c740f58a03403800726dcd1268b28f91bf37f368e1674  bash42-037
b8c9a81bdf206be58ba491dfad80373b3348af769e80aaf72f7611ddbbbe6d57  bash42-038
f4f9300a60321a5088ae9e54052a64c4d3e876f9a3a17ca104d58fa38b9c1791  bash42-039
b265f9caf3c7321f95bc8e0b9e2c46bd86c226f00f05e823699aafb83c4aaa6c  bash42-040
05cc1951bd9f6624088dd6067486ff47f1825e333273d7df5f1b06b23baaf5eb  bash42-041
faaa5c1f456517b258b2a65eaa664dd6a01eeff73c8ca4447c3a6de371bbf304  bash42-042
dc2683840f3e890a9c5f85338366ff6cd923285e558eb46aa818a03fa67c5c57  bash42-043
10d32d6c9ccdedb1d826f46468631d475f9dcf983fac087766e16df7b99766e6  bash42-044
ddb7eff0f59d394a483b09feec3771d9026f81ba90afac32846a19b172b2986d  bash42-045
95c1323b68c0ecc0ca09565ef2d5218625ced3957b702e04c8bcaad9e7b3816d  bash42-046
c1979201d0345011c419a1c82407cd2a00c60a0c75b7f07e145d17f3718daf7a  bash42-047
751a5d2330b21ac9aba7323acbbc91c948285f30a4bb41f56796f9a36b983d24  bash42-048"
sha512sums="fdd3c230f4f7a687d36db1b8f7baab5e553cf55756e2d49a88ffaa4260c8cb949897dec9f48655e96608ef0093ac101b60c132060f06c711c0ab81aa3f148b5c  bash-4.2.tar.gz
74d51550cc03410f22ffea13f6452350d1e5564bff619fb07a5bbef14ca565fbe03770a2c0041292732cda16e8944b33ccbd0dfe29a606a068fedabe277cd6ae  bash-noinfo.patch
b9e035f6a781dd4bb3c58f4de9922e7a3c68a0e38c1538f351c638469b70b031fe019e7f1d626e8db8239a13809f0c8dfa291caf930ed206345a80fa3cff3f80  bash_4.3-fix-setuid.patch
931f2f1d4e677925b5057558ea6f157073a9ba87bf4ed59e7d8fe20957c5fc40f3384a98fc4a2d5d7b458129ec096d9e28a860b6844ebf15f377778a6ef8aade  bash42-001
b9ca62e397a05b368b74920d8d1b168367ffe840cf168e312b530c5b390cef3ca53e31db63c9fe15fe1a36e4c98369bf10573db40d20712fb1a016f10e0fc893  bash42-002
6cf944ab0f554ab53831cbe114f771671c7a9420778d2caa524c09a24ec8064e7a7ef1355e66ed3a53100b72736284a5b44e2c6bda03a8234a2f2d340ed47ce4  bash42-003
aef5e753e59a82df07e18269064ff1d075e3b7558ac5aff7465da997370496bd4ef9c25920d7a47f66110d2ab719742033d96646921782d9ae15a27541765067  bash42-004
ef7fbc3fcc8174e7dfb27fb5e977d3a52b1b4b989cd7f748b1b35ea0e581a59668f41ec030e80f2afdc8b43dfcf472fad2985da284632b9228a6fd30ba4d0556  bash42-005
018031cc0cb2078937c81bd42459b98cfe793ff7d638ed2bd2859ec1c73da6a420d649f7dd49f2367035fd08af430ba783c68417088b1e4126095ab9467c55c9  bash42-006
65cef48b77530a3b87dec1c8c3fb28f553e83f28f24d5e170022b4962472e3e0021a57051800e1ddeebdb78548a3c192c4e1fef0f6e82612321c5d1335e2f8f8  bash42-007
5a782a165701967dc3c34d7723d13668b9ca0c4679de0f6150f42a183425e110281d893f30fa81eae27821a6d89e8ce9d9631268d9e02bca57cb8fece0389f3d  bash42-008
ad0b58d00f37e8626a0bb664df7e24e0f19dc637aa829ae8f92fbe02a53140a3ca7de00f620c5b53001223a002ec774e5088354b342a640666810fd57cd1ff9a  bash42-009
66e84164be08be47b0d7c8286b7d94a4da8538316dce8f8be54702fed2a44798d5f717ae3f524ce735d071430195ce10052a264f3f458b950fe26381fe6506d0  bash42-010
0664fe80f3da9e5e64f1f0fc227e3937db6999526f743e74cf8d6eb589add10449c505422e241f1dfa0cd1e02c03c029cc0b7459850a52cc17d9c3a8d9c26a71  bash42-011
0da4822a29d26d713aa5bfae00911db2db37242ec962edc4f256c8740e345b68e23dcaa4ca8bf37eaaa9e58facde6fe87c3b20c5bad565725a178555aed49503  bash42-012
25f4caed2f4eb3f65dfb052b4b9b30a02fff8a1e6d6575e2da6bc1ce02d10aeb113870916f0b74ea2cd0722f81bcf8c05f70be1af178cff3c7091151d5791de5  bash42-013
ea8dbe73d40bdc0bfc1752ad6fea9503b72bf4c204a6b0d04ee898429f2b16bf9fd21f8ce25b72e87efb82769a228ace31f1624f03491383129ce7935ead97aa  bash42-014
dd572539a26ae5c80b1c39cce8c548b9de0ab5b5f7e711974413322cb20845690f15d985713facab71957b6988553c0a613d5fa3dee2d263bdd9a8d7a5599ea9  bash42-015
2203fd108df4e9c8c93974ce2ac10d8d7bc9b6df1db92ff88b3b394d6fa26ca13de6e308480c192907ecd658df5b4bd3b077a946127b82167c3cac431c3defa3  bash42-016
e2b93fb5f904a0064addd2d2d20bf4f8d868120bad1486916ae0774e41ef4123cbf5b31ef64109361d091ff317cbadbd28882d6571d3014052229a14993ed933  bash42-017
facbe3d258e0e7514bfe3a8c6516aaf2e405facd233e205794ffab815f850ba7385d2d18d7b3a9c000cfe254a771779c6d8829b2fee66a9d6071b1888155b5a1  bash42-018
f8086b8358201c10e96d9533b90a58248e26bc379be96a8a9fba88e09c227acf85cddb26c04e93043b35371c12cbf156f591c9af88b1eb61ba8acca53f6d07a1  bash42-019
23549c7a56e43f9aff7ebc376657ff498d07b47ebbfe6707ba3711e095fd80ca86d077c5379ee62c86711880979debd7b60733d83e12f349ced9e93860d8fc8c  bash42-020
09783ce72651af6abffebdfb3d3e7446b29ac4bfd395aeec66ef1f5c8a2bdc2238957b7e6f4e896178a5e4e24987de209e6776f29330879c0d8e14e8495d8284  bash42-021
ab6f3f175581f34dc106176fbbf5c2d19e9f421e16f328cffe98f11ee01462b63e0f1e720ec467780d91eb240a4a7fd4fd1cfdf6e0cb1293a8e42e8a4805c152  bash42-022
b9d7044800a988dac8c59c48bd4845d3197d6ba965d22fb8f62b51b9d48f5a55519104a16283fb638264a6f858a6d574f8547d75721b96da640721bbdf097d81  bash42-023
b4964ff258905cef806add58eadda17501e98bb3b3b5c8ce8ee0a9250e5bdf0a01329e1bfa973204b1c8e5da8fd068bcef624ec65c2f401c41d0b6b55cb2ba76  bash42-024
b4b80ef1a7599506454a912e2ee23f422bd199a675199b926c3770ba9091fb69583ddde84e67d897c79e6a047ebecbd18a5ee72557e7526c4108476eb5cff71b  bash42-025
b00200d0b9040c74117e0150c589abb9e511abb01888c485eac770ab61c234669aeae3957a6752ab99c378ffd8188154bbec713c608b92cd3185a649b71615bf  bash42-026
107e13482deb9f6355196b2be9b717090aaffd8cf1580ab347bf38600e607c31cef5173b68e426a45d1678c7c64e7e095d5b6da941a5f53218919a0629e2fcfe  bash42-027
6e6ad04e7cff2d65045a9afb617c041b571b6c8cc728f9994825545b7d43c0c7868c68b22546784a6f604d3e0ec22b7bf0423e9d49b7109fefdc5d3db4b31399  bash42-028
9349625892201cb46f3669c18a38c86d609c1c9521fb8caecd6880df822897c6d2541dc0cf5d3d11d27779a3be636b0c6550b7e3b010d37e83804fd1ab27d35c  bash42-029
4643252a45b7fe84451c0bea95bd0089a1685067032c8a2e42bc78587deef5b6095de77500d1c54227f92940b201d193984852f65ef886237dd435617639a46a  bash42-030
de0ea5c279ac956aca48f12e2962dcd4ae2f653349bf2350ae7b53e8370aaf882109fcb29bf559cd81512362bf31a100193de6bf193ff52331e8325df2f82e91  bash42-031
ed35285989290c10f5013770397aa14897e63a28f5ae5a61319ea5881b0abd84410686288cf0f14dd9486d8fd623c410f857b48fbdb62350121e3596527dd3bf  bash42-032
89e277e5a2f43fe75678c0dab57cd7c8761efa38f5902ed0b311ef6a0cdf48f683d3f28fd419908db43afdaf4f81d831f0fd630795f4d20b317543cb9ab95970  bash42-033
d59a4a67a241d262de5fb27b96af0f15b0f6e7e922b2d61ea86e037dcd07ea77ec3c1ef6b289e5bbccd011b632538f264bb6426c3a07dba1946c094be56e0b16  bash42-034
9f294177e91600f65cfee1b9dbf59b3ad7db449a99cc1013b7c97ef6c814b51afa7a2d2516a37fcc110ff3f0b25c4b06e42094f4665e03e41650bfa69c15eaf7  bash42-035
7e114b99d8f5b210b826715c77adfdbb115e86ace35f7ff331fc6f595a4d0f689a055ccf7adfbafc057c7549f5597e4de455ab9e18a6ffeb5b4fd1d3a2aab99c  bash42-036
4466990dc3499ccde5940ddfb383052fa345d4e53fff7c8963ac7482fa280658b4516a1583486175cab2f3a5c8afbbedda8461e3cb1802031bce8db386404608  bash42-037
f835bb393153310fa2e4c2d95a98c0db53a97075f8989d61cccb095db223495777e413b21e9b235391a4a0f34d935a828ff5ccf337520d5dc87d380170efb351  bash42-038
4c5e44a623840c7efe7894f313a5691307b12aea325dbc923b48deb6ee6ac0bb2ff7afb0d2ee12ab97b04d60c1b9e2a4facc51b66c93be9fe0beda317ec7318f  bash42-039
ff5cfdd2aa846f0831a1f2f7b477e70fc6b68b6c4f4785293c417039a7f3fd4822ade4658ea17046ab9616c3fed02b463e6a3e60aeb7daf6ab667da14b9a482e  bash42-040
7c9c12fc77bb764dbe8061e6df9419ab84d296a76c4a8bd96cf0f507bf70652a1c869162ac8d8c36f2d16ea0912a142fe14d6db45636bcb6e6fdf1444f0672a6  bash42-041
99fd4f5f70e3d7d2e8dc1dac80e6ee6e0bb9ba1f629f41019b13f36aba2404aa4d786049bb0039e5fee138a01b813d295d4303c7c3d561a3cf565ffa19bb081e  bash42-042
70503181c392faf565ef0b23a2f6d1614836ffb9c04791cc4bfb31aff7786fd5efab4072034a4cfba0035595140cf7f9461b1565e4854ec34823cbd4f5ab419d  bash42-043
e94cf93c5760225d4ac16f9c73078c3ce9913ffe1e20ffed8fa31084a0efd3dd63762b5437221f6b570078667e3ec19d882169ffe0ba4c498e258e56f17d2511  bash42-044
64f62b19c79eb2c581feda2b9f3c36196b3a794ee9996f6d72078fbb0b8c5878aa2d8ff3e2698cf9769e42083704dd9342bb108212d02aeb79875fad70895560  bash42-045
7e4a9d3961cb8bf8559f82684cb75fe8600a377522f582e1a9537696ceccab32d15d1045f850ea91ea8bd2cf286d79412bb47460af26bec8486d5f3137f5d54f  bash42-046
0b43eefcc0ef3a55e309dff339db31a07849ce794e645d917f1836f48c71b84bdc50aa3315b3b2e33acef2e6e81a07f2a026cb43381d0f809c8271cc0a0699a0  bash42-047
4218377052da8900ab6d49b855ae6f7779ad94e9e76daf3424240fbbb1bab37b929989b976ecc3ccbfb66f3c278a7ba546e5d34b214382b41767991945d960b4  bash42-048"
