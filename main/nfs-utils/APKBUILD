# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=nfs-utils
pkgver=1.2.0
pkgrel=3
pkgdesc="kernel-mode NFS"
url="http://nfs.sourceforge.net/"
license="GPL"
depends="portmap"
makedepends="e2fsprogs-dev"
subpackages="$pkgname-doc rpcgen"
source="http://downloads.sourceforge.net/nfs/$pkgname-$pkgver.tar.bz2
	nfs.initd
	nfs.confd
	nfs.exports
	nfs-utils-no-exec.patch
	nfs-utils-mtab-sym.patch"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	for i in "$srcdir"/*.patch; do
		msg "Applying $i"
		patch -p0 -i "${i}" || return 1
	done

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--without-tcp-wrappers \
		--disable-nfsv4 \
		--enable-uuid \
		--disable-gss \
		--enable-mount \
		--enable-nfsv3 \
		--with-statedir=/var/lib/nfs

	make || return 1
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make -j1 DESTDIR="$pkgdir" install

	install -m755 -D "$srcdir"/nfs.initd "$pkgdir"/etc/init.d/nfs
	install -m644 -D "$srcdir"/nfs.confd "$pkgdir"/etc/conf.d/nfs
	install -m644 -D "$srcdir"/nfs.exports "$pkgdir"/etc/exports
}

rpcgen() {
	pkgdesc="Remote Procedure Call (RPC) protocol compiler"
	cd "$srcdir/$pkgname-$pkgver"
	install -m755 -D tools/rpcgen/rpcgen "$subpkgdir"/usr/bin/rpcgen
}

md5sums="779cf81044e92cb51ad590960e7b3671  nfs-utils-1.2.0.tar.bz2
23240b9ab44ef7d6b6c437c0ae34915d  nfs.initd
09135438d6df50b868bbe5a2260f973c  nfs.confd
4f1bb7b2412ce5952ecb5ec22d8ed99d  nfs.exports
5e0963b0889e779ff36af0299d17d6cb  nfs-utils-no-exec.patch
a3a7338f8de3ac37c1ffc05bdcb77d16  nfs-utils-mtab-sym.patch"
