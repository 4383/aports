# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gst-plugins-base1
pkgver=1.8.3
pkgrel=1
pkgdesc="GStreamer Multimedia Framework Base Plugins"
url="http://gstreamer.freedesktop.org/"
arch="all"
license="GPL LGPL"
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang"
depends=
depends_dev="gstreamer1-dev glib-dev"
makedepends="$depends_dev
	alsa-lib-dev
	cdparanoia-dev
	expat-dev
	gtk+3.0-dev
	libice-dev
	libogg-dev
	liboil-dev
	libsm-dev
	libtheora-dev
	libvorbis-dev
	libxv-dev
	orc-dev
	perl
	"
source="http://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-$pkgver.tar.xz
	CVE-2016-9811.patch
	CVE-2017-5837.patch
	CVE-2017-5839.patch
	CVE-2017-5842.patch
	CVE-2017-5844.patch
	"
ldpath="/usr/lib/gstreamer-1.0"
builddir="$srcdir"/gst-plugins-base-$pkgver

# secfixes:
#   1.8.3-r0:
#     - CVE-2016-9811
#     - CVE-2017-5837
#     - CVE-2017-5839
#     - CVE-2017-5842
#     - CVE-2017-5844

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-static \
		--disable-experimental \
		--disable-fatal-warnings \
		--with-default-audiosink=alsasink \
		--with-package-name="GStreamer Base Plugins (Alpine Linux)" \
		--with-package-origin="http://alpinelinux.org/" \
		|| return 1
	make || return 1
}

package() {
	cd "$builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	rm -f "$pkgdir"/usr/lib/*.a "$pkgdir"/usr/lib/gstreamer*/*.a
}

md5sums="4d03dd81828ea6b98a44c8f1ab7f4976  gst-plugins-base-1.8.3.tar.xz
846f769bf9731fb8dbf5a3b15e3f5c7f  CVE-2016-9811.patch
ff978d55489454bc3cb8484bbb91b83d  CVE-2017-5837.patch
44411f44d931aaab4b98a241351fd9e1  CVE-2017-5839.patch
81e7cf189f684fccde21586639ae354f  CVE-2017-5842.patch
bf83c9a4b5b912407febf1ef46695137  CVE-2017-5844.patch"
sha256sums="114871d4d63606b4af424a8433cd923e4ff66896b244bb7ac97b9da47f71e79e  gst-plugins-base-1.8.3.tar.xz
7d99877a850f8d51dd4580ed3a5b2df35ebda99aa99a512899586a28c5cc9d50  CVE-2016-9811.patch
a8d23b2be0154ab99d9340b03bd4851db599ed77982ea72e8c76e2fba272ac06  CVE-2017-5837.patch
96187c63e86bdec615b12e3471886e1bd73590b82a4c213ee7724ffe4528e4b5  CVE-2017-5839.patch
d687f8c3e398c2675144d4692a7060c6bb7b21c5b10b7b43fd1de94072ac07a3  CVE-2017-5842.patch
a2ba776741e695449531993b9e389ed1ca208b17f4517d31377abe71aca1e238  CVE-2017-5844.patch"
sha512sums="9fe88b73fe85be8614340f65515900998bdee010ebc39d6d4286b7ba39a82b75e58da76dc15e23fae7f228f4efa51c68935e2515ccc367d13dd68e173cf1ae0c  gst-plugins-base-1.8.3.tar.xz
6a64842bd2d2bdc8c4c0793b46f88f1ec6a5e25de9598a973ea542cec43ec4da4afd3857d4f0055cb0f6d2999d623b73003fdc61a09bb60922d32e53922ba935  CVE-2016-9811.patch
4514ab453df8f3653a84192d973cf76b616545f956f283d683362b2e0c23c1d86309311cf0610bae674e9c6e5adce2cc8b99fdb25977f47fc852d51e772f794a  CVE-2017-5837.patch
95ee0c94472906f7c830156a9d78323502e7e7605dec99f0c30009762339512169bf6e32d3c01ec54d381f6bb4b5459fd9fef981c8b337eb85236e61a9bac8f2  CVE-2017-5839.patch
1c949ec4e7a99b87677f883a54eb8848ba127242649c1a2b26094e3d3b9c6474ba8a85fd879d4f69da0dfbb0150f5e9ad4a542a0343e7d42ba230a1c00a27cfe  CVE-2017-5842.patch
f5a70ecc2967ee4980336e8b7b2c686b830864cfbf9da544487a5b53cbe119bacbfefccae0c7365523637085d86dc78a16cb7ac3f324c0bf993eaefa6d845745  CVE-2017-5844.patch"
