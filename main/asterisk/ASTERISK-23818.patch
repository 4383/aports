https://issues.asterisk.org/jira/browse/ASTERISK-23818
https://reviewboard.asterisk.org/r/3891

--- a/pbx/pbx_lua.c	(revision 420123)
+++ b/pbx/pbx_lua.c	(working copy)
@@ -1562,7 +1562,7 @@
 	return AST_MODULE_LOAD_SUCCESS;
 }
 
-AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT, "Lua PBX Switch",
+AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS, "Lua PBX Switch",
 		.load = load_module,
 		.unload = unload_module,
 		.reload = reload,
--- a/main/pbx.c	(revision 420123)
+++ b/main/pbx.c	(working copy)
@@ -7868,6 +7868,11 @@
 			ast_hashtab_end_traversal(prio_iter);
 		}
 		ast_hashtab_end_traversal(exten_iter);
+	} else if (new) {
+		/* If the context existed but had no extensions, we still want to merge
+		 * the includes, switches and ignore patterns.
+		 */
+		context_merge_incls_swits_igps_other_registrars(new, context, registrar);
 	}
 
 	if (!insert_count && !new && (strcmp(context->registrar, registrar) != 0 ||
