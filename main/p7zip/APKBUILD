# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=p7zip
pkgver=4.65
pkgrel=0
pkgdesc="A command-line port of the 7zip compression utility"
url="http://p7zip.sourceforge.net"
license="GPL"
subpackages="$pkgname-doc"
depends="uclibc uclibc++ libgcc"
makedepends="bash uclibc++-dev"
#install=p7zip.install
source="http://downloads.sourceforge.net/sourceforge/$pkgname/${pkgname}_${pkgver}_src_all.tar.bz2
	p7zip-cc-cxx.patch"

build ()
{
	cd "$srcdir"/${pkgname}_${pkgver}
	patch -p1 -i ../p7zip-cc-cxx.patch || return 1
	sed -i "s|usr/local|usr|g" makefile
	export CXX=${UC_CXX:-g++-uc}

	make all3 OPTFLAGS="${CXXFLAGS}" || return 1
	make install DEST_HOME="$pkgdir"/usr DEST_MAN="$pkgdir"/usr/share/man \
		DEST_SHARE_DOC="http://www.bugaco.com/7zip"

#	echo "creating dir"
#	mkdir -p "$pkgdir"/usr/share/doc/p7zip/DOCS
#	install -m555 bin/7z.so "$pkgdir"/usr/lib/p7zip/
	sed -i "s|"$pkgdir"/usr|/usr|g" "$pkgdir"/usr/bin/7z
	sed -i "s|"$pkgdir"/usr|/usr|g" "$pkgdir"/usr/bin/7za
	sed -i "s|"$pkgdir"/usr|/usr|g" "$pkgdir"/usr/bin/7zr
#	install -m755 -D contrib/VirtualFileSystemForMidnightCommander/u7z "$pkgdir"/usr/share/mc/extfs/u7z
}

md5sums="f78ed232436dc8f8be25a2f95d4e5f9a  p7zip_4.65_src_all.tar.bz2
8e8f415267bb5db179e4a8ed75985244  p7zip-cc-cxx.patch"
