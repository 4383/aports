# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Carlo Landmeter <clandmeter@gmail.com>
pkgname=freetype
pkgver=2.5.0.1
pkgrel=2
pkgdesc="TrueType font rendering library"
url="http://freetype.sourceforge.net"
arch="all"
license="GPL"
depends=
depends_dev="zlib-dev"
makedepends="$depends_dev libpng-dev"
subpackages="$pkgname-dev"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
20-enable-spr.patch
30-enable-valid.patch
40-memcpy-fix.patch
freetype-2.5.0-CVE-2014-2240.patch
freetype-2.5.0-CVE-2014-2241.patch
"

_builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd "$_builddir"
	for i in "$srcdir"/*.patch; do
		msg "Applying ${i}"
		patch -p1 -i $i || return 1
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--disable-static \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
}

md5sums="aa1c67c73bbcbcc61bece94ac7389731  freetype-2.5.0.1.tar.gz
d5f05193446891b7f7c99d215884fe28  20-enable-spr.patch
4fae619cdd03c010f679fb1d0637407a  30-enable-valid.patch
63273c96f6f60a3727d85263bce2e626  40-memcpy-fix.patch
e29654122be7dbfbc828b1f890257f40  freetype-2.5.0-CVE-2014-2240.patch
54d52c143c5e399972f2928d17b0f28e  freetype-2.5.0-CVE-2014-2241.patch"
sha256sums="8eec68b480bc7c1e2bce365f07f8c4cc29c1c238ac8737b8281c3895f5013cfc  freetype-2.5.0.1.tar.gz
31a2d30b00bf5d33eeb88bd37aa6c3abf133d174b3f38dd6a362e487e47b0577  20-enable-spr.patch
bd4486ab21cb7562a6871ad8bcda7caca6f08092903e5d32aa1aff77d3e99549  30-enable-valid.patch
82bae6ee05b0c4f7510b88059b7e2e2c0d3ae0cc31c8f85afc6a8a3e4d6c4954  40-memcpy-fix.patch
902e8f228f14e3a924bde74cf3ffeb7152882ba99336c031e9f4ea63ad9ad836  freetype-2.5.0-CVE-2014-2240.patch
5aeb1b5630760e27dcb3ddc85b411d6f2ce1ab8caaf250e879802e505600e2a5  freetype-2.5.0-CVE-2014-2241.patch"
sha512sums="e8c1d127730d9085845069845ea85e2dcbfa4b8446455758a748a122e87bf247a4bcec248fcf2da4f6c8331dc7e7aa1ec73444863a44f9d77003687546f2de78  freetype-2.5.0.1.tar.gz
5121d29cd6db7ff35d609845ee5dd42c6514b910335515c31d22d3f4eed48d6754a2e7caed2bdcff33c0f962cdfb1f4746a236aa46e81d8e299e7549c70334af  20-enable-spr.patch
5979c1522012285f0984b6da07004fd1ea3821b8900190b83af81bae59899d16f34143dc2259b59ab977c859158874842e2d0e1fc041c025af87ed3d9e8652c9  30-enable-valid.patch
80d76a6b5dab4765656b7e62eb0b91c29f44742321fce6f75f9081c125632f3e919f6b2f4a12175717eaf5106cc8f83cbfaaa85e21ea94fd2cbc7c2c1c76da97  40-memcpy-fix.patch
d04f9ba99f18b5887553c6bcff1f8344c55c0264c148f0630df3660282b7a022ad87e1b92ed50370416be2eb180517662a98eb5954120d80271b926e041b8038  freetype-2.5.0-CVE-2014-2240.patch
12c6e0bc086a9968d0198dce50c3e34a417d52bfadbf80da27e22c97caa13c660a0d22a3c66a5344de172fcd829af686c60c58d0cd64b876099b61ce3a39d38b  freetype-2.5.0-CVE-2014-2241.patch"
