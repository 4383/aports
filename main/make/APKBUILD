# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=make
pkgver=3.82
pkgrel=6
pkgdesc="GNU make utility to maintain groups of programs"
url="http://www.gnu.org/software/make"
arch="all"
license="GPL3+"
depends=""
subpackages="$pkgname-doc"
source="ftp://ftp.gnu.org/gnu/$pkgname/$pkgname-$pkgver.tar.bz2
	make-3.82-savannah-bugs-30612-30723.patch
	make-3.82-copy-on-expand.patch
	make-3.82-memory-corruption.patch
	make-3.82-jobserver.patch
	make-3.82-expensive_glob.patch
	make-3.82-parallel-remake.patch
	make-3.82-dont-prune-intermediate.patch
	make-3.82-arg-list-length.patch
	use-malloc.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--disable-nls \
		|| return 1
	make || return 1
	[ "$CBUILD" = "$CHOST" ] && (make check || return 1)
	return 0
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
}

md5sums="1a11100f3c63fcf5753818e59d63088f  make-3.82.tar.bz2
74e598a2052f7d98e3495ea9d917ecf4  make-3.82-savannah-bugs-30612-30723.patch
9545e667ab5eafdef5b658941290cc26  make-3.82-copy-on-expand.patch
0436e740edbc81cf27fd598241b8dcf0  make-3.82-memory-corruption.patch
923a06973f4bbc9f27c2ca88a6940d45  make-3.82-jobserver.patch
f2ed48ea701e8ab6e5b870a3d125b71a  make-3.82-expensive_glob.patch
89f8032d2f314eb6338739f024d8ecec  make-3.82-parallel-remake.patch
97c9f064c4006c41f29d67febda858af  make-3.82-dont-prune-intermediate.patch
1d175e00f931b7d866d2fddcf0c0b302  make-3.82-arg-list-length.patch
c5b90dd539b5950ac2cf502f266c66aa  use-malloc.patch"
sha256sums="e2c1a73f179c40c71e2fe8abf8a8a0688b8499538512984da4a76958d0402966  make-3.82.tar.bz2
3860600de372c1f9f979f57170b14ae682847d6b9ecef24bb78d8a166e611338  make-3.82-savannah-bugs-30612-30723.patch
d85e18a4e53456f7c1c3e9c413e6bc150cf67cd6a3830aae4130f52ce841fedc  make-3.82-copy-on-expand.patch
79b8e0c1edb1a4d0199dab98ac171c9b58f21fd3fc15659938cf3c8e76806178  make-3.82-memory-corruption.patch
505ca52d0ecfa452a93139bbe1485ea9441c38f3dea0e99687c6bf0fe728a3d6  make-3.82-jobserver.patch
df7775de5c97ecfe35df0c6abdf30d607484effbd2ebcee9d285c1c1c2b9935c  make-3.82-expensive_glob.patch
17d7749144be57e7bdec7e2d1bd8cc4f183350ff4271adf91cc3654e3b8c99ba  make-3.82-parallel-remake.patch
bba70ca6589f5afe8f1cf5b2f9cbec54fdbbf5685188ff0ebe5100034ee17b58  make-3.82-dont-prune-intermediate.patch
797cd4461687372e74881dd28059ad96fd2cdbf0f14c7aa3470019a8d8c1966f  make-3.82-arg-list-length.patch
f3c6711071100e0e6f935a74dc60c05a66f77b011c13f2116853c3e5e6099187  use-malloc.patch"
sha512sums="3260be0d1a9a7c5eb0dbb87179a9a9521fdfc7809ca51f13ee5a37ba5e63d21ad50a4249ec7d3929a9d0ce8c8f6cf302558743964f0f7ff742efe283b91df9de  make-3.82.tar.bz2
3ce82573396ccdbe22f24b7bea1bd1b74b2dd902bf13cbfa501215f24b736674db78d35e637a9e1cc261471fc15eb5d6862c0e3d93197ec9905ac0b0949d09ac  make-3.82-savannah-bugs-30612-30723.patch
65437ed314dc16b36fc88ddd86ca04961144753d89da0fba634a8161c4560efc3ecfe7c1cebef7c3a971ac7aba8ea7fc7dd1593daf5ee4222712ae7513048379  make-3.82-copy-on-expand.patch
20b0e0141046812bf253ba5a15f7079deeae86ee8103002621c4e1916c71f03cf9146308119478837b3a4009c4fd5372ef472b595577ea7b358fc21ee819dbb8  make-3.82-memory-corruption.patch
71bce157e6ee14a4b01705fce23839f0519d4fab052704fef6c0a4b5245a37954b595b0a93e4a320ef878efdd4802950c75782f10cb86a1277782144a6acc590  make-3.82-jobserver.patch
130b7afd1bc78ddf93c4d6f1d8b56e35365bbfb49e13de098fa6548b4c5e9628d188864d085899b87d81823c3c5faf862a64c59a7b48f20f3601e74b0592b606  make-3.82-expensive_glob.patch
89217ad37e77944cee4cb81b074bbdb8f047132cb7987c2af3c6b577b13bae079d0dcad548402bcf85865d890acabec4447dcaceb8f44c58cec2325bd59427d5  make-3.82-parallel-remake.patch
0e522677e8f62cca4aca26fbe22b1a5da5006a5459fe7b0a22c2d8ca358457ea8c0652eae052d3372967b631e68bdecdf0662e2219755b29e480766d0f0a23cd  make-3.82-dont-prune-intermediate.patch
b9623dd57116b2e660e004676338fb3c28557f0f1d4756b29b8b50eddb1beed4a7df7bd2bf1c9066c10110c2ff0331c012ade40bfd47b7ec4839ba94d6442d8a  make-3.82-arg-list-length.patch
e583971aae1569c04529db347e56eb84ec4cc9edf17e0b66999c595a211206939adf47bb3b72d66bb92b59159f59009f9a345dadcb9a2667639a2b901878e25d  use-malloc.patch"
