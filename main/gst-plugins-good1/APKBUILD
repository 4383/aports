# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gst-plugins-good1
pkgver=1.8.3
pkgrel=0
pkgdesc="GStreamer Multimedia Framework Good Plugins"
url="http://gstreamer.freedesktop.org/"
arch="all"
license="LGPL"
subpackages="$pkgname-lang"
depends=
depends_dev="gstreamer1-dev gst-plugins-base1-dev"
makedepends="$depends_dev
	flac-dev
	gdk-pixbuf-dev
	glib-dev
	jack-dev
	libavc1394-dev
	libdv-dev
	libgudev-dev
	libice-dev
	libiec61883-dev
	libjpeg-turbo-dev
	libogg-dev
	liboil-dev
	libpng-dev
	libshout-dev
	libsm-dev
	libsoup-dev
	libvpx-dev
	libxdamage-dev
	libxext-dev
	libxv-dev
	linux-headers
	orc-dev
	taglib-dev
	v4l-utils-dev
	wavpack-dev
	zlib-dev
	"
ldpath="/usr/lib/gstreamer-1.0"

source="http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-$pkgver.tar.xz
	CVE-2016-9634-9635.patch
	002-flxdec-fix-some-warnings-comparing-unsigned.patch
	CVE-2016-9636.patch
	CVE-2016-9808.patch
	CVE-2016-10198.patch
	CVE-2016-10199.patch
	CVE-2017-5840-1.patch
	CVE-2017-5840-2.patch
	CVE-2017-5841.patch
	CVE-2017-5845.patch
	"

# secfixes:
#   1.8.3-r0:
#   - CVE-2016-9634
#   - CVE-2016-9635
#   - CVE-2016-9636
#   - CVE-2016-9808
#   - CVE-2016-10198
#   - CVE-2016-10199
#   - CVE-2017-5840
#   - CVE-2017-5841
#   - CVE-2017-5845

_builddir="$srcdir"/gst-plugins-good-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-static \
		--enable-experimental \
		--disable-fatal-warnings \
		--with-package-name="GStreamer Good Plugins (Alpine Linux)" \
		--with-package-origin="http://alpinelinux.org/" \
		|| return 1
	make
}

package() {
	cd "$_builddir"

	export GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1
	make DESTDIR="$pkgdir" install || return 1
}

md5sums="473ebb1f15c67de99ddb6e4d027c0876  gst-plugins-good-1.8.3.tar.xz
3478bc474b86c1f69594c97d52c1a435  CVE-2016-9634-9635.patch
d3fa9170a9c109724e96be77a2f9e9b8  002-flxdec-fix-some-warnings-comparing-unsigned.patch
030eb22c27d6350cf2b13b62afc060b7  CVE-2016-9636.patch
526926ed987a5c26bc720ccbd59bd387  CVE-2016-9808.patch
26bbf7574634adfe76b0b3af2df0a99d  CVE-2016-10198.patch
dffbb65093cee1cd2e27b15e628c965b  CVE-2016-10199.patch
1d9ba2f16d0b8cb9b05a945923f007b6  CVE-2017-5840-1.patch
a76f687e93273d4751fe351e96e47108  CVE-2017-5840-2.patch
8d72b512b6dd1c84bbada6ed80fc15ff  CVE-2017-5841.patch
8bcb98b626770ea30a7ad5f5c96aed25  CVE-2017-5845.patch"
sha256sums="a1d6579ba203a7734927c24b90bf6590d846c5a5fcec01a48201018c8ad2827a  gst-plugins-good-1.8.3.tar.xz
ec2deb569fb63af0d678ff8ec5183d45dd8cea480f2c9ec859f06c04a111e678  CVE-2016-9634-9635.patch
71aeec02c26b8ea7bf7dbd6645be7be19e19d875ef961fd4d02c182f2cdde527  002-flxdec-fix-some-warnings-comparing-unsigned.patch
476159b1144a6278487aff2c263f43e79d1bc0006f77f1929b799e5d6f7d38e7  CVE-2016-9636.patch
c330a86f5e196096c7dd51c1ec0fb3e56bae3ac9260fe2417aae86f00a882fe6  CVE-2016-9808.patch
ec45cd206142ad57d17bad534eef2d600d84b201942ba2077f52b4024cb35ff8  CVE-2016-10198.patch
fb3b360387ff37617aceaeb50056f30e38932097440bb4bd94a416426d77127e  CVE-2016-10199.patch
6dbfb2840af6af0b235a29540949ba42f5c1ffc26150292316f06a033b7a3738  CVE-2017-5840-1.patch
79f4afa03a2938dc5e0e720eef4faf55731eb752b99084dc8a53f4348b92d9ca  CVE-2017-5840-2.patch
62bdc826f8f5fb518dcee6e14ce439c6ef3a2acb7ecacc971765cebf5a0cb4a8  CVE-2017-5841.patch
79869f5e2fc44967b04c98e12be2fed8b50a629b2e91fa6ce9a3609db5ee2363  CVE-2017-5845.patch"
sha512sums="4f35f6e20c6a3b448bbf2690b2ad36a496b8b0efadc67e0fec218ed33856588a2b937020791f7ec4ab8a406ce82c178164349e31d4fabe8c7362716b44015f4a  gst-plugins-good-1.8.3.tar.xz
435e8e45d78c8793090427d1bef3afc0776f0477392a0b74b0e046e23b6b3f9e4eb7a11c55b77d4595c011fbce5a40224df9ce0f2bdde963efb861d1e8077d98  CVE-2016-9634-9635.patch
eb2b7cf42850d8870d0dd5266ec9c54f5c1761432ef7fc726408360c7a9189abfdf3d94a05f439a52239a37687e8ef370eed40282272ff81c1c9d84f6fbce07e  002-flxdec-fix-some-warnings-comparing-unsigned.patch
243ba890c377d77463e2d7d74e610e2336887d2a298c02a294472d089d534d71ad058036a7c5c04018e1629921abab4e71f2002282a739f89c92411182370c1c  CVE-2016-9636.patch
ab24bf773bbf521b98e065be53f46959d3a3a47b2ac59494ecfd9947b0e66438dbfd713f522d98fcace923a3536b218a59e1ed890c6594a1034451fa60b7d333  CVE-2016-9808.patch
e6716c8f8f97abdeb6f5702ac5d1f6c331c5eb062d70eb2b20c286560a41c283e0cde241100b1ba8958f8e8e03fd96e9672cf3b5fd5bc0d93eb0876141b597c5  CVE-2016-10198.patch
2e2476e524a26e99a3d46a54ea9669b85e82bdaabe42379960b14b3b76b41a07c849418b62b0f851bce47b2371c41775e15785dcb913fd2e84ec7af2e41efbd3  CVE-2016-10199.patch
9d599da02acb6d266423461ace4aaa1876e933cecfffd5054bafd7a8481a580b72c00e0b8bc5dd28992ea229d2fd34aad20583282210f782c78d9c87cd945463  CVE-2017-5840-1.patch
f0a26c7c66ec76e94b578ad75cc2a2558f8b65eaeb0dd6f4ecb0169dd70d107f38592871246444dd607cf1c72e9612930f9c51c3715d21cfd1bf6829b70e9027  CVE-2017-5840-2.patch
d49d9527d1ef56b44b2a254e5400641e47029aa449f2e71d5ab1aee1a6d6b8e66b12dbb4afdb55e33002cf86330e64c45ccc4605d7f11d8f63999f25b2302257  CVE-2017-5841.patch
bca6e06c8be9f023654510feb8f711b94148955d5ce9478ab87ce5c0eaa811d4a1894eb864b77313683746cf01a54b7961931abfb3680c259481e8e930a25da8  CVE-2017-5845.patch"
