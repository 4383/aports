From 1e6d4b150de2288f4ae60e0e20e3c663dc6233aa Mon Sep 17 00:00:00 2001
From: Jannis Pohlmann <jannis@xfce.org>
Date: Mon, 08 Nov 2010 10:50:50 +0000
Subject: Fix a crash due to accessing the wrong variable when adding menu items.

---
diff --git a/NEWS b/NEWS
index eeb944c..3ba1e4e 100644
--- a/NEWS
+++ b/NEWS
@@ -1,3 +1,10 @@
+Xfdesktop 4.7.x
+---------------
+
+  * Fix a crash caused by accessing the wrong variable when adding
+    items to the right-click menu.
+
+
 Xfdesktop 4.7.2
 ---------------
 
diff --git a/src/xfdesktop-app-menu-item.c b/src/xfdesktop-app-menu-item.c
index 0bfddb9..e10696a 100644
--- a/src/xfdesktop-app-menu-item.c
+++ b/src/xfdesktop-app-menu-item.c
@@ -173,7 +173,7 @@ xfdesktop_app_menu_item_set_icon(XfdesktopAppMenuItem *app_menu_item)
     GdkPixbuf *pixbuf = NULL;
     GtkWidget *image;
     GtkIconTheme *icon_theme;
-    gchar *p, *name;
+    gchar *p, *name = NULL;
     gchar *filename;
 
     icon_name = garcon_menu_item_get_icon_name(app_menu_item->item);
@@ -199,7 +199,7 @@ xfdesktop_app_menu_item_set_icon(XfdesktopAppMenuItem *app_menu_item)
 
                 /* maybe they point to a file in the pixbufs folder */
                 if (G_UNLIKELY(pixbuf == NULL)) {
-                    filename = g_build_filename("pixmaps", name, NULL);
+                    filename = g_build_filename("pixmaps", icon_name, NULL);
                     name = xfce_resource_lookup(XFCE_RESOURCE_DATA, filename);
                     g_free(filename);
 
--
cgit v0.8.3.4
