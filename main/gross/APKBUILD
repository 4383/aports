# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gross
pkgver=1.0.1
pkgrel=2
pkgdesc="Greylisting of suspicious sources"
url="http://code.google.com/p/gross/"
license="BSD"
depends=
makedepends="c-ares-dev autoconf automake libtool sed"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-upgrade 
	$pkgname.post-upgrade"
subpackages="$pkgname-doc $pkgname-dev"
source="http://gross.googlecode.com/files/$pkgname-$pkgver.tar.gz
	grossd.initd
	grossd.confd
	gross-1.0.1-configure.ac.patch
	gross-1.0.1-default-conf.patch
	gross-1.0.1-user.patch
	$install"

build() {
        cd "$srcdir/$pkgname-$pkgver"

	for _i in ../*.patch; do
		msg "Applying $_i..."
		patch -p1 < $_i || return 1
	done
	msg "Running autotools..."
	aclocal --force && autoconf && automake --add-missing \
		&& libtoolize --force --copy || return 1

	export lt_SED='/bin/sed'
	export lt_cv_path_SED='/bin/sed'
        ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --mandir=/usr/share/man \
                --infodir=/usr/share/info

        make -j1 || return 1
        make -j1 DESTDIR="$pkgdir" install

        install -dD "$pkgdir"/var/run/gross
        install -m755 -D "$srcdir"/grossd.initd "$pkgdir"/etc/init.d/grossd
        install -m644 -D "$srcdir"/grossd.confd "$pkgdir"/etc/conf.d/grossd
}

md5sums="f8f81b36850dcda30cb81799b9cee3b6  gross-1.0.1.tar.gz
b0d8635b64c4a90d72c49e868f4c4c32  grossd.initd
5ca1c6e51c3243236e6564480b20279b  grossd.confd
bb75b119ac96b8f99831ce6df810003f  gross-1.0.1-configure.ac.patch
7c504b653c71dcf7b192bc487b3516fd  gross-1.0.1-default-conf.patch
16e184d59d520db565388f010cc75e83  gross-1.0.1-user.patch
8f6e45b98888dbb9971f7681bf431f6f  gross.pre-install
4b55d1c5534167946cc11376d1b05c34  gross.post-install
87e7d76dace9cedf61efc04cdb6a905c  gross.pre-upgrade
46df3a643ba26f3eb2d6a09f616e421d  gross.post-upgrade"
