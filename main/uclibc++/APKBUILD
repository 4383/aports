# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=uclibc++
pkgver=0.2.2
pkgrel=3
pkgdesc="Embedded C++ library"
url="http://cxx.uclibc.org/"
license='GPL-2'
depends=
makedepends=
subpackages="$pkgname-dev"
source="http://cxx.uclibc.org/src/uClibc++-$pkgver.tar.bz2
	associative_base.patch
	uclibc++-gcc-4.3.patch
	uclibc++config
	"

build() {
	cd "$srcdir/uClibc++-$pkgver"
	cp ../uclibc++config .config
	make oldconfig

	for i in ../*.patch; do
		if ! patch -p1 < $i; then
			error "failed to apply $i"
			return 1
		fi
	done
	sed -i -e 's:bin/bash:bin/sh:' bin/Makefile scripts/find_lib*
	make || return 1
	make DESTDIR="$pkgdir/" install
}

dev() {
	depends="$pkgname g++"
	mkdir -p "$subpkgdir"
	# move everything to -dev package except *.so files
	mv "$pkgdir"/* "$subpkgdir"/
	mkdir -p "$pkgdir"/usr/lib/
	mv "$subpkgdir"/usr/lib/*.so* \
		"$pkgdir"/usr/lib/
}


md5sums="1ceef3209cca88be8f1bd9de99735954  uClibc++-0.2.2.tar.bz2
5689baa3f3bf8488c0a5d27a690d30fa  associative_base.patch
4c7b499e4697225378acef25f6364e9b  uclibc++-gcc-4.3.patch
2f573c1e2a0c7a320ea4685cc3ce9e2a  uclibc++config"
