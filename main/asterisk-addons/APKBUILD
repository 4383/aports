# Contributor: Carlo Landmeter
# Maintainer: 
pkgname=asterisk-addons
pkgver=1.6.2.1
pkgrel=0
pkgdesc="Asterisk addons"
url="http://www.asterisk.org"
license="GPL2"
makedepends="mysql-dev asterisk-dev autoconf automake"
install=
subpackages="$pkgname-mysql $pkgname-mp3 $pkgname-ooh323 $pkgname-saycountpl"
depends="$subpackages"
source="http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-addons-1.6.2.1.tar.gz"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	./bootstrap.sh
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info
	
	make -j1 || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install
	make -j1 DESTDIR="$pkgdir" samples
	# we are not building the mobile module because aports does not have bluez so we delete mobile.conf
	rm -rf "$pkgdir"/etc
}

_find_and_move() {
        local pattern="$1"
        cd "$pkgdir" || return 1
        find -name "$pattern" -type f | while read f; do
                local dest="$subpkgdir/${f%/*}"
                mkdir -p "$dest"
                mv "$f" "$dest"
        done
}

mysql() {
	_find_and_move '*mysql*'
}

mp3() {
	_find_and_move '*mp3*'
}

ooh323() {
	_find_and_move '*ooh323*'
}

saycountpl() {
	_find_and_move '*saycountpl*'
	mv "$pkgdir"/var "$subpkgdir"
}

md5sums="95e33f22f53d58ac95c54d2c8b8d9d76  asterisk-addons-1.6.2.1.tar.gz"
