# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxfont
pkgver=1.4.7
pkgrel=1
pkgdesc="X11 font rasterisation library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
install=
depends_dev="xproto fontsproto libfontenc-dev freetype-dev"
makedepends="$depends_dev xtrans zlib-dev"
source="http://xorg.freedesktop.org/archive/individual/lib/libXfont-$pkgver.tar.bz2
	0001-CVE-2014-0209-integer-overflow-of-realloc-size-in-Fo.patch
	0002-CVE-2014-0209-integer-overflow-of-realloc-size-in-le.patch
	0003-CVE-2014-0210-unvalidated-length-in-_fs_recv_conn_se.patch
	0004-CVE-2014-0210-unvalidated-lengths-when-reading-repli.patch
	0005-CVE-2014-0211-Integer-overflow-in-fs_get_reply-_fs_s.patch
	0006-CVE-2014-0210-unvalidated-length-fields-in-fs_read_q.patch
	0007-CVE-2014-0211-integer-overflow-in-fs_read_extent_inf.patch
	0008-CVE-2014-0211-integer-overflow-in-fs_alloc_glyphs.patch
	0009-CVE-2014-0210-unvalidated-length-fields-in-fs_read_e.patch
	0010-CVE-2014-0210-unvalidated-length-fields-in-fs_read_g.patch
	0011-CVE-2014-0210-unvalidated-length-fields-in-fs_read_l.patch
	0012-CVE-2014-0210-unvalidated-length-fields-in-fs_read_l.patch
	"

_builddir="$srcdir"/libXfont-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr --sysconfdir=/etc || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="b21ee5739d5d2e5028b302fbf9fe630b  libXfont-1.4.7.tar.bz2
668afc297c74ecf43181a4e74f809bb9  0001-CVE-2014-0209-integer-overflow-of-realloc-size-in-Fo.patch
7937d8a986b630fe9644aaf54f5682a8  0002-CVE-2014-0209-integer-overflow-of-realloc-size-in-le.patch
6f564f692b7e2c2be3b9c7401412ea8c  0003-CVE-2014-0210-unvalidated-length-in-_fs_recv_conn_se.patch
e4fd1232c4302c50713dbe50d36d4d89  0004-CVE-2014-0210-unvalidated-lengths-when-reading-repli.patch
cf0cb5b812e19fe51fa3fb2815809e57  0005-CVE-2014-0211-Integer-overflow-in-fs_get_reply-_fs_s.patch
01bab2b702009dbeeac8b606fddbd5f5  0006-CVE-2014-0210-unvalidated-length-fields-in-fs_read_q.patch
52837a81d1fc78e2e5b5d293f6232e40  0007-CVE-2014-0211-integer-overflow-in-fs_read_extent_inf.patch
83415b6f84483b0bc65bf240f207c8ed  0008-CVE-2014-0211-integer-overflow-in-fs_alloc_glyphs.patch
105701747318cc10c53ada565789431b  0009-CVE-2014-0210-unvalidated-length-fields-in-fs_read_e.patch
0c82f29bc9ab1b979b26cc63a143a1aa  0010-CVE-2014-0210-unvalidated-length-fields-in-fs_read_g.patch
5124af8241ccfa9cf89d81d3ce03ca6d  0011-CVE-2014-0210-unvalidated-length-fields-in-fs_read_l.patch
0174e6c3785aaa619ed0525988401628  0012-CVE-2014-0210-unvalidated-length-fields-in-fs_read_l.patch"
