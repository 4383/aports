# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=ncurses
pkgver=5.8
pkgrel=1
pkgdesc="Console display library"
url="http://www.gnu.org/software/ncurses/"
arch="all"
license=MIT
depends=
source="ftp://ftp.gnu.org/pub/gnu/${pkgname}/${pkgname}-${pkgver}.tar.gz"
subpackages="$pkgname-dev $pkgname-doc $pkgname-base $pkgname-terminfo $pkgname-libs"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	./configure \
	 	--mandir=/usr/share/man \
	 	--disable-ada \
		--disable-termcap \
		--without-cxx-binding \
		--with-terminfo-dirs="/etc/terminfo:/usr/share/terminfo" \
		--with-shared

	make || return 1
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make install DESTDIR="$pkgdir"

	# Install basic terms in /etc/terminfo
	for i in ansi console dumb linux rxvt screen sun vt52 vt100 vt102 \
	 		vt200 vt220 xterm xterm-color xterm-xfree86; do
		local termfile=$(find "$pkgdir"/usr/share/terminfo/ -name "$i" 2>/dev/null)
		local basedir=$(basename $(dirname "$termfile"))

		[ -z "$termfile" ] && continue

		install -d "$pkgdir"/etc/terminfo/$basedir
		mv ${termfile} "$pkgdir"/etc/terminfo/$basedir/
		ln -s ../../../../etc/terminfo/$basedir/$i \
			"$pkgdir"/usr/share/terminfo/$basedir/$i
	done
}

terminfo() {
	rm -rf $subpkgdir
	mkdir -p $subpkgdir/usr/share
	mv $pkgdir/usr/share/terminfo $subpkgdir/usr/share
}

libs() {
	pkgdesc="Ncurses libraries"
	replaces="ncurses"
	depends="ncurses-base"
	mkdir -p "$subpkgdir"/usr/
	mv "$pkgdir"/usr/lib "$subpkgdir"/usr/
}

base() {
	pkgdesc="Descriptions of common terminals"
	replaces="ncurses"
	mkdir -p "$subpkgdir"/etc
	mv "$pkgdir"/etc/terminfo "$subpkgdir"/etc/
}

md5sums="20ed3fa7599937f0ca268d9088837a64  ncurses-5.8.tar.gz"
