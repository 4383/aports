# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Contributor: Sergey Lukin <sergej.lukin@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=zeromq
pkgver=4.0.5
pkgrel=1
pkgdesc="The ZeroMQ messaging library and tools"
url="http://www.zeromq.org/"
arch="all"
license="LGPLv3+"
depends=
makedepends="util-linux-dev openpgm-dev perl python autoconf automake"
install=
subpackages="$pkgname-dev $pkgname-doc libzmq"
source="http://download.zeromq.org/zeromq-$pkgver.tar.gz
	CVE-2014-9721.patch
	"

builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	update_config_sub || return 1
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--with-system-pgm \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		|| return 1
	make || return 1
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	rm -f "$pkgdir"/usr/lib/*.la
}

libzmq() {
	pkgdesc="The ZeroMQ messaging library"
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/libzmq.so.* "$subpkgdir"/usr/lib/
}

md5sums="73c39f5eb01b9d7eaf74a5d899f1d03d  zeromq-4.0.5.tar.gz
320491e2ef2ab0f3e980a30e25fc2563  CVE-2014-9721.patch"
sha256sums="3bc93c5f67370341428364ce007d448f4bb58a0eaabd0a60697d8086bc43342b  zeromq-4.0.5.tar.gz
5cf92b204709e97043ddf9b5ae7ed36bda835c5f9831de02209451589f054427  CVE-2014-9721.patch"
sha512sums="0d928ed688ed940d460fa8f8d574a9819dccc4e030d735a8c7db71b59287ee50fa741a08249e356c78356b03c2174f2f2699f05aa7dc3d380ed47d8d7bab5408  zeromq-4.0.5.tar.gz
eefc48fa851059092c09e4e22125e9a25f6da1506624dd4b1417c974f630e798bcd54257214c9fc4de6d2f92fb4a8b78607b6400e8d09c64284b566e3bfc0d98  CVE-2014-9721.patch"
