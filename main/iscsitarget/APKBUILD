# Maintainer: Natanael Copa <ncopa@alpinelinux.org>

pkgname=iscsitarget
pkgver=0.4.17
pkgrel=3
pkgdesc="Open Source iSCSI target with professional features - userspace utils"
url="http://iscsitarget.sourceforge.net/"
license="GPL-2"
depends=
makedepends="openssl-dev"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
	$pkgname-0.4.15-isns-set-scn-flag.patch
	$pkgname-0.4.17-build.patch
	ietd.initd
	ietd.confd
	"

build() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in ../*.patch; do
		msg "Applying $i"
		patch -p1 < $i || return 1
	done
	
	make usr || return 1
	make DISTDIR="$pkgdir" install-usr install-doc

	for i in etc/ietd.conf etc/initiators.*; do
		install -Dm640 $i "$pkgdir"/$i || return 1
	done
	install -Dm755 ../ietd.initd "$pkgdir"/etc/init.d/ietd
	install -Dm755 ../ietd.confd "$pkgdir"/etc/conf.d/ietd
}

md5sums="e79b437695fc50e7d054631855a16b1b  iscsitarget-0.4.17.tar.gz
22512c5cf4cb62127730ce53d74ff28f  iscsitarget-0.4.15-isns-set-scn-flag.patch
c9a9b839b3afcdecd1601511ee48a171  iscsitarget-0.4.17-build.patch
9b0ca79dc47b12024c2b67d828d6d361  ietd.initd
06ba479d3533d557b8582abe6f182410  ietd.confd"
