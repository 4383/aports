# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=quagga
pkgver=0.99.13
pkgrel=2
pkgdesc="A free routing daemon replacing Zebra supporting RIP, OSPF and BGP."
url="http://quagga.net/"
license="GPL-2"
depends="iproute2"
makedepends="readline-dev ncurses-dev gawk
	autoconf automake libtool"
install="$pkgname.pre-install $pkgname.post-install"
subpackages="$pkgname-dev $pkgname-doc"
source="http://www.quagga.net/download/$pkgname-$pkgver.tar.gz
	$pkgname-0.99.11-link-libcap.patch
	$pkgname-0.99.11-ipv6-only.patch
	$pkgname-0.99.11-del-routes.patch
	$pkgname-0.99.11-zombie.patch
	$pkgname-0.99.11-fd-leak.patch
	bgpd.initd
	ospf6d.initd
	ospfd.initd
	ripd.initd
	ripngd.initd
	zebra.initd
	zebra.confd
	"

build() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 < $i || return 1
	done

	msg "Running autotools..."
	aclocal || return 1
	autoconf || return 1
	automake || return 1
	libtoolize || return 1

	./configure --prefix=/usr \
		--disable-static \
		--enable-ipv6 \
		--enable-ospf6d \
		--enable-rtadv \
		--enable-user=quagga \
		--enable-group=quagga \
		--enable-vty-group=quagga \
		--enable-vtysh \
		--sysconfdir=/etc/quagga \
		--enable-exampledir=/usr/share/doc/quagga/ \
		--localstatedir=/var/run/quagga \
		|| return 1

	make || return 1
	make DESTDIR="$pkgdir" install

	install -d "$pkgdir"/var/run/quagga
	for i in zebra ripd ospfd bgpd ripngd ospf6d; do
		install -Dm755 "$srcdir"/$i.initd "$pkgdir"/etc/init.d/$i
	done
	install -Dm644 "$srcdir/zebra.confd" "$pkgdir"/etc/conf.d/zebra
}
md5sums="55a7d2dcf016580a7c7412b3518cd942  quagga-0.99.13.tar.gz
8f99d41a8ed79e51704e8f655d255f29  quagga-0.99.11-link-libcap.patch
44c517e988273e0e5076d24f3959a125  quagga-0.99.11-ipv6-only.patch
1cbcf60a637b2577dee4d6df711e1247  quagga-0.99.11-del-routes.patch
ce345725f2e7240cebe0fd5ac2b2fc48  quagga-0.99.11-zombie.patch
e2391e19b542ec1743776ca9e36ac11a  quagga-0.99.11-fd-leak.patch
c4c3b174b1e3400a143407fcc3d27cf5  bgpd.initd
92aba039c049050c48abf984c2db7e2b  ospf6d.initd
878328ead225e6eb5f5f77f05ab39106  ospfd.initd
5945863133a0db33898c5c39ef23663c  ripd.initd
cda4115283d9f4a8304fec1b6881a7eb  ripngd.initd
be935134c5e3400989b427d7c114e634  zebra.initd
34e06a1d2bc602ce691abc9ed169dd15  zebra.confd"
