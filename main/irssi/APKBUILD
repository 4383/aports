# Maintainer: Kiyoshi Aman <kiyoshi.aman at gmail.com>
pkgname=irssi
pkgver=0.8.15
pkgrel=14
pkgdesc="A modular textUI IRC client with IPv6 support"
url="http://irssi.org/"
arch="all"
license="GPL2+"
depends="perl"
makedepends="glib-dev openssl-dev ncurses-dev perl-dev pkgconfig"
source="http://irssi.org/files/irssi-${pkgver}.tar.bz2
		$pkgname-italics.patch
		"
subpackages="$pkgname-doc $pkgname-dev $pkgname-proxy:proxy"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--with-perl-staticlib \
		--with-proxy \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	find "$pkgdir" -name perllocal.pod -delete
	rm "$pkgdir"/usr/lib/irssi/modules/*.la
}

proxy() {
	depends="$pkgname"
	pkgdesc="Irssi module for enabling bouncer-like functionality"
	mkdir -p "$subpkgdir"/usr/lib/irssi/modules
	mv "$pkgdir"/usr/lib/irssi/modules/libirc_proxy.* "$subpkgdir"/usr/lib/irssi/modules/
}

md5sums="1dcb3f511b88df94b0c996f36668c7da  irssi-0.8.15.tar.bz2
bb8b9f8b960837ad061a8e5b9b19824b  irssi-italics.patch"
sha256sums="c12d16fb605103d7c256ddce44012dc396af57f3771e086d0387c195a052a0a6  irssi-0.8.15.tar.bz2
3e65898551e89e99ddce83ab69a8a37209181a1e6ae09bd9412805c9bf8cffa5  irssi-italics.patch"
sha512sums="cecda925ae7c422fd95e8e94a123be8732a59a3a3c5d149b2fe16e1cac78cc516acb7a89ad79cf4ac0c412c9d4d3ea83fe5c0535ab6428e98479dc8909d0615a  irssi-0.8.15.tar.bz2
cc46ee115cbad0a1df55f4d6fff31b0dddc526c29b49108338c16baf4b632627a818b8fb0ab4b6a51cf1c0e1b5da26eaecf3ecf087bdedcc1b7a80e21d0e5c08  irssi-italics.patch"
