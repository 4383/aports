# Contributor: Michael Mason <ms13sp@gmail.com>
# Maintainer: Michael Mason <ms13sp@gmail.com>
pkgname=tinyproxy
pkgver=1.6.3
pkgrel=2
pkgdesc="Lightweight HTTP proxy"
pkgusers="tinyproxy"
pkggroups="tinyproxy"
url="https://www.banu.com/tinyproxy/"
license="GPL"
depends=
makedepends=
install="tinyproxy.pre-install" # tinyproxy.post-install"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
	tinyproxy.initd
	"

build() {
	cd "$srcdir/$pkgname-$pkgver"

	# set default user to tinyproxy:tinyproxy and correct pidfile
	sed -i -e 's:^User.*:User tinyproxy:' \
		-e 's:^Group.*:Group tinyproxy:' \
		-e 's:^PidFile.*:PidFile "/var/run/tinyproxy/tinyproxy.pid":' \
		doc/tinyproxy.conf

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info

	make || return 1
	make DESTDIR="$pkgdir" install
	install -d -D -o tinyproxy -g tinyproxy "$pkgdir"/var/run/tinyproxy
	install -Dm755 "$srcdir"/tinyproxy.initd "$pkgdir"/etc/init.d/tinyproxy
}

md5sums="bd14d029b12621bcfd7ee71b2f4893da  tinyproxy-1.6.3.tar.gz
554da6fc363fbe251f081b342541bef4  tinyproxy.initd"
