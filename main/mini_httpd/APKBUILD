# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=mini_httpd
pkgver=1.19
pkgrel=1
pkgdesc="Small forking webserver with ssl and ipv6 support"
url="http://www.acme.com/software/mini_httpd/"
license="BSD"
depends=
makedepends="openssl-dev"
subpackages="$pkgname-doc"
source="http://www.acme.com/software/mini_httpd/$pkgname-$pkgver.tar.gz
	$pkgname.conf.sample
	$pkgname.initd
	"

build() {
	cd "$srcdir/$pkgname-$pkgver"
	make CFLAGS="${CFLAGS} -DUSE_SSL" \
		LDFLAGS="${LDFLAGS}" \
		SSL_LIBS="-lssl -lcrypto" \
		|| return 1
#		SSL_DEFS="-DUSE_SSL" \

	# does not respect DESTDIR
	make install \
		BINDIR="$pkgdir"/usr/sbin \
		MANDIR="$pkgdir"/usr/share/man

	# rename htpasswd to mini_htpasswd
	mv "$pkgdir"/usr/sbin/htpasswd "$pkgdir"/usr/sbin/mini_htpasswd
	mv "$pkgdir"/usr/share/man/man1/htpasswd.1 \
		"$pkgdir"/usr/share/man/man1/mini_htpasswd.1

	mkdir -p "$pkgdir"/var/www/localhost/htdocs
	install -D -m644 ../mini_httpd.conf.sample \
		"$pkgdir"/etc/mini_httpd.conf
	install -D -m755 ../mini_httpd.initd "$pkgdir"/etc/init.d/mini_httpd
}

md5sums="7c68293ad265ecfe2edea917912f6f1f  mini_httpd-1.19.tar.gz
ec656aadd4751a3f4f6e8c788a5237f2  mini_httpd.conf.sample
804e5cba1537bddac195e64b5b50d609  mini_httpd.initd"
