# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lua-ldap
_pkgname=lualdap
pkgver=1.2.3
pkgrel=0
pkgdesc="Lua binding to ldap"
url="https://github.com/bdellegrazie/lualdap"
arch="all"
license="MIT"
depends=""
makedepends="lua-dev openldap-dev"
source="$_pkgname-$pkgver.tar.gz::https://github.com/bdellegrazie/$_pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"

prepare() {
	default_prepare || return 1

	cd "$builddir"
	sed -i -e '/LUA_VERSION_NUM/d' config
}

build() {
	cd "$builddir"
	make OPENLDAP_LIB="-lldap -llber" \
		WARN="-DLDAP_DEPRECATED -fPIC -ansi $CFLAGS" || return 1
}

package() {
	cd "$builddir"
	local install_cmod=$(pkg-config --variable=INSTALL_CMOD lua)
	make install LUA_LIBDIR="$pkgdir"/$install_cmod
}

md5sums="a9eda2f55640a8c816b4d4c6c3d7ef1b  lualdap-1.2.3.tar.gz"
sha256sums="efde10853429fe1c1c208604a352bee395ac897d407f9d7bf9efca62cff02f67  lualdap-1.2.3.tar.gz"
sha512sums="51934d18d1ee97a0130545e657497e51542eef97c338df14e7171f94a2d6395fceb00313e1e64e46e6cdeedf85a17c63284595fdf6fbce8b7abce29d28f1b4a7  lualdap-1.2.3.tar.gz"
