# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libdrm
pkgver=2.4.50
pkgrel=0
pkgdesc="Userspace interface to kernel DRM services"
url="http://dri.freedesktop.org/"
arch="all"
license="custom"
depends=
makedepends="libpthread-stubs udev-dev libpciaccess-dev"
subpackages="$pkgname-dev"
source="http://dri.freedesktop.org/$pkgname/$pkgname-$pkgver.tar.bz2"

prepare() {
	cd "$srcdir"/$pkgname-$pkgver
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$srcdir"/$pkgname-$pkgver
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-udev \
		--disable-manpages \
		|| return 1

	# temp workaround. problem appears to be with
	# uclibc open_memstream() and stdio.h
	sed -i -e 's/-Werror-implicit-function-declaration//' intel/Makefile

	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
}

md5sums="7c530defdb0110e3257bb0d001521fe4  libdrm-2.4.50.tar.bz2"
sha256sums="3823d24cda800c2cd36995e01830b890edb8fb1bebf97d5ea4318b8c3933b045  libdrm-2.4.50.tar.bz2"
sha512sums="2aa668161a75894f66f2d8dfdc84fb51c3819ccc8accb3157a3340484431bfc8468d6fafd8b42dd4c3bcb5938ebcefaf3382b5d0333ebe0160e65d2795963d7f  libdrm-2.4.50.tar.bz2"
