# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libdrm
pkgver=2.4.66
pkgrel=0
pkgdesc="Userspace interface to kernel DRM services"
url="http://dri.freedesktop.org/"
arch="all"
license="custom"
depends=""
depends_dev="linux-headers"
makedepends="$depends_dev libpthread-stubs eudev-dev libpciaccess-dev"
subpackages="$pkgname-dev"
source="http://dri.freedesktop.org/$pkgname/$pkgname-$pkgver.tar.bz2
	musl-fix-headers.patch"

prepare() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$srcdir"/$pkgname-$pkgver
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-udev \
		--disable-manpages \
		--disable-valgrind \
		|| return 1
	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
}

md5sums="c6809c48538d6e5999588832045ff014  libdrm-2.4.66.tar.bz2
23fdf22a9593e329cd621f18014784f0  musl-fix-headers.patch"
sha256sums="79cb8e988749794edfb2d777b298d5292eff353bbbb71ed813589e61d2bc2d76  libdrm-2.4.66.tar.bz2
663bcedcdf9b01be512f09b5ca2393f33ebdc3e5a46325f2fd14271aa70d2e03  musl-fix-headers.patch"
sha512sums="e0e3cea490389271690a79b5be8acd5e7c892a0646285617bd00d85f7c56ac163580c8c62d9fa79ed99e89468e35eaed6ac8be6ea870ce5ab09589f3e2d7f506  libdrm-2.4.66.tar.bz2
d5edad480b77232055f0cd3ff5f38bfeae397d08d06b3d5ed1a53d5f466778e07407716618420cab73d5aa8ab204da58514b2570c3c5809a56c1ba1c2b817639  musl-fix-headers.patch"
