# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gvfs
pkgver=1.9.0
pkgrel=0
pkgdesc="Backends for the gio framework in GLib"
url="http://ftp.gnome.org/pub/gnome/sources/gvfs/${pkgver%.*}/"
arch="all"
license="GPL"
depends=
triggers="$pkgname.trigger:/usr/lib/gvfs"
makedepends="dbus-glib-dev intltool fuse-dev udev-dev bluez-dev expat-dev
	samba-dev libsoup-dev avahi-dev libarchive-dev gnome-disk-utility-dev
	libgphoto2-dev"
install=
subpackages="$pkgname-dev $pkgname-fuse $pkgname-smb $pkgname-archive
	$pkgname-obexftp $pkgname-gphoto2"
source="http://ftp.gnome.org/pub/gnome/sources/gvfs/${pkgver%.*}/gvfs-$pkgver.tar.bz2"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/usr/lib/gvfs \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--enable-gdu \
		--disable-gconf \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install
}

_mv_files() {
	local i
	for i in "$@"; do
		mkdir -p "$subpkgdir"/${i%/*}
		mv "$pkgdir"/$i "$subpkgdir"/$i || return 1
	done
}

fuse() {
	pkgdesc="FUSE support for gvfs"
	triggers=
	cd "$pkgdir"
	_mv_files usr/lib/gvfs/gvfs-fuse-daemon
}

smb() {
	pkgdesc="Windows fileshare support for gvfs"
	triggers=
	cd "$pkgdir"
	_mv_files \
		usr/lib/gvfs/gvfsd-smb* \
		usr/share/gvfs/mounts/smb*
}

archive() {
	pkgdesc="Archiving support for gvfs"
	triggers=
	cd "$pkgdir"
	_mv_files \
		usr/lib/gvfs/gvfsd-archive* \
		usr/share/gvfs/mounts/archive*
}

obexftp() {
	pkgdesc="ObexFTP support for gvfs"
	triggers=
	cd "$pkgdir"
	_mv_files \
		usr/lib/gvfs/gvfsd-obex* \
		usr/share/gvfs/mounts/obex*
}

gphoto2() {
	pkgdesc="gphoto2 support for gvfs"
	triggers=
	cd "$pkgdir"
	_mv_files \
		usr/lib/gvfs/gvfs*gphoto* \
		usr/share/gvfs/*/gphoto* \
		usr/share/dbus*/services/*GPhoto*
}

#
#afc() {
#	pkgdesc="AFC support for gvfs"
#}

md5sums="c8e44a42819453f6ef78974c568e5460  gvfs-1.9.0.tar.bz2"
