# Contributor: Michael Mason <ms13sp@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gnutls
pkgver=2.12.23
pkgrel=0
pkgdesc="A TLS protocol implementation"
url="http://www.gnu.org/software/gnutls/"
arch="all"
license="GPL"
depends=
depends_dev="libgcrypt-dev libgpg-error-dev zlib-dev libtasn1-dev" 
makedepends="$depends_dev perl"
install=
subpackages="$pkgname-doc $pkgname-dev $pkgname-utils"
source="ftp://ftp.gnutls.org/gcrypt/gnutls/v${pkgver%.*}/$pkgname-$pkgver.tar.bz2"

prepare() {
	cd "$srcdir/$pkgname-$pkgver"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$srcdir/$pkgname-$pkgver"

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-included-libcfg \
		--with-libgcrypt \
		--disable-rpath \
		--disable-static \
		|| return 1
	make
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make -j1 DESTDIR="$pkgdir" install
	rm -f "$pkgdir"/usr/lib/*.la
}

utils() {
	pkgdesc="Command line tools for TLS protocol"
	mkdir -p "$subpkgdir"/usr/
	mv "$pkgdir"/usr/bin "$subpkgdir"/usr/
}
md5sums="f3c1d34bd5f113395c4be0d5dfc2b7fe  gnutls-2.12.23.tar.bz2
d0e686da958069dec743c8daca7dc17a  cve-2012-1573.patch"
sha256sums="dfa67a7e40727eb0913e75f3c44911d5d8cd58d1ead5acfe73dd933fc0d17ed2  gnutls-2.12.23.tar.bz2
f69ad18bb9c56f9d5e2f7d0753352dde48219461d2f612e1e3ae52ce37c2f20c  cve-2012-1573.patch"
sha512sums="7780e9ca7b592350ce9b11e53a63d3212320402d8ad2462bfbc0e69aec4a48bb372a1925627abb7996535c87c90e3d79537ea118c8bb36d26aae8e19eaae3a06  gnutls-2.12.23.tar.bz2
90f2f8648727e5115b6723183d9c1ccb4825a6986c52b78157d5911e6ec49da0e93d08d0cc2977e1e89ad7423c922b7fbab4053378d0e3d40b5fe8676ec1c67d  cve-2012-1573.patch"
