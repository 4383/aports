--- mozilla-release-old/memory/mozalloc/Makefile.in
+++ mozilla-release/memory/mozalloc/Makefile.in
@@ -43,6 +43,10 @@
 
 include $(DEPTH)/config/autoconf.mk
 
+ifdef MOZ_MEMORY
+SHARED_LIBRARY_LIBS = $(call EXPAND_LIBNAME_PATH,jemalloc,../jemalloc) $(call EXPAND_LIBNAME_PATH,memory,../build)
+endif
+
 VISIBILITY_FLAGS=
 STL_FLAGS	=
 ifdef _MSC_VER
--- ./memory/mozalloc/mozalloc.cpp.orig	2013-02-15 21:15:06.000000000 +0000
+++ ./memory/mozalloc/mozalloc.cpp	2013-02-20 08:00:26.328809270 +0000
@@ -30,7 +30,7 @@
 #include "mozilla/mozalloc_oom.h"  // for mozalloc_handle_oom
 
 /* Windows doesn't have malloc_usable_size, but jemalloc has */
-#if defined(MOZ_MEMORY_WINDOWS)
+#if defined(MOZ_MEMORY_WINDOWS) || defined(__UCLIBC__)
 extern "C" size_t malloc_usable_size(const void *ptr);
 #endif
 
