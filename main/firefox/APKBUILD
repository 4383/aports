# Contributor: William Pitcock <nenolod@dereferenced.org>
# Maintainer: William Pitcock <nenolod@dereferenced.org>
pkgname=firefox
pkgver=4.0_rc1
_pkgver=4.0rc1
_xulver=2.0_rc1
pkgrel=1
pkgdesc="firefox web browser (unofficial branding)"
url="http://www.firefox.com"
arch="all"
license="GPL LGPL MPL"
depends="xulrunner"
makedepends="xulrunner-dev>=${_xulver}

	     nspr-dev
	     nss-dev
	     gtk+-dev
             dbus-glib-dev
             alsa-lib-dev
             libvorbis-dev
             libogg-dev
             libtheora-dev
             wireless-tools-dev
             libnotify-dev
             libevent-dev
             libxt-dev
             jpeg-dev
             bzip2-dev
             hunspell-dev
             startup-notification-dev
             sqlite-dev
             libidl-dev

	     autoconf2.13

	     python
	     zip
	     yasm

	     autoconf
	     automake
	     libtool"
install=""
subpackages=""
source="http://releases.mozilla.org/pub/mozilla.org/${pkgname}/releases/${pkgver}/source/${pkgname}-${_pkgver}.source.tar.bz2
	mozconfig

	firefox-restore-fx3-tab-behaviour-as-default.patch
	firefox-defaults.patch
	firefox-version.patch

	firefox.desktop
	firefox-safe.desktop"

_xulrunner_version="2.0"
_builddir="${srcdir}/mozilla-${_xulrunner_version}"
prepare() {
	local i

	cd "$_builddir"

	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done

	cp "${srcdir}/mozconfig" .mozconfig
}

build() {
	cd "$_builddir"

	# mozilla's buildsystem is on drugs, so we just kill our CFLAGS and hope
	# for the best. --nenolod
	unset CFLAGS
	unset CXXFLAGS

	make -j1 -f client.mk build MOZ_MAKE_FLAGS="$MAKEFLAGS" || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" -f client.mk install || return 1

	install -m755 -d ${pkgdir}/usr/share/applications
	install -m755 -d ${pkgdir}/usr/share/pixmaps
	install -m644 ${srcdir}/mozilla-2.0/browser/branding/unofficial/default48.png ${pkgdir}/usr/share/pixmaps/firefox.png
	install -m644 ${srcdir}/firefox.desktop ${pkgdir}/usr/share/applications/firefox.desktop
	install -m644 ${srcdir}/firefox-safe.desktop ${pkgdir}/usr/share/applications/firefox-safe.desktop
}

md5sums="511828dcc226f38602c6c67bd192ef40  firefox-4.0rc1.source.tar.bz2
d1ec45f9d953a868483094cce2b3eff5  mozconfig
7cddbb1c76b9038ad1d85311dda81c95  firefox-restore-fx3-tab-behaviour-as-default.patch
475a0870730c88f48158a4d4ca9812d0  firefox-defaults.patch
0e296aabf8c2b5fd5ef5b3a989bab03a  firefox-version.patch
ba96924ece1d77453e462429037a2ce5  firefox.desktop
6f38a5899034b7786cb1f75ad42032b8  firefox-safe.desktop"
