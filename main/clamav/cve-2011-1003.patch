From d21fb8d975f8c9688894a8cef4d50d977022e09f Mon Sep 17 00:00:00 2001

diff --git a/libclamav/vba_extract.c b/libclamav/vba_extract.c
index 062ec20..8de1058 100644
--- a/libclamav/vba_extract.c
+++ b/libclamav/vba_extract.c
@@ -221,8 +221,10 @@ vba_read_project_strings(int fd, int big_endian)
 		free(name);
 
 		if(!read_uint16(fd, &length, big_endian)) {
-			if(buf)
+			if(buf) {
 				free(buf);
+				buf = NULL;
+			}
 			break;
 		}
 
-- 
1.7.2.3

