# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=midori
pkgver=0.5.6
pkgrel=2
pkgdesc="A lightweight web browser based on Gtk WebKit"
url="http://www.twotoasts.de/index.php?/pages/midori_summary.html"
arch="all"
license="LGPL2+"
depends="
	desktop-file-utils
	hicolor-icon-theme
	"
makedepends="
	cmake
	gettext-dev
	git
	intltool
	libidn-dev
	libnotify-dev
	librsvg-dev
	libsoup-dev
	libunique3-dev
	libxml2-dev
	paxctl
	pkgconfig
	python
	sqlite-dev
	vala
	webkitgtk-dev
	"
subpackages="$pkgname-lang"
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.post-deinstall"
source="http://www.midori-browser.org/downloads/midori_${pkgver}_all_.tar.bz2
	execinfo-detect.patch
	"

_builddir="$srcdir"/midori-${pkgver}
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=/usr/lib \
		-DUSE_GTK3=ON \
		-DUSE_ZEITGEIST=OFF \
		. || return 1
	make
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	# PAX does not like the JIT
	paxctl -c -m -p "$pkgdir"/usr/bin/midori
}

md5sums="62ee86eb103b74efe71d40e343120a3c  midori_0.5.6_all_.tar.bz2
ddeee1a42503ca911a9830f096fc64e9  execinfo-detect.patch"
sha256sums="c5be1b5d9933776f09c5cab7945a073a820d65555e51fda9ff55fd063843f24a  midori_0.5.6_all_.tar.bz2
7e8d1ba1ee7d5e017375465d525b5a3794fb96e5683b14263f9a51ac759c18ce  execinfo-detect.patch"
sha512sums="42d67ab55b2586098f88088e7c72eda4daebf667881d464fd08b03c076557dfa9c1a62bff3924285a7c67f9fb9f0e1cd044703244caad2c00e4a88cb88569ee7  midori_0.5.6_all_.tar.bz2
664837bd52054ac404baad8f63c96a44f8c0c58390ff57a69dae6682a1f9ec1c5a4b8a6907ba38f1349aa3af18380d44399e79ac4269d4ae398b22be72e970a5  execinfo-detect.patch"
