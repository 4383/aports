# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=alsa-lib
pkgver=1.0.27.2
pkgrel=2
pkgdesc="An alternative implementation of Linux sound support"
url="http://www.alsa-project.org"
arch="all"
license="GPL"
depends=
subpackages="$pkgname-dev"
source="http://alsa.cybermirror.org/lib/$pkgname-$pkgver.tar.bz2
	alsa-lib_pcm_h.patch
	alsa-lib_mixed_types.patch
	alsa-lib_kernel_off_t.patch
	alsa-lib-portable-mutex.patch
	fix-headers.patch"

_builddir="$srcdir/$pkgname-$pkgver"
prepare() {
	cd "$_builddir"
	update_config_sub || return 1
	rm src/compat/hsearch_r.c && touch src/compat/hsearch_r.c
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--disable-python \
		--disable-static \
		--disable-resmgr \
		--enable-rawmidi \
		--enable-seq \
		--enable-aload \
		--disable-dependency-tracking \
		--without-versioned \
		|| return 1
	make || return 1
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make -j1 DESTDIR="$pkgdir" install
	find "$pkgdir" -iname *.la -delete
}

md5sums="69129a7c37697f81ac092335e9fa452b  alsa-lib-1.0.27.2.tar.bz2
4018a2f02d7c93935b6a8fa0bc3f2191  alsa-lib_pcm_h.patch
d949fb5ff425e70f1896f7231f30469e  alsa-lib_mixed_types.patch
1c730d98856f5753c8a12794e616b543  alsa-lib_kernel_off_t.patch
53be16ad5e552d62730dd8386f32569d  alsa-lib-portable-mutex.patch
5c927fa03f965c949ae78599a07e358d  fix-headers.patch"
sha256sums="690ed393e7efd4fc7e3a2d2cda5449298ca0c895197e5914e350882012430d19  alsa-lib-1.0.27.2.tar.bz2
faa8efc9b2e5d110d0daffe473c86efcbc6305a7eafd016b1334581db466dbdf  alsa-lib_pcm_h.patch
ac2b77959404ea81d2f1a539c9c0e9e15b5c2c452285712aa10b6f8da8f9eefa  alsa-lib_mixed_types.patch
ec7a8cb2b82d59b137f40df9e6bc3de1519a150c7c2718f9906b721ef4fd6e63  alsa-lib_kernel_off_t.patch
fa2ada95443835aead2e3a5a23262242885f4b1297779d94c3545aa137b05858  alsa-lib-portable-mutex.patch
f04295f6a876f8808f40186b99f49e9f432704340aae4f63b146b55812e7d1dc  fix-headers.patch"
sha512sums="3fa9160e001cf21ddc6332c3748f8aa27bd1b514616fd1a9993c34128fe99d07e2dfc5f1a9177e1c17456d1361496f90bf3552f940fd85c6ea5ac9bbc30fe8ce  alsa-lib-1.0.27.2.tar.bz2
0ea37cda27b440c82f0bc0e34f67d423678d348874c18063036e4347f961bbbce4074ed0aaa518d25d0cedd73818e66e1cbc30c6ff4bf9e6479f64012df0199c  alsa-lib_pcm_h.patch
990d83a761958f350749fda57def15c73890afeae4fa303dc6af36c453a723a2c98d3cf8f44344da539e6c3224d96bfa91861e59126ec2a3d97dc4c0f36fbc61  alsa-lib_mixed_types.patch
800362bbc8823afdd04480c319c2a9a2d8823712197e8c59af4c4ef80602435aace12a75fcdf5a9824d01e16397568636141980bff08f098f1ad4b794486834e  alsa-lib_kernel_off_t.patch
6bacd0db2be2140150cecc31062726c9ec3a367cf6da114828ae98dace2233b2ac4c7bc74318e125aa7eafbb3085fecc017ac51b7414546b2803230d610bb925  alsa-lib-portable-mutex.patch
2cc59c0130bbb69f88bf70ed47c14cff226b7a6ac6a8c3d2da74577a0c0a5a7ba9a14c2881af56f7e41795e7f12aad1b0173750aaba88792ce06b23f0c6f25c3  fix-headers.patch"
