From b80a71e8d8dd43dc23a84f93cb6ccab523f1f942 Mon Sep 17 00:00:00 2001
From: Natanael Copa <ncopa@alpinelinux.org>
Date: Tue, 1 Apr 2014 14:15:51 +0000
Subject: [PATCH] buildrepo: update buildstats only when something is actually
 getting built

---
 buildrepo.lua | 17 ++++++++++-------
 1 file changed, 10 insertions(+), 7 deletions(-)

diff --git a/buildrepo.lua b/buildrepo.lua
index 21b444b..9a0d019 100755
--- a/buildrepo.lua
+++ b/buildrepo.lua
@@ -179,16 +179,19 @@ for _,repo in pairs(args) do
 	for aport in db:each_in_build_order(pkgs) do
 		tried = tried + 1
 		local totally_built = stats[repo].relevant_aports - #pkgs + built
-		io.write(("%d/%d %d/%d %s %s\n"):format(tried, #pkgs,
-					totally_built, stats[repo].relevant_aports,
-					aport.pkgname, aport.pkgver))
 		if not db:known_deps_exists(aport) then
 			warn("%s: Skipped due to missing dependencies", aport.pkgname)
-		elseif build_aport(aport, repodest, logdir, opts.s) then
-			built = built + 1
 		else
-			if not opts.k then
-				os.exit(1)
+			io.write(("%d/%d %d/%d %s %s\n"):format(tried, #pkgs,
+					totally_built,
+					stats[repo].relevant_aports,
+					aport.pkgname, aport.pkgver))
+			if build_aport(aport, repodest, logdir, opts.s) then
+				built = built + 1
+			else
+				if not opts.k then
+					os.exit(1)
+				end
 			end
 		end
 	end
-- 
1.9.1

