# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxxf86vm
pkgver=1.1.2
pkgrel=1
pkgdesc="X11 XFree86 video mode extension library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
depends_dev="xf86vidmodeproto libx11-dev libxext-dev"
makedepends="$depends_dev libtool autoconf automake util-macros"
source="http://xorg.freedesktop.org/releases/individual/lib/libXxf86vm-$pkgver.tar.bz2
	0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
	0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
	0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
	0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
	0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch
	"

_builddir="$srcdir"/libXxf86vm-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	libtoolize --force && aclocal && autoheader && autoconf \
		&& automake --add-missing
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="ffd93bcedd8b2b5aeabf184e7b91f326  libXxf86vm-1.1.2.tar.bz2
0147e68657e82274c85d9a76360f2f7e  0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
93ea0ba28daa2b9a0446b21e317c454e  0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
becbb6759243d4f5e7d87d611501b2e8  0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
7cc84f83f064d575c8628f45afec2691  0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
d16fbe7f3656d1c65aa74f4a45a8bbcd  0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
722b2379320147190135f00eb12782c5  0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
569c6902f1b15289b02d2f7a644a34cc  0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
a86c5904529d2ccfd92c12aef547136e  0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch"
