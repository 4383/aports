# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxxf86vm
pkgver=1.1.2
pkgrel=1
pkgdesc="X11 XFree86 video mode extension library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
depends_dev="xf86vidmodeproto libx11-dev libxext-dev"
makedepends="$depends_dev libtool autoconf automake util-macros"
source="http://xorg.freedesktop.org/releases/individual/lib/libXxf86vm-$pkgver.tar.bz2
	0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
	0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
	0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
	0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
	0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
	0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch
	"

_builddir="$srcdir"/libXxf86vm-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	libtoolize --force && aclocal && autoheader && autoconf \
		&& automake --add-missing
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="ffd93bcedd8b2b5aeabf184e7b91f326  libXxf86vm-1.1.2.tar.bz2
0147e68657e82274c85d9a76360f2f7e  0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
93ea0ba28daa2b9a0446b21e317c454e  0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
becbb6759243d4f5e7d87d611501b2e8  0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
7cc84f83f064d575c8628f45afec2691  0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
d16fbe7f3656d1c65aa74f4a45a8bbcd  0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
722b2379320147190135f00eb12782c5  0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
569c6902f1b15289b02d2f7a644a34cc  0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
a86c5904529d2ccfd92c12aef547136e  0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch"
sha256sums="a564172fb866b1b587bbccb7d041088931029845245e0d15c32ca7f1bb48fc84  libXxf86vm-1.1.2.tar.bz2
b457de56462689eff9b2d5b61e07e767bcfe85b2e1c6317cf97fe0a420d95409  0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
a5f97c643cb7a09c9fdb10c99445d968de038f49ad7ab145094a816991f09ec9  0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
442d8fffc438a6e22114d77775df86bd8166e57f404f510d4e85824a8e8446bb  0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
30b41220a8399c7961be7f5b0be83a18fb357100ca94b03e898f4a7b7cc0d00d  0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
3e82f5d621c2d7e4fa7010cb28c5c2e35fd668fd9acc6db5a1a00c9c63067d19  0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
e0e3298f6be09483b376a3da0ba5944befc9d46b1cb2b6e1c043c2eb832bcc91  0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
531c281d602c67b1c702cecb35f948a97ee67fcbd429e723239ff240c69a8594  0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
62e4c96728c0adea4b5c2c9ce4c1089ffe6b57a5466a2789832681bc56d8cd47  0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch"
sha512sums="594243f2d0275a3036754e5cfd3f440f2faae78f6c836e6787129d54a559af0ceba6fefe18d98d6908aa75ea322875a188a3b3ffee7e3deec1168c7656e7a96a  libXxf86vm-1.1.2.tar.bz2
4b40e349407a105d07a54b72077b9a7d6371db743b377cbe246d7d21f7894b549fd2ebf77b0acac6520e513829491c07b3b76891d2fe450baf294caa7be72db3  0001-When-Xcalloc-returns-NULL-you-don-t-need-to-Xfree-it.patch
09a8cd3b934b4c46c2143c50cde25e70b0800afcafa265c00f2118f4ce0f74eaffb8cede5027b1d065469da874f27adf2efb18500bb7b4fca70a911096f7db48  0002-Improve-error-handling-in-XF86VidModeGetMonitor.patch
38260b81f4e052587a2f38a1d15202511070b7c9985ea374d732abd982953c98d1fbc96b56bd3b57afdae3728f5607e6cb83ee2b43a871c36f4d9366df058ca2  0003-Unlock-display-before-returning-alloc-error-in-XF86V.patch
f2a891c4aec0c2d640f92cf63a05f6655531089735c59d9b184b5ef460a850f6cf4f8dfce582cced12dd9d7b14f6e91e590bf9feef37ba714561b696b0e67485  0004-Unlock-display-before-returning-alloc-error-in-XF86V.patch
f54396628ff1ab4c31396960b3ee79311a00bd6147d1f76128f9c3f9dbe81bbfeaa7e37e4c1c7686cadfa2901e95e75e06e8f1c297a90f2287a0c4e22382beab  0005-Unlock-display-before-returning-alloc-error-in-XF86V.patch
a4a260efeb52f00ddf2adb476f241a88b6809bda75e3b5477ca15caba24e2b9f0fa9fc6cf070fb2f3ba64f7b5d1b9372727533e80d61c1ae3da035952aa87741  0006-Use-_XEatDataWords-to-avoid-overflow-of-length-calcu.patch
e54a46c0c0d54b08daa62578a814ed1dafaa66d5b2e13e2f50dc0dfb11dc061dc505e7001c39ce579f9f4d2ce29dd6b53c40109800c1692d7102f1c5b0583b24  0007-memory-corruption-in-XF86VidModeGetGammaRamp-CVE-201.patch
43e2e04e1da133e986ec717e294a7f4fad803d7ff8cafa9a120649cfec30dc986516f0bd7389781cf0dfcda84c59dce63831c47f58f6d25ee6b488cced742d59  0008-avoid-integer-overflow-in-XF86VidModeGetModeLine.patch"
