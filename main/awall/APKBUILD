# Contributor: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
# Maintainer: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
pkgname=awall
pkgver=1.0.0
pkgrel=1
pkgdesc="Alpine Wall"
url="http://git.alpinelinux.org/cgit/awall/"
arch="noarch"
license="GPL2"
replaces="awall-nat"
depends="bind-tools ip6tables ipset iptables lua lua-alt-getopt lua-filesystem
		lua-json4 lua-pc lua-signal lua-sleep lua-stringy xtables-addons"
subpackages=$pkgname-masquerade
source="http://dev.alpinelinux.org/archive/awall/awall-$pkgver.tar.xz
	0001-make-boolean-variables-work.patch
	"

_builddir=$srcdir/awall-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	return 0
}

package() {
	cd "$_builddir"
	make "ROOT_DIR=$pkgdir" install
}

masquerade() {
	depends=awall
	cd "$_builddir"
	for file in lua/5.1/awall/modules/masquerade.lua awall/mandatory/masquerade.json; do	    	
		local path=usr/share/$file
		install -d "$subpkgdir/$(dirname $path)"
		mv "$pkgdir/$path" "$subpkgdir/$path"
	done
}

md5sums="d3d36a6df7e6b11d1454fa14180ff5ff  awall-1.0.0.tar.xz
9d966feb770d9dc6c6b57445e94c892c  0001-make-boolean-variables-work.patch"
sha256sums="f5334cc27533bc457d2e0287ce7df44719f5ea0d856e52c9a1e5044e5e30012a  awall-1.0.0.tar.xz
051f8d1eb6bb21d89d60de187c2a3ad9b0c168110a307fa3cd6a99730139c1be  0001-make-boolean-variables-work.patch"
sha512sums="7b6780bdc849abb931a737c1d8b95c2906a833c380dfa29c5eda3ed5470035cf8fa37e36214b6e0b4f322000fa97164288a4c8835f35ddfa57b253d7ecdbcff1  awall-1.0.0.tar.xz
88006cb2c554f447559da829bac9872082153b896588a8e975f33a67045a853a33faa9983ddee9efd0b2fde1e84606c459a0f47eb9110d5fc36de3293fd5a3d4  0001-make-boolean-variables-work.patch"
