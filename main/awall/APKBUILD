# Contributor: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
# Maintainer: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
pkgname=awall
pkgver=0.3.3
pkgrel=0
pkgdesc="Alpine Wall"
url=http://git.alpinelinux.org/cgit/awall/
arch=noarch
license=GPL-2
replaces="awall-nat"
depends="bind-tools ip6tables ipset iptables lua lua-alt-getopt lua-filesystem lua-json4 lua-pc lua-signal lua-sleep lua-stringy xtables-addons"
subpackages=$pkgname-masquerade
source=http://dev.alpinelinux.org/archive/awall/awall-${pkgver}.tar.xz

_builddir=$srcdir/awall-${pkgver}

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	:
}

package() {
	cd "$_builddir"
	make "ROOT_DIR=$pkgdir" install
}

masquerade() {
	depends=awall
	cd "$_builddir"
	for file in lua/5.1/awall/modules/masquerade.lua awall/mandatory/masquerade.json; do	    	
		local path=usr/share/$file
		install -d "$subpkgdir/$(dirname $path)"
		mv "$pkgdir/$path" "$subpkgdir/$path"
	done
}

md5sums="57a2a7fab20369d03f2d678c5a7e8923  awall-0.3.3.tar.xz"
sha256sums="64a02bd74f83e1b8d3bb31089d61f30b7121c8591a065beb979116eb2bc7d39e  awall-0.3.3.tar.xz"
sha512sums="5d5fe371160e6b1310daccd4ed733019b9685a4068687f29421cabeabc78c396172337033065f7eac1dcbf3c4557565120af3156f810a724e3934b4fca5819f5  awall-0.3.3.tar.xz"
