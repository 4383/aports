# Contributor: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
# Maintainer: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
pkgname=awall
pkgver=0.1.1
pkgrel=0
pkgdesc="Alpine Wall"
url=http://git.alpinelinux.org/cgit/kunkku/awall/
arch=noarch
license=GPL-2
depends="bind-tools ip6tables ipset iptables lua lua-alt-getopt lua-filesystem lua-json4 lua-pc lua-signal lua-sleep lua-stringy"
subpackages=$pkgname-nat
source="${url}snapshot/awall-${pkgver}.tar.bz2"

_builddir=$srcdir/awall-${pkgver}
_luadir=usr/share/lua/5.1

prepare() {
	:
}

build() {
	:
}

package() {
	cd "$_builddir"
	local dir=$pkgdir/$_luadir/awall
	local bindir=$pkgdir/usr/sbin
	local poldir=$pkgdir/usr/share/awall

	install -d "$poldir/mandatory"
	install -d "$poldir/optional"
	install -d "$poldir/sample"

	install -d "$bindir"
	install -d "$dir/modules"
	install -d "$pkgdir/etc/awall"
	install -d "$pkgdir/var/run/awall"

	install awall-cli "$bindir/awall"
	install -m 644 awall/*.lua "$dir"
	install -m 644 awall/modules/filter.lua "$dir/modules"

	install -m 644 json/services.json "$poldir/mandatory"
	install -m 644 sample-policy.json "$poldir/sample"
}

nat() {
	depends=awall
	cd "$_builddir"
	local moddir=$subpkgdir/$_luadir/awall/modules
	local poldir=$subpkgdir/usr/share/awall/mandatory
	install -d "$moddir" "$poldir"
	install -m 644 json/masquerade.json "$poldir"
	install -m 644 awall/modules/nat.lua "$moddir"
}

md5sums="de2ae6f4b2825b523873ca82bd1f7c48  awall-0.1.1.tar.bz2"
