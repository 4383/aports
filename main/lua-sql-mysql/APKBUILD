# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lua-sql-mysql
_name=luasql-mysql
pkgver=2.3.0
pkgrel=0
pkgdesc="MySQL driver for LuaSQL (luasql-mysql)"
url="http://www.keplerproject.org/luasql/"
arch="all"
license="MIT"
depends="lua"
makedepends="lua-dev mysql-dev"
install=
subpackages=
source="saveas-https://github.com/keplerproject/luasql/archive/v$pkgver.tar.gz/luasql-$pkgver.tar.gz"
replaces=luasql-mysql

build() {
	cd "$srcdir"/luasql-$pkgver

	# The config has DRIVER_INCS but it seems like its not respected
	# so we just fix the .c file
	sed -i -e 's:^\#include "mysql.h":\#include <mysql/mysql.h>:' \
		src/ls_mysql.c || return 1

	make CFLAGS="-fPIC $CFLAGS" T=mysql DRIVER_LIBS="-lmysqlclient" || return 1
}

package() {
	cd "$srcdir"/luasql-$pkgver
	local _install_cmod=$(pkg-config --variable INSTALL_CMOD lua)
	install -D src/mysql.so "$pkgdir"/$_install_cmod/luasql/mysql.so
}

md5sums="af9f0f3a2313a1fcf88c40700092048d  luasql-2.3.0.tar.gz"
