# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxrandr
pkgver=1.4.0
pkgrel=1
pkgdesc="X11 RandR extension library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
depends_dev="xproto randrproto libx11-dev libxext-dev libxrender-dev"
makedepends="$depends_dev libtool autoconf automake util-macros"
source="http://xorg.freedesktop.org/releases/individual/lib/libXrandr-$pkgver.tar.bz2
	0001-Replace-deprecated-Automake-INCLUDES-variable-with-A.patch
	0002-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
	0003-integer-overflow-in-XRRQueryOutputProperty-CVE-2013-.patch
	0004-integer-overflow-in-XRRQueryProviderProperty-CVE-201.patch
	0005-integer-overflow-in-XRRGetOutputProperty-CVE-2013-19.patch
	0006-integer-overflow-in-XRRGetProviderProperty-CVE-2013-.patch
	0007-Make-XRRGet-Property-always-initialize-returned-valu.patch
	"


_builddir="$srcdir"/libXrandr-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	libtoolize --force && aclocal && autoheader && autoconf \
		&& automake --add-missing
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="0c843636124cc1494e3d87df16957672  libXrandr-1.4.0.tar.bz2
d40ab63148e3a7c31f3548097c48d507  0001-Replace-deprecated-Automake-INCLUDES-variable-with-A.patch
f79a519bdf980c7ef92e18aa3a2c16ca  0002-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
41e672b46e9e3d25c8eb2e86cea29ed1  0003-integer-overflow-in-XRRQueryOutputProperty-CVE-2013-.patch
e2bb9968f01fc41f53e6457f60bdfae0  0004-integer-overflow-in-XRRQueryProviderProperty-CVE-201.patch
7d65549f48058f8f9bf9e527d03bbb08  0005-integer-overflow-in-XRRGetOutputProperty-CVE-2013-19.patch
486e84c4089b4f5120cbbc605e732f5b  0006-integer-overflow-in-XRRGetProviderProperty-CVE-2013-.patch
0883bd4a4e0360e54968f9e4887c03c8  0007-Make-XRRGet-Property-always-initialize-returned-valu.patch"
sha256sums="033ad0ac2f012afb05268660f6d78705c85f84689f92fa7b47ce12959b15f5c3  libXrandr-1.4.0.tar.bz2
fc55395c3a275b9c2bce1cd17caf3963b57afb424e95504cf84ed3ab3bf58e19  0001-Replace-deprecated-Automake-INCLUDES-variable-with-A.patch
7ca77f1f0e5f7a1febc76e2957c3705d6378c1af6944616735bacc194bc81097  0002-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
847f2b8da4e9d9346d273fd541830a0d6d457857cea576394c2117c5dcbcf356  0003-integer-overflow-in-XRRQueryOutputProperty-CVE-2013-.patch
a537b5ca75a88c5b1ccc862775e4512fb57c4665eb6245c59b3160250ac02ba8  0004-integer-overflow-in-XRRQueryProviderProperty-CVE-201.patch
2b84742ed038b96625cc0486e47e3b85e6bd9700a8095b7b65d9dc8a93087dfc  0005-integer-overflow-in-XRRGetOutputProperty-CVE-2013-19.patch
8daabc77bfbcef87d7e52478306fd2774b0c3b59afc7d002d413c7fd6598b93c  0006-integer-overflow-in-XRRGetProviderProperty-CVE-2013-.patch
03b9c156b04cbe934978983e6a4fff427fd9230b39408b20bbdb4768a7a06bb4  0007-Make-XRRGet-Property-always-initialize-returned-valu.patch"
sha512sums="a97f2442c7f73786e5d3fae9a98b172ac1cb17b1584a7bad243128fc755b25a41cc7e32ceed10eb8eac733ff137b95504485967716f0122edf6682db6065a289  libXrandr-1.4.0.tar.bz2
11584e52674a6d1216d5586f578962464f8e6942653a3bce7ddf3af27ea28d604e9ce989635b1db051147f5046ed0593601d74277a86c2776e84ff1c5350a9df  0001-Replace-deprecated-Automake-INCLUDES-variable-with-A.patch
ce19127f19d5b932b68de1f336335587bdda4db791b20d26488dcba00a9e303832c679033e59d1f2602f24c8519fe909c24199226ab2b651863b60a7a1e2a5c6  0002-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
228c64d64c839682cb7523cd6dd9153d0acf76e7d9e88a7e73c24bc4536b9dcbf5a500d7fd33ba373f605a0e9d0a770899c1b44a25f9d7468db6de46d0702152  0003-integer-overflow-in-XRRQueryOutputProperty-CVE-2013-.patch
1784174229c46575431eb6a0e05ccac631c3d843ed2742cd89ec8f28866c0e10881ab1c1e30fab5831ba0cb066ece0debbbeb98c7bb4a528768dd8342f42f7b2  0004-integer-overflow-in-XRRQueryProviderProperty-CVE-201.patch
14d508d519ca972ee6e521597b16663e78b3f44bcbada97d6ba797cec2b09392daeaf673e02670af0d0f6f71ac5c8e8cb8aa75546ec46cb92ecb6f9190990bca  0005-integer-overflow-in-XRRGetOutputProperty-CVE-2013-19.patch
ec6996991010498de70ad69d55d8a7b2bb5f5f751af567d6be385166d485e145920356a9a3b87603be924121e0202251f6dca96c1af2bd6328961c5fa286d8d1  0006-integer-overflow-in-XRRGetProviderProperty-CVE-2013-.patch
0d7804c66749090a72bd52297948b7b27c51d77773e57d62e905a7b45d349a77c9857933d85a9e22ce9a2d249ed6ed492fc80040193652ddebe47bd7c558562e  0007-Make-XRRGet-Property-always-initialize-returned-valu.patch"
