# Contributor: Jeff Bilyk <jbilyk@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=smokeping
pkgver=2.6.1
pkgrel=0
pkgdesc="Smokeping network latency monitoring"
pkgusers="smokeping"
pkggroups="smokeping"
install="$pkgname.pre-install"
url="http://oss.oetiker.ch/smokeping/"
source="http://oss.oetiker.ch/smokeping/pub/smokeping-$pkgver.tar.gz
	smokeping.initd
	0001-fix-sysconfdir-in-etc.patch
	0002-fix-sysconfdir-in-doc.patch
	0003-fix-sysconfdir-in-lib.patch
	0004-fix-sysconfdir-in-htdocs.patch"
depends="perl fping rrdtool perl-rrd
	perl-uri-escape
	perl-digest-hmac
	perl-cgi-session
	perl-libwww
	perl-snmp-session
	perl-net-dns
	perl-fcgi
	perl-config-grammar
	"
arch="all"
license="GPL"

_builddir="$srcdir"/$pkgname-$pkgver
_vendorlib=/usr/share/perl5/vendor_perl

prepare() {
	cd "$_builddir"

	for i in $source; do
		case $i in
			*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--bindir=/usr/bin \
		--libdir=/usr/lib \
		--sysconfdir=/etc \
		--libexecdir=/usr/libexec \
		--datarootdir=/usr/share \
		--mandir=/usr/share/man \
		--with-htdocs-dir=/usr/share/webapps \
		|| return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
}

md5sums="f4a5437b71e02f982f08bf318bb9857d  smokeping-2.6.1.tar.gz
550979e008f49299bf404aceeb81fe61  smokeping.initd
b3f3c968c582adb9e4e0fdcc9c7163e9  0001-fix-sysconfdir-in-etc.patch
552c05ad77a3a4ca5a0deee3128a01f2  0002-fix-sysconfdir-in-doc.patch
6bab62a79099cea322e4f9dd6fffd828  0003-fix-sysconfdir-in-lib.patch
372c700c585efbe5d0e53476d2e0088b  0004-fix-sysconfdir-in-htdocs.patch"
