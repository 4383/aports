# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=syslinux
pkgver=5.10
pkgrel=2
_ver=${pkgver/_/-}
pkgdesc="Boot loader for the Linux operating system"
url="http://syslinux.org"
arch="x86 x86_64"
license="GPL"
makedepends="nasm perl util-linux-dev"
depends="mtools blkid mkinitfs"
triggers="syslinux.trigger=/boot"
install="syslinux.post-upgrade"
options="textrels"
ldpath="/usr/share/syslinux"
#source="http://www.kernel.org/pub/linux/utils/boot/syslinux/${pkgver%%.*}.xx/$pkgname-$_ver.tar.bz2
source="https://www.kernel.org/pub/linux/utils/boot/syslinux/syslinux-$_ver.tar.xz
	update-extlinux.conf
	update-extlinux
	"
subpackages="$pkgname-doc"

_builddir="$srcdir"/$pkgname-$_ver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case "$i" in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	unset LDFLAGS
	make installer || return 1
}

package() {
	cd "$_builddir"
	make INSTALLROOT="$pkgdir" MANDIR=/usr/share/man local-install

	mkdir -p "$pkgdir"/etc/update-extlinux.d
	cp "$srcdir"/update-extlinux.conf "$pkgdir"/etc/
	sed "/^version=/s/=.*/=$pkgver-r$pkgrel/" "$srcdir"/update-extlinux \
		> "$pkgdir"/sbin/update-extlinux
	chmod 755 "$pkgdir"/sbin/update-extlinux
}

md5sums="67c8a85ca275d13b4f7f6139dd47d999  syslinux-5.10.tar.xz
51df240c4da940cfb52cd8f31876402f  update-extlinux.conf
a7fc8fa30d7ae47e27ef15923ab3d05a  update-extlinux"
sha256sums="4b52d7647d5584c69764c06a836e0d524e5246bf2e94f68cf86342c415508422  syslinux-5.10.tar.xz
8a626b74355b54f5a538b5e42094955987a7ca547d8b2a78797a5e3ca11cff1f  update-extlinux.conf
b54eb30280875e101623e362921b89cfe641648c14502aa1f5e04f9a52c492d4  update-extlinux"
sha512sums="56422e14b4aa53ca1a5811da0582dbbb349aa52b9e78868bbedc24c67ef2420c4d0ac63fd68c7f0adc2c22606196276265d503b5b6f9d3d796d9ce42845bbdb5  syslinux-5.10.tar.xz
28f828f81abe183b4206438af639649391c54db4514cae426bba2635b195f6e3f95500df63b8e7085fe9c909139518e64e73c69e75273b0ccdf4f876b38875a5  update-extlinux.conf
4e929064fee5b76384608e426d689d536f705304a3998b0044882d03d79f8cc1f4a7be1a1e9b3690a1d2a3cba1ef5dca2989bb6d0223402770741be6de7bbce0  update-extlinux"
