# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=syslinux
pkgver=5.01
pkgrel=3
pkgdesc="Boot loader for the Linux operating system"
url="http://syslinux.org"
arch="x86 x86_64"
license="GPL"
makedepends="nasm perl util-linux-dev"
depends="mtools blkid mkinitfs"
triggers="syslinux.trigger=/boot"
install="syslinux.post-upgrade"
options="textrels"
ldpath="/usr/share/syslinux"
source="http://www.kernel.org/pub/linux/utils/boot/syslinux/${pkgver%%.*}.xx/$pkgname-$pkgver.tar.bz2
	boot_image.patch
	update-extlinux.conf
	update-extlinux
	"
subpackages="$pkgname-doc"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case "$i" in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	unset LDFLAGS
	make installer || return 1
}

package() {
	cd "$_builddir"
	make INSTALLROOT="$pkgdir" MANDIR=/usr/share/man local-install

	mkdir -p "$pkgdir"/etc/update-extlinux.d
	cp "$srcdir"/update-extlinux.conf "$pkgdir"/etc/
	sed "/^version=/s/=.*/=$pkgver-r$pkgrel/" "$srcdir"/update-extlinux \
		> "$pkgdir"/sbin/update-extlinux
	chmod 755 "$pkgdir"/sbin/update-extlinux
}

md5sums="6c21244277fa4e444967ba45469de863  syslinux-5.01.tar.bz2
d44f960c83d9fef69839b9537ac1fc1d  boot_image.patch
7ef73a7a858b8aa1ac6635d6391ac8e5  update-extlinux.conf
d420755f22dc70a617e2d7b96d3c39b3  update-extlinux"
sha256sums="2e4955dfb1f58ed7a4f82f50fbc2ebd4ca18f8d8399803b033a74fdaf137a252  syslinux-5.01.tar.bz2
975eba87f3a4de17cce1339eec43b07be7f70ffd1aa620cde1fb773e9f6168ab  boot_image.patch
ee970729e981ee1756ffe97f0cdda652d1e82773993310eeecfca1f2ddbe718b  update-extlinux.conf
261c33f782f23fef134abbd9ddfc58535a1ed6d7214cbf9a8a2d2a17edfd5bcf  update-extlinux"
sha512sums="0c075aff27bacf8c1958a344cb118ba20c5869d4b37deac156e0cf0ae8cdc6deab58d611c95d62b377b921e579a058f45306ba6253445ecfc6cd8437737407ab  syslinux-5.01.tar.bz2
1ef418f520a7e63f0d93644552b6224b98986805bc624571a0cf5653f27b522dddce432ccdd5d6a2bee0da34b056fb94e47e387d1c2ec6bcbbc2091d5d294e67  boot_image.patch
d0c5a0891841623c8905864caadf58866d4b9f1f893725712c6813af6cb6d64f0c08f2a3783fda56fcb1cbcc1a0a73e65562339f5591f38ee5cb213b2d16c680  update-extlinux.conf
fe9ae74060214bf52bdd7178c0a50083a0ff7770c1f617a0020fbec17e6b933375dbc9cdaba8c52e30dfe19dcebbb025206230fc67995dd57fb2d121e5111573  update-extlinux"
