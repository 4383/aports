# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=syslinux
pkgver=5.02_pre3
pkgrel=1
_ver=${pkgver/_/-}
pkgdesc="Boot loader for the Linux operating system"
url="http://syslinux.org"
arch="x86 x86_64"
license="GPL"
makedepends="nasm perl util-linux-dev"
depends="mtools blkid mkinitfs"
triggers="syslinux.trigger=/boot"
install="syslinux.post-upgrade"
options="textrels"
ldpath="/usr/share/syslinux"
#source="http://www.kernel.org/pub/linux/utils/boot/syslinux/${pkgver%%.*}.xx/$pkgname-$_ver.tar.bz2
source="https://www.kernel.org/pub/linux/utils/boot/syslinux/Testing/${pkgver%_*}/syslinux-$_ver.tar.xz
	update-extlinux.conf
	update-extlinux
	"
subpackages="$pkgname-doc"

_builddir="$srcdir"/$pkgname-$_ver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case "$i" in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	unset LDFLAGS
	make installer || return 1
}

package() {
	cd "$_builddir"
	make INSTALLROOT="$pkgdir" MANDIR=/usr/share/man local-install

	mkdir -p "$pkgdir"/etc/update-extlinux.d
	cp "$srcdir"/update-extlinux.conf "$pkgdir"/etc/
	sed "/^version=/s/=.*/=$pkgver-r$pkgrel/" "$srcdir"/update-extlinux \
		> "$pkgdir"/sbin/update-extlinux
	chmod 755 "$pkgdir"/sbin/update-extlinux
}

md5sums="88fd0566415b95979818188b244505a7  syslinux-5.02-pre3.tar.xz
7ef73a7a858b8aa1ac6635d6391ac8e5  update-extlinux.conf
e52bf17d58790ff10275ec4e870c6702  update-extlinux"
sha256sums="f3af6b9d91ee047fca06b9b6be965da390e1c2e6fa602de090046c3b2a3144ad  syslinux-5.02-pre3.tar.xz
ee970729e981ee1756ffe97f0cdda652d1e82773993310eeecfca1f2ddbe718b  update-extlinux.conf
a30d92f3d47122b635078a5c9c9e124e368ebe6150e510a3b8649ed8c44258a6  update-extlinux"
sha512sums="a1d90fe0d6da8257da5715a7c1c9a0f004ae6573c1077f3eb16761b478d42c736068a8f3f4650eb3bdfeba1de75ee33ccfa0575a679c6fde749dd3b58ace6429  syslinux-5.02-pre3.tar.xz
d0c5a0891841623c8905864caadf58866d4b9f1f893725712c6813af6cb6d64f0c08f2a3783fda56fcb1cbcc1a0a73e65562339f5591f38ee5cb213b2d16c680  update-extlinux.conf
18ddbcf07d357d5bdb0a82b8fd69a09826bfac6a065527404fab8f98af5d3e760d8ea149118bc792cfa717a4c94271f1ba85e3b358aa2b1c998a66c330c1fbc0  update-extlinux"
