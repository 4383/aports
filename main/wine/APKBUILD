# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=wine
pkgver=1.7.2
_ver=${pkgver/_/-}
pkgrel=0
pkgdesc="A compatibility layer for running Windows programs"
url="http://www.winehq.com"
arch="x86"
license="LGPL"
subpackages="$pkgname-dev $pkgname-doc"
makedepends="fontconfig-dev openldap-dev libxslt-dev libxxf86dga-dev
	libxcursor-dev libxrandr-dev libxdamage-dev mesa-dev flex bison
	libpng-dev libjpeg-turbo-dev freetype-dev ncurses-dev openssl-dev
	libxcomposite-dev libxrender-dev libxinerama-dev zlib-dev
	cups-dev alsa-lib-dev lcms-dev libxml2-dev
	gstreamer-dev gst-plugins-base-dev paxctl dbus-dev libxi-dev gnutls-dev
	tiff-dev v4l-utils-dev udisks2-dev
	autoconf automake"
source="http://downloads.sourceforge.net/project/wine/Source/wine-$_ver.tar.bz2
	jscript-use-bison-directives-instead-of-defines.patch
	msi-use-bison-directives-insetad-of-defines.patch
	vbscript-Use-bison-directives-instead-of-defines.patch
	wbemprox-Use-bison-directives-instead-of-defines.patch
	wrc-Remove-non-bison-compatibility-code.patch
	"

_builddir="$srcdir"/$pkgname-$_ver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	sed -i '/^UPDATE_DESKTOP_DATABASE/s:=.*:=true:' tools/Makefile.in \
		|| return 1
	sed -i '/^MimeType/d' tools/wine.desktop || return 1
	aclocal && autoreconf || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--with-dbus \
		--with-x \
		|| return 1
	make
}

package() {
	cd "$_builddir"
	make -j1 prefix="$pkgdir"/usr install || return 1
	mkdir -p "$pkgdir"/etc/wine
	paxctl -c -psmre "$pkgdir"/usr/bin/wine-preloader \
		"$pkgdir"/usr/bin/wine
}

md5sums="17ece5f22c691bd6067c86f0dd68cfd7  wine-1.7.2.tar.bz2
38bea0015354da182dfa7f7ff870cbbb  jscript-use-bison-directives-instead-of-defines.patch
7fd584ab875b0834ee457eeb351b1190  msi-use-bison-directives-insetad-of-defines.patch
40fc099154043424223bcf5836a64aa0  vbscript-Use-bison-directives-instead-of-defines.patch
cd1fd88a4f58db703828eb5ec0e5c45f  wbemprox-Use-bison-directives-instead-of-defines.patch
c889b79461ee7a7480f8cc89682cee76  wrc-Remove-non-bison-compatibility-code.patch"
sha256sums="0bfc4276c93de1fdd5989f91807c7362b11995efdf581d60601fec789665b7f1  wine-1.7.2.tar.bz2
80d16a130e9e84a0eb7853f36bb05dfaf420ec78e1f8df563d7ed4694a10df7a  jscript-use-bison-directives-instead-of-defines.patch
b84ca975dba80f0cb90321177f2bcbac35f86d244fa15e7ae3de921ddb10803c  msi-use-bison-directives-insetad-of-defines.patch
e8e20f6ca8702dbe76fbe12751685d1ae28157fb430fe3280098201aaa96769c  vbscript-Use-bison-directives-instead-of-defines.patch
3da101c81ae94d14dbcda8d0af32ab4dcdda85a020c01640a75581a011d9f4dc  wbemprox-Use-bison-directives-instead-of-defines.patch
5348fde97aa89825a872805d84062dc623782a7b7d8321f6b3ddb4ff2dd11f8f  wrc-Remove-non-bison-compatibility-code.patch"
sha512sums="19f80fc487816413973b23f6691e44caa21c7ac362a797a7e8c2c96e227d527575e0148f342bb7f1f7210a7b2f0f44626692d503757dc96b735345837152cb19  wine-1.7.2.tar.bz2
5ef7ec422aa13ea9b26937eed8ee63ed12452d2c7dbc8ae9ec3f336dbf3e5be72845d19dcaeac5598303c09833896accd200bb0cca48dadef9e4a748ce5ef60d  jscript-use-bison-directives-instead-of-defines.patch
23863f79c90614430a0ba880daaad76c95d7d0bbe2d192a02b0121012f39f68d46cfb86fb01990ca19c358807f16e383d891ca295057774901277ba3f5236392  msi-use-bison-directives-insetad-of-defines.patch
90ed0ec93372d3c45bacce3e90c825205eeb31645848a48875f71ff066e59b53f1a97f575615e66d1f2fff82703c60e016969d5b2fa66bc7f23688b67d2cf3e7  vbscript-Use-bison-directives-instead-of-defines.patch
5631449ede0f8f93f9a02c52bcf8e583c6ca2216113c911b6f6ed145b22eab09b9756df4dbb68a449ecbc4e7ac88d87311789f1dddf495a771c96345bf032c18  wbemprox-Use-bison-directives-instead-of-defines.patch
b34670680b5f0bef33e49ae411b2728e18d84a35fbb73f853b1692e88585b28d30c0f49f9bc53fbd9e440fc9b178e9b52e51434d4c13b977815dc982a3c72cec  wrc-Remove-non-bison-compatibility-code.patch"
