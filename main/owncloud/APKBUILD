# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname="owncloud"
pkgver="5.0.11"
pkgrel=0
pkgdesc="Your own WebDAV-based cloud service"
url="http://owncloud.org"
arch="noarch"
license="AGPL"
depends="php php-ctype php-dom php-gd php-iconv php-json php-zlib
	php-zip"
depends_dev=
makedepends="$depends_dev"
install="$pkgname.post-install $pkgname.post-upgrade"
subpackages="$pkgname-pgsql $pkgname-sqlite $pkgname-mysql
	$pkgname-texteditor $pkgname-videoviewer"
replaces="$pkgname-plugins"
source="http://download.owncloud.org/community/$pkgname-$pkgver.tar.bz2
	owncloud.config.php
	"

_builddir="$srcdir"/$pkgname

prepare() {
	cd "$_builddir"
	return 0
}

build() {
	cd "$_builddir"
}

package() {
	cd "$_builddir"
	mkdir -p "$pkgdir"/etc/owncloud
	mkdir -p "$pkgdir"/var/lib/owncloud/data
	mkdir -p "$pkgdir"/usr/share/webapps/owncloud
	rm -rf config data
	mv * "$pkgdir"/usr/share/webapps/owncloud || exit
	ln -s /etc/owncloud "$pkgdir"/usr/share/webapps/owncloud/config || exit 1
	mv "$pkgdir"/usr/share/webapps/owncloud/apps "$pkgdir"/var/lib/owncloud || exit 1
	ln -s /var/lib/owncloud/apps "$pkgdir"/usr/share/webapps/owncloud/apps || exit 1
	install -m640 ../owncloud.config.php "$pkgdir"/etc/owncloud/config.php
}

pgsql() {
	pkgdesc="ownCloud PostgreSQL support"
	depends="owncloud php-pgsql php-pdo_pgsql php-pear-mdb2-driver-pgsql"
	mkdir -p "$subpkgdir"/usr/share/webapps/owncloud
}

sqlite() {
	pkgdesc="ownCloud SQLite support"
	depends="owncloud php-sqlite3 php-pdo_sqlite"
	mkdir -p "$subpkgdir"/usr/share/webapps/owncloud
}

mysql() {
	pkgdesc="ownCloud MySQL support"
	depends="owncloud php-mysql php-pdo_mysql php-pear-mdb2-driver-mysql"
	mkdir -p "$subpkgdir"/usr/share/webapps/owncloud
}

plugins() {
	pkgdesc="ownCloud 3rdparty plugins"
	depends="owncloud"
	mkdir -p "$subpkgdir"/usr/share/webapps/owncloud
	mv "$pkgdir"/usr/share/webapps/owncloud/3rdparty \
	 "$subpkgdir"/usr/share/webapps/owncloud
}

_mv_app() {
	mkdir -p "$subpkgdir"/var/lib/owncloud/apps
	mv "$pkgdir"/var/lib/owncloud/apps/files_$1 \
	 "$subpkgdir"/var/lib/owncloud/apps
}

texteditor() {
	pkgdesc="ownCloud integrated text editor"
	depends="owncloud"
	_mv_app texteditor
}

videoviewer() {
	pkgdesc="ownCloud integrated video viewer"
	depends="owncloud"
	_mv_app videoviewer
}


md5sums="ae31d78bf9b29835330922fefa96e076  owncloud-5.0.11.tar.bz2
0842b77fcd7f62e5d583f329ee9f02ad  owncloud.config.php"
sha256sums="1f0418c3aa5e05556c1fd9f77d2a906cb67a789087f02e49790ce1e06f356e9e  owncloud-5.0.11.tar.bz2
0d70060f93590fa68ab42ddcba60af029d3bd10973fa34406a9ba5d7e1da1e5b  owncloud.config.php"
sha512sums="780fcfc5c3d3f77de992bae327a01663309e4dd2c407a20df2fe231be14070a842b8b79aa0b3afcf9ffda93fe1da64697b104c8ea7864ea3d8e2d9fbc1009595  owncloud-5.0.11.tar.bz2
addb28f9bb42315bd31195f264d28f85ac3610c543d7bc283e9239085509d5bfd1644fef401571f45755c2e2d798cdbaf5647cb64d7732598a9eac69f6a5fae0  owncloud.config.php"
