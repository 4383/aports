# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=phpldapadmin
pkgver=1.2.3
pkgrel=1
pkgdesc="Web front-end for managing OpenLDAP"
url="http://phpldapadmin.sourceforge.net"
arch="noarch"
license="GPL2"
depends="php php-ldap php-gettext php-xml"
depends_dev=
makedepends="$depends_dev"
install=
subpackages=
source="http://downloads.sourceforge.net/project/$pkgname/$pkgname-php5/$pkgver/$pkgname-$pkgver.tgz
	$pkgname.additional-template
	phpldapadmin-1.2.3-force-ssha512.patch
	"


_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
        for i in $source; do
                case $i in
                *.patch)
                        msg "Applying $i..."
                        if ! patch -s -p1 -N -i "$srcdir"/$i; then
                                echo $i >>failed
                                _patch_failed=1
                        fi
                        ;;
                esac
        done

}

build() {
	cd "$_builddir"
}

package() {
	cd "$_builddir"
	mkdir -p "$pkgdir"/usr/share/webapps/phpldapadmin
	mkdir -p "$pkgdir"/etc
	mv * "$pkgdir"/usr/share/webapps/phpldapadmin
	mv "$pkgdir"/usr/share/webapps/phpldapadmin/config "$pkgdir"/etc/phpldapadmin 
	ln -s /etc/phpldapadmin "$pkgdir"/usr/share/webapps/phpldapadmin/config || return 1
	install -Dm644 ../$pkgname.additional-template \
	  "$pkgdir"/usr/share/webapps/phpldapadmin/templates/creation/groupOfNames.xml || return 1
}

md5sums="59a49054039ceb852c2da377d8742360  phpldapadmin-1.2.3.tgz
3ca4fbf9e16f192b441b51b2d25ecf14  phpldapadmin.additional-template
34e36e414f59c6ed4946efa1f277f962  phpldapadmin-1.2.3-force-ssha512.patch"
sha256sums="aecaf8c3ce77ba3899dd31ee5ee183555b2f9349eb8e196dcd33d8a3c485ed58  phpldapadmin-1.2.3.tgz
85e931a84f3fd5e398da24403425b58711c48196ed9692f7a312883a0ed9fae0  phpldapadmin.additional-template
0cd1d8195ecdc53cde9667bf256d2243d67675ac92547d163a707659df5a3d9a  phpldapadmin-1.2.3-force-ssha512.patch"
sha512sums="58a57ca577586685ebd0d7fde7e299b8945d1693018c7803e19239b79f4b9d72a4d207d53c9f284268e32398108038efafcdb434e634619bfe87db3524d267b6  phpldapadmin-1.2.3.tgz
913cc89bfba3a24064865f091a3bcc6ec88db0824d750e8b3b1f6497b5ac1a1e158ced895f1f85f93607402e9353798b3dd4ccdbb1454713f96937c884456eb7  phpldapadmin.additional-template
aecbf3699af4ae39426c6c81edd45a738cdd91f9cfc1e8062ade4b6fa11e7530a8d8b4c2730cd648749b87381dbcca1bbe8681b8e45ec7af50b6b74137f89331  phpldapadmin-1.2.3-force-ssha512.patch"
