--- ./libudev/libudev-util-private.c
+++ ./libudev/libudev-util-private.c.orig
@@ -133,8 +133,8 @@
 uid_t util_lookup_user(struct udev *udev, const char *user)
 {
 	char *endptr;
-	size_t buflen = sysconf(_SC_GETPW_R_SIZE_MAX);
-	char buf[buflen];
+	int buflen = sysconf(_SC_GETPW_R_SIZE_MAX);
+	char buf[buflen>0 ? buflen : 1024];
 	struct passwd pwbuf;
 	struct passwd *pw;
 	uid_t uid;
