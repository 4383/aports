# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxi
pkgver=1.4.5
pkgrel=1
pkgdesc="X11 Input extension library"
url="http://xorg.freedesktop.org"
arch="all"
license="custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
depends_dev="inputproto libx11-dev libxext-dev"
makedepends="
	$depends_dev
	xextproto
	xproto
	autoconf automake libtool util-macros
	"
source="http://xorg.freedesktop.org/releases/individual/lib/libXi-$pkgver.tar.bz2
	0001-Expand-comment-on-the-memory-vs.-reply-ordering-in-X.patch
	0002-Copy-the-sequence-number-into-the-target-event-too-6.patch
	0003-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
	0004-Stack-buffer-overflow-in-XGetDeviceButtonMapping-CVE.patch
	0005-memory-corruption-in-_XIPassiveGrabDevice-CVE-2013-1.patch
	0006-unvalidated-lengths-in-XQueryDeviceState-CVE-2013-19.patch
	0007-integer-overflow-in-XGetDeviceControl-CVE-2013-1984-.patch
	0008-integer-overflow-in-XGetFeedbackControl-CVE-2013-198.patch
	0009-integer-overflow-in-XGetDeviceDontPropagateList-CVE-.patch
	0010-integer-overflow-in-XGetDeviceMotionEvents-CVE-2013-.patch
	0011-integer-overflow-in-XIGetProperty-CVE-2013-1984-5-8.patch
	0012-integer-overflow-in-XIGetSelectedEvents-CVE-2013-198.patch
	0013-Avoid-integer-overflow-in-XGetDeviceProperties-CVE-2.patch
	0014-Avoid-integer-overflow-in-XListInputDevices-CVE-2013.patch
	0015-sign-extension-issue-in-XListInputDevices-CVE-2013-1.patch
	0016-Don-t-overwrite-the-cookies-serial-number.patch
	"

 
_builddir="$srcdir"/libXi-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	libtoolize --force && aclocal && autoconf && autoheader \
	                && automake --add-missing
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr --sysconfdir=/etc || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="82dcdc76388116800a2c3ad969f510a4  libXi-1.4.5.tar.bz2
c0c052c5a0b6ff9b50f413cdc4bc8f5c  0001-Expand-comment-on-the-memory-vs.-reply-ordering-in-X.patch
3a9c4bf6da4faee8aea8a3c17f1250a7  0002-Copy-the-sequence-number-into-the-target-event-too-6.patch
2030ba2ffa05fc0003b8624d05768b22  0003-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
cb0fbf3cdfef06a12db6ee8deaf1bdfe  0004-Stack-buffer-overflow-in-XGetDeviceButtonMapping-CVE.patch
b29c53b3c77685c7a9e92ff164069a4c  0005-memory-corruption-in-_XIPassiveGrabDevice-CVE-2013-1.patch
81780c4a48c3f16a3d08056e4b0f96a2  0006-unvalidated-lengths-in-XQueryDeviceState-CVE-2013-19.patch
67cbebc59c86f8895a6d3f5ca2449e60  0007-integer-overflow-in-XGetDeviceControl-CVE-2013-1984-.patch
901ddbf2c247fa31108f8b79c2228199  0008-integer-overflow-in-XGetFeedbackControl-CVE-2013-198.patch
380f49370c6acab49a15d5be5ff629ad  0009-integer-overflow-in-XGetDeviceDontPropagateList-CVE-.patch
11d6ff63524ffdbdbc64faa3cf6e7919  0010-integer-overflow-in-XGetDeviceMotionEvents-CVE-2013-.patch
1a8a8af65af071ed2d03d89fe65d3f85  0011-integer-overflow-in-XIGetProperty-CVE-2013-1984-5-8.patch
3d72dcd08c560d21efc8fa7a78b0d8e6  0012-integer-overflow-in-XIGetSelectedEvents-CVE-2013-198.patch
057cf9b49f542ce5f5e006f3d4155bc4  0013-Avoid-integer-overflow-in-XGetDeviceProperties-CVE-2.patch
bace284f9d20dee5fe6caf287fbfc024  0014-Avoid-integer-overflow-in-XListInputDevices-CVE-2013.patch
40a7631fc06edd14c8ba9405c16ce1c6  0015-sign-extension-issue-in-XListInputDevices-CVE-2013-1.patch
3e3bff61d4f9aabb5346dc4e47819921  0016-Don-t-overwrite-the-cookies-serial-number.patch"
