# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=apk-tools
pkgver=2.0_rc1
pkgrel=2
pkgdesc="Alpine Package Keeper - package manager for alpine"
subpackages="$pkgname-static"
depends=
makedepends="zlib-dev openssl-dev pkgconfig"
source="http://git.alpinelinux.org/cgit/$pkgname/snapshot/$pkgname-$pkgver.tar.bz2
	0001-info-fix-a-exists-to-work-if-the-name-is-non-existan.patch
	0002-audit-fix-backup.patch
	0003-db-command-line-repositories-take-preference.patch
	0004-state-ignore-missing-world-dependencies-with-force-a.patch
	0005-audit-do-not-load-repositories.patch
	0006-db-make-missing-index-non-fatal.patch
	"


url="http://git.alpinelinux.org/cgit/apk-tools/"
license=GPL-2

build() {
	cd "$srcdir/$pkgname-$pkgver"
	sed -i -e 's:-Werror::' Make.rules
	for i in ../*.patch; do
		msg "Applying $i"
		patch -p1 -i $i || return 1
	done

	make || return 1
	make static || return 1
	make DESTDIR="$pkgdir" install
	cd "$pkgdir/sbin"
	ln -s apk apk_add
	ln -s apk apk_audit
	ln -s apk apk_del
	ln -s apk apk_index
	ln -s apk apk_info
	ln -s apk apk_version
}

static() {
	pkgdesc="Alpine Package Keeper - static binary"
	install -Dm755 "$srcdir"/$pkgname-$pkgver/src/apk.static \
		"$subpkgdir"/sbin/apk.static
}

md5sums="f790182792a41841e6932ae0b6737a43  apk-tools-2.0_rc1.tar.bz2
c0be62f4ca4153241f82a29ee0e5ac7d  0001-info-fix-a-exists-to-work-if-the-name-is-non-existan.patch
515b39f942d6ad6ee8f022869b5ed3ab  0002-audit-fix-backup.patch
c59e35ef85ebeed98fa04dbf32fee6e6  0003-db-command-line-repositories-take-preference.patch
3377a1bc507bb3f5218e2957d642c77c  0004-state-ignore-missing-world-dependencies-with-force-a.patch
ab2d76d6308215407dfd9f2f67c05b67  0005-audit-do-not-load-repositories.patch
5d2fcd1c6a7c5040fc189ffa7d12c1e5  0006-db-make-missing-index-non-fatal.patch"
