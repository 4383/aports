From 38c1e65afbb334af0107c6bdd5362303473d866f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Timo=20Ter=C3=A4s?= <timo.teras@iki.fi>
Date: Tue, 1 May 2012 14:30:06 +0300
Subject: [PATCH 1/2] db: strip leading and trailing slashes from protected
 path spec

---
 src/database.c |    6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/database.c b/src/database.c
index 26774be..bcc707f 100644
--- a/src/database.c
+++ b/src/database.c
@@ -1181,6 +1181,12 @@ static int add_protected_path(void *ctx, apk_blob_t blob)
 		break;
 	}
 
+	/* skip leading and trailing path separators */
+	while (blob.len && blob.ptr[0] == '/')
+		blob.ptr++, blob.len--;
+	while (blob.len && blob.ptr[blob.len-1] == '/')
+		blob.len--;
+
 	*apk_protected_path_array_add(&db->protected_paths) = (struct apk_protected_path) {
 		.relative_pattern = apk_blob_cstr(blob),
 		.protected = protected,
-- 
1.7.10

