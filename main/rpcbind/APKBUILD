# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=rpcbind
pkgver=0.2.1
pkgrel=2
pkgdesc="portmap replacement which supports RPC over various protocols"
url="http://rpcbind.sourceforge.net"
arch="all"
license="custom"
depends=
install="$pkgname.pre-install $pkgname.pre-upgrade"
makedepends="libtirpc-dev autoconf automake"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.bz2
	0002-uclibc-rpcsvc-defines.patch
	rpcbind-0.2.1-rpcuser.patch
	rpcbind.initd
	rpcbind.confd
	CVE-2015-7236.patch"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	autoreconf -fisv || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--bindir=/sbin \
		--enable-warmstarts \
		--with-statedir=/var/lib/rpcbind \
		--with-rpcuser=rpc \
		--enable-debug \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -Dm755 "$srcdir"/rpcbind.initd "$pkgdir"/etc/init.d/rpcbind
	install -Dm644 "$srcdir"/rpcbind.confd "$pkgdir"/etc/conf.d/rpcbind
	install -D -m644 COPYING "$pkgdir"/usr/share/licenses/rpcbind/COPYING
}
md5sums="0a5f9c2142af814c55d957aaab3bcc68  rpcbind-0.2.1.tar.bz2
944234c5ef6902d25bd6dfc95f979ed6  0002-uclibc-rpcsvc-defines.patch
05a4f6558dbfe4c69574ff3a8fee250d  rpcbind-0.2.1-rpcuser.patch
381a2722c69b4597af532381f1ffeae0  rpcbind.initd
2517c71cdb08f133b0d50055a44c56de  rpcbind.confd
940f7bed3ee84d3f827a2bfd6f19c624  CVE-2015-7236.patch"
sha256sums="da169ff877a5a07581fad50a9a808ac6e96f0c277a3df49a7ef005778428496e  rpcbind-0.2.1.tar.bz2
a1970cbe4bcc4704dba49e4a2c5be5105a631d9067c4d5cb5b073e62b5d90c65  0002-uclibc-rpcsvc-defines.patch
ba5d2f25b9c06b057da97418fd479b511e1d16dc7f300173383c33904f1890bd  rpcbind-0.2.1-rpcuser.patch
674d5af3957c81ff4bd97811d88e064b75f742c351b63c51c397d3779fb57604  rpcbind.initd
55bcd47a4d0f194f09e6abb13695853459f869b54ce09ef051e55efcd8ad3903  rpcbind.confd
e7aafff7fe20a5d9fdb0f93a5b6824e136934f4fbb20d210f398e851cb13f419  CVE-2015-7236.patch"
sha512sums="5ec1e25c64ad3cd80fc2f14ced64a331afbe896fb3da54c812e3c4a78a69df181f607492762fe852732cc0ac9bd87ee118760b9e7fad2b3f028d581fecc93849  rpcbind-0.2.1.tar.bz2
8750c9b2b44daf42f35ec1c72c52497872724cd40951f7f3d34ca60cab9e291eb00f3b2d0ca9b0985c0877a80f8279a35f14a1ecf64a991e8650af5221a094f6  0002-uclibc-rpcsvc-defines.patch
f9836d2a0d4fa11a9033bdf654637645e977d27e01e6fe232f67d92e9c6ffb4124d9191101148cb9cf4df2672b020f5cfebc5f3d54fd5e592c6283ebc29f9833  rpcbind-0.2.1-rpcuser.patch
9fb26b3a496c616a36f85a3af5580fb364bf404ae040ba8719d30dbdea0ea906cf07e1bc1b4c5f6e4b95b121bbd5b5c687ae17cf26617b2b2981ff7e3ef6d83b  rpcbind.initd
0641087162ebc8fb10c5cb329105261d77cad073daed3f9a6c92574177298cd8a19a87b62dde14161cc554b5e68680cfd870b5334f3cfd8d6074ec8a43f4dfe3  rpcbind.confd
c91628b6e5758a02790651d914f35c10d19807955721d910a4d391cde0071efee169cfddd788855677bc1d509fba3a1bc5e40601d327a5f7f8487ad8f06b197a  CVE-2015-7236.patch"
