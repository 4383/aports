# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lvm2
pkgver=2.02.79
pkgrel=0
pkgdesc="Logical Volume Manager 2 utilities"
url="http://sourceware.org/lvm2/"
arch="x86 x86_64"
license="GPL"
depends=
makedepends="readline-dev pkgconfig"
source="ftp://sources.redhat.com/pub/$pkgname/LVM2.$pkgver.tgz
	lvm.initd
	lvm.confd
	"
subpackages="$pkgname-dev $pkgname-doc device-mapper:dm"

build () {
	cd "$srcdir"/LVM2.$pkgver

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--libdir=/lib \
		--sbindir=/sbin \
		--localstatedir=/var \
		--disable-nls \
		--enable-pkgconfig \
		CLDFLAGS="$LDFLAGS" \
		|| return 1

	# TODO: fix parallel builds
	make -j1 || return 1
}

package() {
	cd "$srcdir"/LVM2.$pkgver
	make -j1 DESTDIR="$pkgdir" \
		install || return 1
		#usrlibdir="$pkgdir"/lib \
	install -d "$pkgdir"/etc/lvm/archive "$pkgdir"/etc/lvm/backup
	install -Dm755 "$srcdir"/lvm.initd "$pkgdir"/etc/init.d/lvm
	install -Dm644 "$srcdir"/lvm.confd "$pkgdir"/etc/conf.d/lvm
        # some packages need this iin usr/lib
	cd "$pkgdir"/lib || return 1
	ln -s libdevmapper.so.1.02 libdevmapper.so || return 1
}

dm() {
	pkgdesc="Device mapper userspace library and tools from LVM2"
	mkdir -p "$subpkgdir"/sbin
	mv "$pkgdir"/lib "$subpkgdir"/
	mv "$pkgdir"/sbin/dm* "$subpkgdir"/sbin/
}

md5sums="e6929251a90b0b626c024942a242f337  LVM2.2.02.79.tgz
6f65f902cf19f144a42b8d6aceadf395  lvm.initd
ec36d5fe4561220304e406c5c797e71f  lvm.confd"
