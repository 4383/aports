# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=mysql
pkgver=5.0.83
pkgrel=1
pkgdesc="A fast SQL database server"
url="http://www.mysql.com/"
license='GPL'
depends=
makedepends="libtool uclibc++-dev readline-dev openssl-dev ncurses-dev zlib-dev"
source="http://sunsite.informatik.rwth-aachen.de/mysql/Downloads/MySQL-5.0/${pkgname}-${pkgver}.tar.gz
$pkgname.initd
$pkgname.mycnf"
subpackages="$pkgname-doc $pkgname-dev $pkgname-test libmysqlclient $pkgname-client"

build() {
        cd "$srcdir/$pkgname-$pkgver"
	export CXX=g++-uc
        ./configure --prefix=/usr --libexecdir=/usr/sbin \
        --localstatedir=/var/lib/mysql \
        --disable-assembler --with-pthread \
        --without-raid --without-libwrap \
        --without-pstack --without-docs \
        --without-embedded-server --with-openssl \
        --without-mysqlfs --without-vio \
        --without-bench --without-debug \
	--with-unix-socket-path=/var/run/mysqld/mysqld.sock \
        --with-innodb --mandir=/usr/share/man || return 1
        make || return 1
        make -j1 DESTDIR="$pkgdir/" install
        install -Dm 755 "$startdir"/$pkgname.initd $pkgdir/etc/init.d/$pkgname
        install -Dm 644 "$startdir"/$pkgname.mycnf $pkgdir/etc/mysql/my.cnf
        install -dDo mysql $pkgdir/var/log/mysql
        install -dDo mysql $pkgdir/var/run/mysqld
}

libmysqlclient() {
	pkgdesc="MySQL client library"
	mkdir -p "$subpkgdir"/usr/lib/mysql
	mv "$pkgdir"/usr/lib/mysql/libmysqlclient.so* "$subpkgdir"/usr/lib/mysql
	# make symlinks
	cd "$subpkgdir"/usr/lib
	for i in mysql/*; do
		ln -s "$i" "${i##*/}"
	done
}

test() {
        mkdir -p "$subpkgdir"/usr
        mv "$pkgdir"/usr/mysql-test "$subpkgdir"/usr/
}

client() {
	pkgdesc="client for the MySQL database"
	install=""
	local bins="myisam_ftdump mysql mysqlaccess mysqladmin mysqlbug mysqlcheck
	mysql_client_test mysqldump mysqldumpslow mysql_explain_log mysql_find_rows
	mysql_fix_extensions mysqlimport mysqlshow mysql_tableinfo mysqltestmanagerc
	mysqltestmanager-pwgen mysql_waitpid"
	
	mkdir -p "$subpkgdir"/usr/bin/

	for i in $bins; do
		mv "$pkgdir"/usr/bin/${i} "$subpkgdir"/usr/bin/
	done
}

md5sums="051392064a1e32cca5c23a593908b10e  mysql-5.0.83.tar.gz
25d08b02bff6aa379dc45859b7a3f28a  mysql.initd
15a7e3ddd6a40bf5a1eb3a8c69d9c34c  mysql.mycnf"
