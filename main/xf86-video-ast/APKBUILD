# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xf86-video-ast
pkgver=0.97.0
pkgrel=4
pkgdesc="X.Org driver for ASpeedTech cards"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
subpackages="$pkgname-doc"
depends=
makedepends="pkgconfig xorg-server-dev libxi-dev fontsproto randrproto
	videoproto renderproto"

source="http://xorg.freedesktop.org/releases/individual/driver/$pkgname-$pkgver.tar.bz2
	mibstore.patch"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}
build() {
	cd "$_builddir"
	export LDFLAGS="$LDFLAGS -Wl,-z,lazy"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/xorg/modules/drivers/*.la || return 1
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}
md5sums="2b630ed7d7864045b324b39cd58da367  xf86-video-ast-0.97.0.tar.bz2
cf7f0346da96567652f89f367136b1dc  mibstore.patch"
sha256sums="28fcd4781676485293f6dcd46e0797866f6219e22e1851c9796b037589998e76  xf86-video-ast-0.97.0.tar.bz2
f28cb96f3de6089880b7e04572f6fa6d6cfa149718569bfc2389090677af5e7c  mibstore.patch"
sha512sums="7eadb06c0159d460977b6e99183e6f1c4673f18b26072d9c28fc38518522fe9adade89531a42d83e277d545a3f157c37c6600b0330bb90327c1a17b5698fa22d  xf86-video-ast-0.97.0.tar.bz2
5d7af51fa6939c062d0e5e21938a9df79c06e79bba7b7940d2dacc56c40c78819390004b704a30e21cd054a2590ae21274645e53ffbc2d0340f0a8e5b7aad5de  mibstore.patch"
