# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Carlo Landmeter <clandmeter@gmail.com>
pkgname=gd
pkgver=2.1.1
_myver=${pkgver/_rc/RC}
pkgrel=1
pkgdesc="Library for the dynamic creation of images by programmers"
url="http://www.libgd.org/"
arch="all"
license="custom"
depends=
makedepends="libpng-dev libjpeg-turbo-dev freetype-dev zlib-dev"
subpackages="$pkgname-dev $pkgname-doc"
source="http://bitbucket.org/libgd/gd-libgd/downloads/libgd-$pkgver.tar.xz
	CVE-2016-3074.patch
	"

_builddir="$srcdir"/lib$pkgname-$_myver
prepare() {
	cd "$_builddir"
	update_config_sub || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-png \
		--with-freetype \
		--with-jpeg \
		--without-xpm \
		--without-fontconfig \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -D -m644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
	rm -r "$pkgdir"/usr/lib/libgd.la
}

md5sums="9076f3abd1f9815d106da36467ea15bc  libgd-2.1.1.tar.xz
9a90f7e93c8259953ef8f67aead1b2b6  CVE-2016-3074.patch"
sha256sums="9ada1ed45594abc998ebc942cef12b032fbad672e73efc22bc9ff54f5df2b285  libgd-2.1.1.tar.xz
827b4c3522bb865976cc56b92a60bc0df4e271a46044ac4994881b0106aaddf9  CVE-2016-3074.patch"
sha512sums="48f444402a4b89e412870f9091b92eb26136c5c0d795722262ad973c7d4103476204a2de36133a2634b8f410d6bccdcf60afb829a74ac2fddfb96aff2cd2567b  libgd-2.1.1.tar.xz
8887f305cda02594fa4296a343a9c5fdc579f0cab72f4a5fcdf9cbf3d813fa05c0a53ab4fa879de0102c41d10cb08831902a379d2fdb5142d7b8e6d1ea3ef81a  CVE-2016-3074.patch"
