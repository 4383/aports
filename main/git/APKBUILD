# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=git
pkgver=1.6.4.4
pkgrel=0
pkgdesc="GIT - the stupid content tracker"
url="http://git.or.cz/"
license="GPL2"
depends=
subpackages="$pkgname-doc $pkgname-perl"
makedepends="zlib-dev openssl-dev curl-dev expat-dev perl-dev"
source="http://kernel.org/pub/software/scm/git/git-$pkgver.tar.bz2
	bb-tar.patch
	"

build () {
	local makeopts="NO_ICONV=YesPlease
			NO_NSEC=YesPlease
			NO_TCLTK=YesPlease
			NO_SVN_TESTS=YesPlease"

	cd $srcdir/$pkgname-$pkgver
	patch -p1 < ../bb-tar.patch || return 1

	make prefix=/usr DESTDIR="$pkgdir" $makeopts || return 1
	make prefix=/usr DESTDIR="$pkgdir" $makeopts install
}

perl() {
	depends="perl git perl-net-smtp-ssl perl-authen-sasl"
	pkgdesc="Perl scripts for git"
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/perl* "$subpkgdir"/usr/lib/
	cd "$pkgdir"
	find -type f | xargs file --mime-type | grep perl | cut -d: -f1| while read f; do
		mkdir -p "$subpkgdir"/${f%/*}
		mv "$f" "$subpkgdir"/${f%/*}
	done
	find "$pkgdir" -name perllocal.pod -delete
}


md5sums="b150352782998ca1f84185e6af53ec26  git-1.6.4.4.tar.bz2
04e1bdf76a0bac568f8488daad07dce7  bb-tar.patch"
