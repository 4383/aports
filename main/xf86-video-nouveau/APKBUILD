# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xf86-video-nouveau
#_gitdate=20111010
pkgver=1.0.8
pkgrel=0
pkgdesc="Open-source X.org drivers for nVidia video cards"
url="http://nouveau.freedesktop.org/"
arch="all"
license="MIT"
depends=""
depends_dev=
makedepends="pkgconfig randrproto renderproto videoproto xextproto libdrm-dev
	xorg-server-dev util-macros libtool autoconf automake xf86driproto
	udev-dev"
install=""
subpackages="$pkgname-doc"
source="http://xorg.freedesktop.org/releases/individual/driver/xf86-video-nouveau-$pkgver.tar.bz2"

_builddir="$srcdir"/xf86-video-nouveau-$pkgver

mksource() {
	mkdir /tmp/${pkgname}-${_gitdate}
	(cd /tmp/${pkgname}-${_gitdate};
	git clone -v --depth 1 git://anongit.freedesktop.org/nouveau/xf86-video-nouveau;
	cd xf86-video-nouveau;
	git archive --prefix=xf86-video-nouveau-${_gitdate}/ --format=tar HEAD | bzip2 > /tmp/${pkgname}-${_gitdate}/${pkgname}-${_gitdate}.tar.bz2)
}

build() {
	cd "$_builddir"
	export LDFLAGS="$LDFLAGS -Wl,-z,lazy"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/xorg/modules/*/*.la || return 1
}

md5sums="146b9afdfcb64d6b6ba0dbeaa167548e  xf86-video-nouveau-1.0.8.tar.bz2"
sha256sums="9b904314b8e9c7a5800724a6a31038ed88fa3fcfd35da6f4015fc104c8283617  xf86-video-nouveau-1.0.8.tar.bz2"
sha512sums="9eef0e697df83cb37fdd041b6d69b1ffeb47de6503edadbc3e311efbf47155461124722100288a7c7eb8b49c8b64d4e06fc848ee8975d39da962886ad90b7ce8  xf86-video-nouveau-1.0.8.tar.bz2"
