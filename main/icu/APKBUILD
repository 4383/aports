# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=icu
pkgver=51.2

# convert x.y.z to x_y_z
_ver=${pkgver//./_}

pkgrel=0
pkgdesc="International Components for Unicode library"
url="http://www.icu-project.org/"
arch="all"
license="custom:icu"
subpackages="$pkgname-dev $pkgname-doc $pkgname-libs"
depends=
makedepends=
source="http://download.icu-project.org/files/icu4c/${pkgver}/${pkgname}4c-$_ver-src.tgz
	icu-timezone-uclibc.patch
	"

_builddir="$srcdir"/icu/source

prepare() {
	cd "$_builddir"
	local x
	# https://bugs.icu-project.org/trac/ticket/6102
	for x in ARFLAGS CFLAGS CPPFLAGS CXXFLAGS FFLAGS LDFLAGS; do
		sed -i -e "/^${x} =.*/s:@${x}@::" "config/Makefile.inc.in" \
			|| return 1
	done

	for i in $source; do
		case "$i" in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
}

build() { 
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--with-data-packaging=library \
		--disable-samples \
		--mandir=/usr/share/man \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	chmod +x "$pkgdir"/usr/bin/icu-config
	install -Dm644 "$srcdir"/icu/license.html \
		"$pkgdir"/usr/share/licenses/icu/license.html
}

libs() {
	default_libs
	replaces="icu"
}

md5sums="072e501b87065f3a0ca888f1b5165709  icu4c-51_2-src.tgz
70aabd2c1e14477cfa261e729ffd7054  icu-timezone-uclibc.patch"
sha256sums="deb027a05f1b3bec03298b96fb93b28c84e9683c22e6f94effa67fdc7bd704cc  icu4c-51_2-src.tgz
ce246c007664cb2440ad4c3a224e8133b50b302051783d383c67a0e2b116d176  icu-timezone-uclibc.patch"
sha512sums="74e22b792d6812c1bf2192f2572f75ec8a14fac5e9b00850f9225279fc09da913082001bef20595f6634a5c3f3335e92906568023544516da69a775bcf5e2a1a  icu4c-51_2-src.tgz
4fad17085e9c6b4f16e29b60558fbb594015068466718944ef4a4f2e08bf43d7b0bb81d908f0f7e8e2c1594c44c5923e92a848aef15e7862c64fa65a66a08212  icu-timezone-uclibc.patch"
