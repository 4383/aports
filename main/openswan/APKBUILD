# Contributor: Danilo Godec <danilo.godec@agenda.si>
# Maintainer: Borys Zhukov <mp5@mp5.im>
pkgname=openswan
pkgver=2.6.38
pkgrel=2
pkgdesc="IPsec Implementation which Allows Building of VPNs"
url="http://www.openswan.org/"
arch="all"
license="GPL"
depends="perl lsof"
makedepends="gmp-dev bison flex coreutils bash"
install=""
subpackages="$pkgname-doc"
source="http://download.openswan.org/openswan/$pkgname-$pkgver.tar.gz
	openswan-libreswan-backport-949437-atodn.patch
	openswan-libreswan-backport-949437-do_3des.patch
	openswan-libreswan-backport-949437-do_aes.patch
	openswan-libreswan-backport-949437-x509dn.patch
	ipsec.initd setup.patch"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	make INC_RCDEFAULT=/etc/init.d INC_USRLOCAL=/usr programs || return 1
}

package() {
	cd "$_builddir"
	make INC_MANDIR=share/man \
		INC_RCDEFAULT=/etc/init.d \
		INC_USRLOCAL=/usr \
		DESTDIR="$pkgdir" \
		INSTCONFFLAGS=-m644 \
		install || return 1
	install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING

	install -Dm755 "$srcdir"/ipsec.initd "$pkgdir"/etc/init.d/ipsec
	install -Dm644 BUGS "$pkgdir"/usr/share/doc/$pkgname/BUGS
	install -Dm644 CHANGES "$pkgdir"/usr/share/doc/$pkgname/CHANGES
	install -Dm644 CREDITS "$pkgdir"/usr/share/doc/$pkgname/CREDITS
	install -Dm644 INSTALL "$pkgdir"/usr/share/doc/$pkgname/INSTALL
	install -Dm644 README "$pkgdir"/usr/share/doc/$pkgname/README
	cp -aR docs/* "$pkgdir"/usr/share/doc/$pkgname/

}
md5sums="13073eb5314b83a31be88e4117e8bbcd  openswan-2.6.38.tar.gz
500e936c90ad27545d0ab6450fd888aa  openswan-libreswan-backport-949437-atodn.patch
6dcfd099ed2cf90231c36ba305e46348  openswan-libreswan-backport-949437-do_3des.patch
578f171370c373e3501b85de7efc3045  openswan-libreswan-backport-949437-do_aes.patch
730a94960fe593f12b8d1f4ff9266d2a  openswan-libreswan-backport-949437-x509dn.patch
f019d1fa23627d54462054fedc9de03b  ipsec.initd
fd3cd27f9da9140fabd935377c3d6921  setup.patch"
sha256sums="bdd3ccf31df1f3e8530887986ea8b6702a3db139486738213f5de8d8690b3723  openswan-2.6.38.tar.gz
8595019c0ae7e1d00579c8d4ca2ba81b68e3be7b99f099b24e6ea1fd35b2bd7d  openswan-libreswan-backport-949437-atodn.patch
84a5e1c309ff707504a8b2f8ef47865adf6e3d9f0c60f3d1a19c5a8464bdfefb  openswan-libreswan-backport-949437-do_3des.patch
c36316a70d29553995cf89f7b4b2abcf0e05f1e35d725913cae6bfe161bb81a9  openswan-libreswan-backport-949437-do_aes.patch
2390ab47cf5763c832dd9d652ff8ff6766547067502e1719031bac23b977d34a  openswan-libreswan-backport-949437-x509dn.patch
02fd160fb8d64f93a094c9f8a0912ed9cb47789601647f4a72ba3f736b220290  ipsec.initd
6425c491cf1dc366e03e832a1d78bb2846f172ba6fe658b122707157099f9576  setup.patch"
sha512sums="0963a9df548c901eb562185f97d844f57539668f11fbe2a43712223773053895c761b1d5d0be4fffa64014baf58ff2d7cf23676a3da51c5a5134b0639796ad10  openswan-2.6.38.tar.gz
c670392e2e9968f0c9269c50858d24b5dc71126c3e066cbca9ceda53b16ad6fe892d4b32a58054a9cdfa14a81553a219098847b8c79ead00b6b8d05dbd18731d  openswan-libreswan-backport-949437-atodn.patch
14e466379a90c01f26997921c7e4967dfc76de1f58f7370e9755e04e1e351b8a7d8fad8b14af3f4a73d3358cc5271e4a89313aad239f12e92ab596c9d7dd0b02  openswan-libreswan-backport-949437-do_3des.patch
3204d412bbd194ab49a6a5d465cbe38c0bc33266d096bc6bcc0cb6d4214fc05505eef0694036f40da4d2b56f9b50950cfe9816f1e4540431b49d859f7fb7e690  openswan-libreswan-backport-949437-do_aes.patch
05c4a026b8baa91766717a58308cee0415403b1dc0632d805e36da906ec22b91c95b92ee701ca2b6d248f641f124d4ab32ed4fe7f42127aa6e3e308bf170ced3  openswan-libreswan-backport-949437-x509dn.patch
7aefcc624b0e2a50e26f84db6197278c0633eeb38b064c613fbd635cbe606acd1e1280213db7c19f882d809d7eb6ea59a0c47e1b47dfe43de4f1c6deb08d38c4  ipsec.initd
92152006ef3765c89d28462743bca25ab139c0205187bfb0a2c5992159e390939dc3f5f95c7ccb135d3ad674a756d776b7a7d7db903fd22994cf24478b7a71c8  setup.patch"
