# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gst-plugins-ugly1
pkgver=1.8.3
pkgrel=0
pkgdesc="GStreamer Multimedia Framework Ugly Plugins (gst-plugins-ugly)"
url="http://gstreamer.freedesktop.org/"
arch="all"
license="LGPL"
depends=
makedepends="
	a52dec-dev
	glib-dev
	gst-plugins-base1-dev
	gstreamer1-dev
	lame-dev
	libcdio-dev
	libdvdread-dev
	libid3tag-dev
	libmad-dev
	libmpeg2-dev
	liboil-dev
	orc-dev
	x264-dev
	"
source="http://gstreamer.freedesktop.org/src/gst-plugins-ugly/gst-plugins-ugly-$pkgver.tar.xz
	CVE-2017-5846.patch
	CVE-2017-5847.patch
	"
subpackages="$pkgname-lang"
ldpath="/usr/lib/gstreamer-1.0"
builddir="$srcdir"/gst-plugins-ugly-$pkgver

# secfixes:
#   1.8.3-r0:
#   - CVE-2017-5846
#   - CVE-2017-5847

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-static \
		--enable-experimental \
		--disable-fatal-warnings \
		--with-package-name="GStreamer Ugly Plugins (Alpine Linux)" \
		--with-package-origin="http://alpinelinux.org/" \
		|| return 1
	make
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install || return 1
}
md5sums="4fc66c77253b0ad5ce224bda654b2e7d  gst-plugins-ugly-1.8.3.tar.xz
f138fb180ca52836873a62f042c2624e  CVE-2017-5846.patch
ee218582262b27c48444ac410b457df1  CVE-2017-5847.patch"
sha256sums="6fa2599fdd072d31fbaf50c34af406e2be944a010b1f4eab67a5fe32a0310693  gst-plugins-ugly-1.8.3.tar.xz
9bb90e54d0d8faf1bcc6e7911255466b62b3ac01d72826bd04ac6367cdf710dc  CVE-2017-5846.patch
52137d24ebc8acfc5696f093a8f33d6d647bbe6a5501e625ba011deb92e87ce6  CVE-2017-5847.patch"
sha512sums="b4297cbcb553997fbad47a39ad75f655e725629468c71b5af4b30d40309aa0924bd2bf790686db766f6eaacaf69850d1cebf88106dd2b3c24b65a511e54eb484  gst-plugins-ugly-1.8.3.tar.xz
96ceb02d51425adf50b8f0db766f66d63ac95fef647b2c48ccbb554f25826cdeed7951fa2178b487bd76e042ce2514b87f3d78fbd81d7af67468102bb49646a2  CVE-2017-5846.patch
96e700167e6a0753d95b940f8a752e4d329161ac89bac0d0dadc3e0f3a4b67565906598cd9f51d2402f9a96be0ea5d3d3a0b3f718034a6bc6690d9866f944c82  CVE-2017-5847.patch"
