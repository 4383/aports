# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=ipsec-tools
pkgver=0.8_alpha20090422
_myver=0.8-alpha20090422
pkgrel=0
pkgdesc="User-space IPsec tools for various IPsec implementations"
url="http://ipsec-tools.sourceforge.net/"
license="BSD"
depends="openssl uclibc"
makedepends="openssl-dev bison flex"
subpackages="$pkgname-doc $pkgname-dev"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$_myver.tar.gz
	racoon.initd
	racoon.confd
	00-verify-cert-leak.patch
	20-natoa-fix.patch
	30-natt-ports-cleanup.patch
	40-cmpsaddr-cleanup.patch
	50-reverse-connect.patch
	60-debug-quick.patch
	"

build() {
	cd "$srcdir/$pkgname-$_myver"
	for i in ../*.patch; do
		msg "Applying $i..."
		patch -p1 -i $i || return 1
	done
	sed -i 's:-Werror::g' configure

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var/lib \
		--with-kernel-headers=/usr/include \
		--disable-security-context \
		--enable-adminport \
		--enable-dpd \
		--enable-frag \
		--enable-hybrid \
		--enable-ipv6 \
		--enable-natt
	make || return 1
	make DESTDIR="$pkgdir" install
	
	install -D -m755 ../racoon.initd "$pkgdir"/etc/init.d/racoon
	install -D -m644 ../racoon.confd "$pkgdir"/etc/conf.d/racoon
}

md5sums="8327401b5d1aa91e9c554d2cc536f823  ipsec-tools-0.8-alpha20090422.tar.gz
16d66458442750e6401fa459e93172b7  racoon.initd
788e3de82c1c6532dab0dc0c19c1bf40  racoon.confd
e0abf570c29519e8e36406dfc3bbe3c8  00-verify-cert-leak.patch
2adb8796c75f62811b08c8370c75312c  20-natoa-fix.patch
17b3f05426537afa1e94947c39b10163  30-natt-ports-cleanup.patch
5fcaf5a01340132d4bfe55997bc5c60b  40-cmpsaddr-cleanup.patch
91eb6da2726c4ed83df990f6908a7553  50-reverse-connect.patch
baa13d7f0f48955c792f7fcd42a8587a  60-debug-quick.patch"
