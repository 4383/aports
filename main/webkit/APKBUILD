# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=webkit
pkgver=1.2.4
pkgrel=1
pkgdesc="portable web rendering engine WebKit for GTK+"
url="http://webkitgtk.org/"
license="LGPL BSD"
depends=
makedepends="
	libsoup-dev pango-dev gtk+-dev jpeg-dev libpng-dev libxml2-dev
	gperf pkgconfig bison flex icu-dev cairo-dev atk-dev
	gnutls-dev sqlite-dev libxslt-dev libxt-dev libiconv-dev gettext-dev
	zlib-dev libgcrypt-dev libgpg-error-dev expat-dev e2fsprogs-dev
	enchant-dev libxi-dev libxrandr-dev libxcursor-dev libxdamage-dev
	libxcomposite-dev gstreamer-dev gst-plugins-base-dev
	"
install=
subpackages="$pkgname-dev gtklauncher"
source="http://webkitgtk.org/$pkgname-$pkgver.tar.gz
	cve-2010-2646.patch
	cve-2010-2651.patch
	cve-2010-2900.patch
	cve-2010-2901.patch
	cve-2010-3115.patch
	cve-2010-3116.patch
	cve-2010-3120.patch
	"

depends_dev="gtk+-dev libsoup-dev gstreamer-dev"
_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case "$i" in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install
}

gtklauncher() {
	pkgdesc="Application to test WebKit"
	depends=""
	install=
	install -Dm755 "$srcdir"/$pkgname-$pkgver/Programs/GtkLauncher \
		"$subpkgdir"/usr/bin/GtkLauncher
}

md5sums="dc3a92dd0e8c2e70263fbfdf809b51a5  webkit-1.2.4.tar.gz
3d2c4af2fa46388876de7a5747f50de0  cve-2010-2646.patch
4db553a178f951b857486bcc0955b663  cve-2010-2651.patch
abfec5aeaa5005279993d731dc919680  cve-2010-2900.patch
fa980cb721e6a2b43107633dc3782d62  cve-2010-2901.patch
fc5553d85c14f29128985bddc195782c  cve-2010-3115.patch
b4787ffaac3f102e7bb267839a261496  cve-2010-3116.patch
b3e21cb4755c6cbab31dbe5063883c04  cve-2010-3120.patch"
