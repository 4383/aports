# Contributor: William Pitcock <nenolod@dereferenced.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lxc
pkgver=0.8.0
_mypkgver=${pkgver/_rc/-rc}
pkgrel=7
pkgdesc="linux containers - tools"
url="http://lxc.sourceforge.net/"
arch="all"
license="GPL"
depends="bash"
depends_dev="libcap-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="http://lxc.sourceforge.net/download/lxc/$pkgname-$_mypkgver.tar.gz
	bb-rm.patch
	0001-lxc-start-add-option-p-pidfile-FILE-for-use-with-dae.patch
	bb-shutdown.patch
	bb-find.patch
	lxc.initd
	setup-lxc-template
	setup-lxc-guest
	lxc-alpine
	"

_builddir="${srcdir}/${pkgname}-${_mypkgver}"
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-apparmor \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -d "$pkgdir"/var/lib/lxc
	install -Dm755 "$srcdir"/lxc-alpine \
		"$pkgdir"/usr/share/lxc/templates/lxc-alpine || return 1
	install -Dm755 "$srcdir"/lxc.initd "$pkgdir"/etc/init.d/lxc
	install -Dm755 "$srcdir"/setup-lxc-template \
		"$pkgdir"/usr/bin/setup-lxc-template
	install -Dm755 "$srcdir"/setup-lxc-guest "$pkgdir"/usr/bin/setup-lxc-guest
}

md5sums="7304fa57146ce687f749b5df876bb20d  lxc-0.8.0.tar.gz
f0f675456a1751aded10aa428bda9e16  bb-rm.patch
1bf081cd9d66c65f3611ed4af58ef48f  0001-lxc-start-add-option-p-pidfile-FILE-for-use-with-dae.patch
c3f11f58e97ead80c855c88d6999ad65  bb-shutdown.patch
6a1a27c473274d422ec27364bd3580c3  bb-find.patch
f3c6998798b13425b8d0647bad0834a8  lxc.initd
45d0f604310e58a1359f1745a4739843  setup-lxc-template
c3f7fd7e85d40c4a4b1b427048ff9652  setup-lxc-guest
0bafb693507f965c21f78f28da13f27b  lxc-alpine"
sha256sums="eac833730b94e423d4bef6834bc4a716437d2abd6ab8b24334c506aaaa08692c  lxc-0.8.0.tar.gz
e25b074eb09fdb471a2a816ab88df2f247f61ae8208a42044eaf91d1d5cc2fcc  bb-rm.patch
0c3d8b40db692993b5d20dc9e6d6174579af8a2304e8f895bc5bce94eab4d6df  0001-lxc-start-add-option-p-pidfile-FILE-for-use-with-dae.patch
4847e4395a72737a6f94d2a1d835e246a7fb6925a961fa82022dd62358b34ecb  bb-shutdown.patch
d4434b6c36578bffe24d477896a2d4b284c57b9b67214a3cd826d6af2f5d1e53  bb-find.patch
77c64e6137457be89c150b82d681a3eb5c7c1f06af142a321703fc9a43bff200  lxc.initd
e027a75881d720f705c5b844b80b815de0db78df9deafde36dedb1e079d6387a  setup-lxc-template
7a2aa24263efd925f90f4e7c3277f9f195465f121ff9557ae0c3408a5f95b328  setup-lxc-guest
5993758b7723000368ee6987d3c6bfee28920667d860350d3db3ed90117370a4  lxc-alpine"
sha512sums="47333e2010d0f4488b8876ba933f2d26304874bec0371a7ab3b6e5bd1a50a7d2312ff8507e273f1ee2341a7f2e3b79cd71e5e19ac31006a4e429ee96b01733f6  lxc-0.8.0.tar.gz
fd6c34a8775832b42e4b0a9f1e294a1bb54ecc6117277f8f02c1a24e4fc956480fe652aa889d0edf7d50fc1f36db3b7bca21d87a0365ab7b8763a20b0879806c  bb-rm.patch
f097d17eb306c25790fb4acfe48e3af86cca40c9250a94cbe5012321d0f07019fc5af0b31443352d0d458c9bfef7e05707263b381911a97285eeab49098176f0  0001-lxc-start-add-option-p-pidfile-FILE-for-use-with-dae.patch
bfd6aa6c02396115dd603f1ec93aae0cd8378e9d249adfa5ac543448f94f05452df00ef749ffc2264c2f6c16b4b32a9cfb3d5de67b70c364d641159261b7dd7f  bb-shutdown.patch
b011d16a19cf3efd64aaf8f9ecba8f78320d8a57bb8fbb28d2a1787a2936b30b5d21d5c1581cd6a98422d2a0666788f7228d4fa285c3dcbfac0de739718f016f  bb-find.patch
4e56f7b869345f936df54c4359abdd3b8d0244c0fd71a9a787bc2393c4caabca22ca8417f16da47f02c86294750986fd674d0d2e7c1b1d096076873b22c07a29  lxc.initd
d9c4d20cc4e07b7bf53361c7ea51043c578faef09a8ed588e77362ce2f7d531348300a190d22f3787f41ed8bea24d1734c00a5a7143791a49451dde88b06d51b  setup-lxc-template
a3fa846878f9fb897a607a20ae6847c067dc651eaf8c3d8a75ecee1057638226591825723c7fe7ad38a6647c158b870101d72c660e8bebedbdc1fa95a1c5cf5c  setup-lxc-guest
304721a7b720a41be1884c9f96f881ff9ccc07737c45a2e2b3a3ec5fcd5f991109911051ca021d60b697f31f0da8ef23a83d6c1233f3ad292a1b0b257c864197  lxc-alpine"
