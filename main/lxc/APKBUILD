# Contributor: William Pitcock <nenolod@dereferenced.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lxc
pkgver=0.9.0
_mypkgver=${pkgver/_rc/-rc}
pkgrel=3
pkgdesc="linux containers - tools"
url="http://lxc.sourceforge.net/"
arch="all"
license="GPL"
depends="bash"
depends_dev="libcap-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="http://lxc.sourceforge.net/download/lxc/$pkgname-$_mypkgver.tar.gz
	bb-rm.patch
	bb-shutdown.patch
	alpine-template-backport.patch
	0001-lxc-alpine-create-dev-zero.patch
	0002-lxc-alpine-add-arm.patch
	lxc-fix-headers.patch
	lxc.initd
	"

_builddir="${srcdir}/${pkgname}-${_mypkgver}"
prepare() {
	local i
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	[ "$CLIBC" = musl ] && export CFLAGS="$CFLAGS -Dutmpxname=utmpname"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-apparmor \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -d "$pkgdir"/var/lib/lxc
	install -Dm755 "$srcdir"/lxc.initd "$pkgdir"/etc/init.d/lxc
}

md5sums="8552a4479090616f4bc04d8473765fc9  lxc-0.9.0.tar.gz
a0894c2ddf9133c3cc33c264e4596a3c  bb-rm.patch
e96514860ee34b62d1b208ab03c569bc  bb-shutdown.patch
25dd200bd158d16a05bb3e7aaef84697  alpine-template-backport.patch
e08b77b3b35adac290b49b9c9e04754c  0001-lxc-alpine-create-dev-zero.patch
181c01649399b2c2dbadab9713381358  0002-lxc-alpine-add-arm.patch
bcd59a1ca21bf83cb902b7ebe6cbced5  lxc-fix-headers.patch
f3c6998798b13425b8d0647bad0834a8  lxc.initd"
sha256sums="1e1767eae6cc5fbf892c0e193d25da420ba19f2db203716c38f7cdea3b654120  lxc-0.9.0.tar.gz
c9caea06b87baf5e335821c7e9ce3caca849b33f8176fbd48126c605583e78fc  bb-rm.patch
0e5706cb077f750afdd6a5a4fd2afdf0b9113126c85e130d92680bed4ce9c20e  bb-shutdown.patch
df193c4cf08e171c23b0b472750b7b1e0e7a66971c03201a0523e4039909f33b  alpine-template-backport.patch
8b3b314d99209ae27d78cd4e9469638a945d68d03beefaec499bad373a7cb8cd  0001-lxc-alpine-create-dev-zero.patch
415e28eae4d0611c899509835c70e82a06b2bae0b8f380b40de6eb0b5a039684  0002-lxc-alpine-add-arm.patch
9e51ceb970e83b300f7dc6cded724f88da54a5ceb6ed71171144151bc9ac5138  lxc-fix-headers.patch
77c64e6137457be89c150b82d681a3eb5c7c1f06af142a321703fc9a43bff200  lxc.initd"
sha512sums="a96133660ca6ea45dc4b8d167267120328577339e933ff9510f03e9d368ca5db77031dc1e7e4529b3e506f63f79c2ce3f8f72571a7dfdbeb2a8799777782a606  lxc-0.9.0.tar.gz
b8fe47af6b1341ca472b6337c304f52402c53d400fc1d13895f2f568dd4d81b9ff281efc70bc1ddc221ac457db3bed4a199491059a15f66755deddc93ce91bf1  bb-rm.patch
86df52e380a01d6d3f588ca395925e8f774529c72e5b4c8dcb701d79fad7697ed8800f0ff51fded2896b2d2af49faa7f26960234fc8c1a6b4bc8f42d85078e6d  bb-shutdown.patch
d10e25aeee0aba61a4c3420fe1b2bfd9213e7ef10f399ed5f0ba5d978a97a49fd23044b098f73f6d9651c23b1bb025f30d81deb6aec9edf4d2267afc22a09d60  alpine-template-backport.patch
0304aabfac3280cbc18347f1168b2289a98e03b9f6a3134770e43bb914978a64a108a0b0ec709856db161e98366c06c8a65d5a30e730add4cee2968718cdc93a  0001-lxc-alpine-create-dev-zero.patch
d1860b5a47303762ec82d65c2f2c6feaac0115aeb2ddaaf6c052085e9b8dc1d8f6bd05af1c8596c7c978391af75cbe97b38f98f37dd036d61bd9cea9b81226dd  0002-lxc-alpine-add-arm.patch
9f33cd349cca920221b73c07714607e15cd3c4a873ce44600d745c42df1214000448776244c787d14127c4e05645ad8d33dd4d4604193a9e41ec6655f0da1f9e  lxc-fix-headers.patch
4e56f7b869345f936df54c4359abdd3b8d0244c0fd71a9a787bc2393c4caabca22ca8417f16da47f02c86294750986fd674d0d2e7c1b1d096076873b22c07a29  lxc.initd"
