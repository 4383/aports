# Contributor: William Pitcock <nenolod@dereferenced.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=lxc
pkgver=0.9.0
_mypkgver=${pkgver/_rc/-rc}
pkgrel=3
pkgdesc="linux containers - tools"
url="http://lxc.sourceforge.net/"
arch="all"
license="GPL"
depends="bash"
depends_dev="libcap-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="http://lxc.sourceforge.net/download/lxc/$pkgname-$_mypkgver.tar.gz
	bb-rm.patch
	bb-shutdown.patch
	alpine-template-backport.patch
	0001-lxc-alpine-create-dev-zero.patch
	lxc.initd
	"

_builddir="${srcdir}/${pkgname}-${_mypkgver}"
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-apparmor \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -d "$pkgdir"/var/lib/lxc
	install -Dm755 "$srcdir"/lxc.initd "$pkgdir"/etc/init.d/lxc
}

md5sums="8552a4479090616f4bc04d8473765fc9  lxc-0.9.0.tar.gz
a0894c2ddf9133c3cc33c264e4596a3c  bb-rm.patch
e96514860ee34b62d1b208ab03c569bc  bb-shutdown.patch
25dd200bd158d16a05bb3e7aaef84697  alpine-template-backport.patch
e08b77b3b35adac290b49b9c9e04754c  0001-lxc-alpine-create-dev-zero.patch
4d248c3d47317d7f770963f07fcc1473  lxc.initd"
sha256sums="1e1767eae6cc5fbf892c0e193d25da420ba19f2db203716c38f7cdea3b654120  lxc-0.9.0.tar.gz
c9caea06b87baf5e335821c7e9ce3caca849b33f8176fbd48126c605583e78fc  bb-rm.patch
0e5706cb077f750afdd6a5a4fd2afdf0b9113126c85e130d92680bed4ce9c20e  bb-shutdown.patch
df193c4cf08e171c23b0b472750b7b1e0e7a66971c03201a0523e4039909f33b  alpine-template-backport.patch
8b3b314d99209ae27d78cd4e9469638a945d68d03beefaec499bad373a7cb8cd  0001-lxc-alpine-create-dev-zero.patch
ec036b358ead871b03709cc9d3ebecafcc722be19808d4225029b7bd386726dd  lxc.initd"
sha512sums="a96133660ca6ea45dc4b8d167267120328577339e933ff9510f03e9d368ca5db77031dc1e7e4529b3e506f63f79c2ce3f8f72571a7dfdbeb2a8799777782a606  lxc-0.9.0.tar.gz
b8fe47af6b1341ca472b6337c304f52402c53d400fc1d13895f2f568dd4d81b9ff281efc70bc1ddc221ac457db3bed4a199491059a15f66755deddc93ce91bf1  bb-rm.patch
86df52e380a01d6d3f588ca395925e8f774529c72e5b4c8dcb701d79fad7697ed8800f0ff51fded2896b2d2af49faa7f26960234fc8c1a6b4bc8f42d85078e6d  bb-shutdown.patch
d10e25aeee0aba61a4c3420fe1b2bfd9213e7ef10f399ed5f0ba5d978a97a49fd23044b098f73f6d9651c23b1bb025f30d81deb6aec9edf4d2267afc22a09d60  alpine-template-backport.patch
0304aabfac3280cbc18347f1168b2289a98e03b9f6a3134770e43bb914978a64a108a0b0ec709856db161e98366c06c8a65d5a30e730add4cee2968718cdc93a  0001-lxc-alpine-create-dev-zero.patch
4712cf4f20c0fb6040a806fc7996f19953e96c56d90c43a1f4af2f9a5be8c7a76b16872fa6dad63d20152795413b73d8492d614f15e20ea3d6760fbbd6855e0f  lxc.initd"
