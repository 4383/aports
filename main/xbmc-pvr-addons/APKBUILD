# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=xbmc-pvr-addons
pkgver=13.0
_realver=$pkgver-Gotham
pkgrel=0
pkgdesc="XBMC PVR add-ons"
url="https://github.com/opdenkamp/xbmc-pvr-addons"
arch="all"
license="GPL"
depends="$pkgname-hts $pkgname-argustv $pkgname-demo $pkgname-dvbviewer
	 $pkgname-hts $pkgname-mediaportal $pkgname-nextpvr $pkgname-njoy
	 $pkgname-vdr $pkgname-vuplus $pkgname-mythtv"
depends_dev="mysql-dev boost-dev"
makedepends="$depends_dev autoconf automake libtool"
install=""
subpackages="$pkgname-argustv:argustv $pkgname-demo:demo 
	$pkgname-dvbviewer:dvbviewer $pkgname-hts:hts $pkgname-mythtv:mythtv 
	$pkgname-mediaportal:mediaportal $pkgname-nextpvr:nextpvr 
	$pkgname-njoy:njoy $pkgname-vdr:vdr $pkgname-vuplus:vuplus"
source="saveas-https://github.com/opdenkamp/xbmc-pvr-addons/archive/$_realver.tar.gz/$pkgname-$pkgver.tar.gz"
_builddir="$srcdir/$pkgname-$_realver"

prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./bootstrap || return 1
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--enable-addons-with-dependencies \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm -f "$pkgdir"/usr/lib/*.la
}

_mv_addon() {
        local ext=$1
        pkgdesc="${ext} addon for XBMC"
	depends=
        mkdir -p "$subpkgdir"/usr/lib/xbmc/addons \
		"$subpkgdir"/usr/share/xbmc/addons
        mv "$pkgdir"/usr/lib/xbmc/addons/$ext \
		"$subpkgdir"/usr/lib/xbmc/addons
	mv "$pkgdir"/usr/share/xbmc/addons/$ext \
		"$subpkgdir"/usr/share/xbmc/addons
}

argustv()	{ _mv_addon pvr.argustv; }
demo()		{ _mv_addon pvr.demo; }
dvbviewer()	{ _mv_addon pvr.dvbviewer; }
hts()		{ _mv_addon pvr.hts; }
mediaportal()	{ _mv_addon pvr.mediaportal.tvserver; }
nextpvr()	{ _mv_addon pvr.nextpvr; }
njoy()		{ _mv_addon pvr.njoy; }
vdr()		{ _mv_addon pvr.vdr.vnsi; }
vuplus()	{ _mv_addon pvr.vuplus; }
mythtv()	{ _mv_addon pvr.mythtv.cmyth; }

md5sums="63f5863393ca869eb6f357a62de76378  xbmc-pvr-addons-13.0.tar.gz"
sha256sums="6b671777debc69a3e7b63cade91b06df810eb9729941fad43a5d8ee1bf69ea85  xbmc-pvr-addons-13.0.tar.gz"
sha512sums="bac0f9e6aea491842654b29bfb3903c9ff0d3a3f19a10c32f6abb77791066ffbcd2704221dda2ab5c4d5288df0bf9e1555ef36329189e0b985e65a39bc2f6e37  xbmc-pvr-addons-13.0.tar.gz"
