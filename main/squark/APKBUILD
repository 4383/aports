# Maintainer: Timo Teras <timo.teras@iki.fi>
pkgname=squark
pkgver=0.5
pkgrel=1
pkgdesc="Squark - Squid User Authentication and Rating Kit"
subpackages=
depends="haserl"
makedepends="net-snmp-dev cmph-dev lua-dev pkgconfig"
source="http://dev.alpinelinux.org/archive/$pkgname/$pkgname-$pkgver.tar.bz2
	0001-auth-snmp-use-ifIndex-as-ifName-if-that-MIB-entry-is.patch
	0002-all-fix-includes-for-strict-compliance.patch
	"
url="http://git.alpinelinux.org/cgit/squark/"
arch="all"
license=GPL-2
install="$pkgname.post-install"

prepare() {
	cd "$srcdir"
	ln -s squark-master $pkgname-$pkgver
	cd "$srcdir/$pkgname-$pkgver"
	sed -i -e 's:-Werror::' Make.rules
	for i in $source; do
		case $i in
		*.patch) patch -p1 -i "$srcdir"/$i || return 1
		esac
	done
	sed -i -e 's:lua5.1:lua:g' "$srcdir"/"$pkgname-$pkgver"/src/Makefile
}

build() {
	cd "$srcdir/$pkgname-$pkgver"
	make FULL_VERSION="$pkgver-r$pkgrel" || return 1
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make FULL_VERSION="$pkgver-r$pkgrel" DESTDIR="$pkgdir" install
}

md5sums="da9ff8ceaa277781dcebd8d3c0e886d1  squark-0.5.tar.bz2
badc55a43f2eee9b7b02083bc6879f51  0001-auth-snmp-use-ifIndex-as-ifName-if-that-MIB-entry-is.patch
2b6c8d5d8136fa8450c4fbb95936c3d7  0002-all-fix-includes-for-strict-compliance.patch"
sha256sums="327b6578ace9629cefce3f67489b030ac33efb66b813087b3d7a451917df09ec  squark-0.5.tar.bz2
1c6733e2d0afed808a2ed89de35c2ac203b42b720ff8bc6208cf4e329aa01d64  0001-auth-snmp-use-ifIndex-as-ifName-if-that-MIB-entry-is.patch
323b34c54f30b31e16b51ea6de7488aca42397ea3336db0bc0dfc1cc256bd34d  0002-all-fix-includes-for-strict-compliance.patch"
sha512sums="772696730612fc67ca63dd8c843a3596e37f2f0a02df1a3e0bf2156987bb728ae6213efc7ab556d7cb8c9d9fe83cd75bfe45aa09b4ffde2cefc20f54ba509819  squark-0.5.tar.bz2
ccb1f3d742f2ed4452c435e5f543570ba43becbbc22ba8d6d78d006774b8e2115bdbb3461dcaf9376efda4f5223c012b43c02e439ffdd3d9398ed3fba085f62b  0001-auth-snmp-use-ifIndex-as-ifName-if-that-MIB-entry-is.patch
046d38073cbd1ece2c2464c3f3861d040ceabd82849aff4efa0c3f18ac8ed5159e0bb2b772d9fb373e6141f9fdcd06888a89729d14254752ecf0aec1d564fb3f  0002-all-fix-includes-for-strict-compliance.patch"
