# Maintainer: Timo Teras <timo.teras@iki.fi>
pkgname=squark
pkgver=0.5
pkgrel=0
pkgdesc="Squark - Squid User Authentication and Rating Kit"
subpackages=
depends="haserl"
makedepends="net-snmp-dev cmph-dev lua-dev pkgconfig"
source="http://dev.alpinelinux.org/archive/$pkgname/$pkgname-$pkgver.tar.bz2
	"
url="http://git.alpinelinux.org/cgit/squark/"
arch="all"
license=GPL-2
install="$pkgname.post-install"

prepare() {
	cd "$srcdir"
	ln -s squark-master $pkgname-$pkgver
	cd "$srcdir/$pkgname-$pkgver"
	sed -i -e 's:-Werror::' Make.rules
	for i in $source; do
		case $i in
		*.patch) patch -p1 -i "$srcdir"/$i || return 1
		esac
	done
	sed -i -e 's:lua5.1:lua:g' "$srcdir"/"$pkgname-$pkgver"/src/Makefile
}

build() {
	cd "$srcdir/$pkgname-$pkgver"
	make FULL_VERSION="$pkgver-r$pkgrel" || return 1
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make FULL_VERSION="$pkgver-r$pkgrel" DESTDIR="$pkgdir" install
}

md5sums="5658521133cbb3351d9caf8552edf78c  squark-0.5.tar.bz2"
sha256sums="58dbb0b902a1ebbd7fd2f6479f9a1d0dbfdd3a70c0847676b3697fc9e745348e  squark-0.5.tar.bz2"
sha512sums="7473ee5c27b9a3dbdfdfd8a1833b81cc3b57ea7ddaf953fe55ee752caeff01789f0615f515dee23b5ea134a60dc816e6a0d7de3fc0f73a24651d030ec5375b19  squark-0.5.tar.bz2"
