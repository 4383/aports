# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxslt
pkgver=1.1.29
pkgrel=1
pkgdesc="XML stylesheet transformation library"
url="http://xmlsoft.org/XSLT/"
arch="all"
license="custom"
depends=
makedepends="libxml2-dev libgcrypt-dev libgpg-error-dev python-dev"
subpackages="$pkgname-dev $pkgname-doc py-$pkgname:py"
source="ftp://xmlsoft.org/$pkgname/$pkgname-$pkgver.tar.gz
	CVE-2017-5029.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver

# secfixes:
#   1.1.29-r1:
#   - CVE-2017-5029

prepare() {
	cd "$_builddir"
	#update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	find "$pkgdir"/usr -name '*.la' -delete

	install -D -m644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}

py() {
	pkgdesc="$pkgname python bindings"
	install -d "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/python* "$subpkgdir"/usr/lib/
}
md5sums="a129d3c44c022de3b9dcf6d6f288d72e  libxslt-1.1.29.tar.gz
db2ca974d0391f74b3c02550056fc588  CVE-2017-5029.patch"
sha256sums="b5976e3857837e7617b29f2249ebb5eeac34e249208d31f1fbf7a6ba7a4090ce  libxslt-1.1.29.tar.gz
ef18ec8c31d73e1eb57ab7fd14a4f085fc9962dd9beec8c053c02e3204f97004  CVE-2017-5029.patch"
sha512sums="a1ce555a74a9dabe65e8f64bb66e27e77760fd76940d88f2d59f58dd63ca73c8ae59f3fcbd8e76c8f92ff992fb0c09328528c20ea38ccac83e63252106bf5f31  libxslt-1.1.29.tar.gz
586182c5cabf86605bc628c98fcc18ee7120c5917dab25e2f4c013660ccda34f44f4b6c46a7d7473baaa1c208e306c5b4012cc95770e1be88c7aec9121880aa7  CVE-2017-5029.patch"
