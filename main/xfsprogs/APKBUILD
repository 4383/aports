# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=xfsprogs
pkgver=3.1.11
pkgrel=1
pkgdesc="XFS filesystem utilities"
url="http://oss.sgi.com/projects/xfs/"
arch="all"
license="LGPL"
depends="e2fsprogs"
makedepends="e2fsprogs-dev bash"
subpackages="$pkgname-dev $pkgname-doc"
source="ftp://oss.sgi.com/projects/xfs/cmd_tars/${pkgname}-$pkgver.tar.gz
	musl-fixes.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	update_config_sub || return 1
	sed -i -e 's/--best//' Makefile doc/Makefile
}
	
build() {
	cd "$_builddir"
	export DEBUG=-DNDEBUG
	export OPTIMIZER="$CFLAGS"
	export INSTALL_USER=root
	export INSTALL_GROUP=root

	ac_cv_header_aio_h=yes ac_cv_lib_rt_lio_listio=yes \
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sbindir=/sbin \
		--libexecdir=/usr/lib \
		--enable-lib64=no \
		--enable-gettext=no \
		|| return 1

	make SHELL=/bin/bash || return 1
}

package() {
	cd "$_builddir"
	make -j1 DIST_ROOT="$pkgdir" install install-dev install-qa || return 1
	rm "$pkgdir"/usr/lib/*.la "$pkgdir"/lib/*.la
}
md5sums="de9f1f45026c2f4e0776058d429ff4b6  xfsprogs-3.1.11.tar.gz
534a85a3afc1afd328975222ce43f4b7  musl-fixes.patch"
sha256sums="adf4980177b5c890c1ca86b9c0e3e4d69a3f95bfc01746844280c2393cf4d6be  xfsprogs-3.1.11.tar.gz
b6488dfd3f419cdbcb7d259be1038df51ebff2799774bf643f9d7838ddc4c742  musl-fixes.patch"
sha512sums="6de16f0904709e53e6ceea8239e23b7e109375733fd712fd97bfbbf74ec7f1376147e61d1fbe498f1d5be2148bf8ca233c0577d5b88e9201bfd4bb87e696c28a  xfsprogs-3.1.11.tar.gz
1cb52686cb2aa9b515feaa08f0b0e44decde7a5a61a3102a4c2ec9d7a3c9f1601c53308be039f717b8e999997b8222e76728bf45053330d3f820bfc040576074  musl-fixes.patch"
