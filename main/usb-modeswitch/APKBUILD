# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=usb-modeswitch
pkgver=1.2.6
pkgrel=0
_pkgdata=20120815
pkgdesc="A mode switching tool for controlling flip flop (multiple device) USB gear"
url="http://www.draisberghof.de/usb_modeswitch/"
arch="all"
license="GPL"
depends="tcl"
makedepends="libusb-compat-dev coreutils"
install=
subpackages="$pkgname-doc"
source="http://www.draisberghof.de/usb_modeswitch/${pkgname}-${pkgver}.tar.bz2
	http://www.draisberghof.de/usb_modeswitch/${pkgname}-data-${_pkgdata}.tar.bz2
	usb_modeswitch.setup"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	make clean || return 1
	sed -i -e 's/--mode=/-m/' Makefile || return 1
	
	cd ../${pkgname}-data-${_pkgdata}
#	sed -i -e 's%install -m644 -t $(PREFIX)/share/usb_modeswitch ./usb_modeswitch.d/*%cp -R $(PREFIX)/share/usb_modeswitch/* ./usb_modeswitch.d/%' Makefile || return 1
	sed -i -e 's/--mode=/-m/' Makefile || return 1
}

build() {
	cd "$_builddir"
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install
	# adjusting the tcl script location
	# mv ${pkgdir}/lib/udev/usb_modeswitch/usb_modeswitch.tcl \
	#  ${pkgdir}/lib/udev/usb_modeswitch.tcl || return 1
	# rmdir ${pkgdir}/lib/udev/usb_modeswitch || return 1
        # mv ${pkgdir}/lib/udev/usb_modeswitch.tcl \
	#  ${pkgdir}/lib/udev/usb_modeswitch  || return 1

	# installing data
	cd $srcdir/usb-modeswitch-data-${_pkgdata} || return 1
	make DESTDIR=$pkgdir install || return 1
	# installing config
	cp $srcdir/usb_modeswitch.setup $pkgdir/etc/ || return 1
}

md5sums="3cd804ad2dd4cb61fbd77a5cc033496c  usb-modeswitch-1.2.6.tar.bz2
12d7de3210e45ad6f48791d12bbdbf61  usb-modeswitch-data-20120815.tar.bz2
9a25756669937ac86774bb55733f09cd  usb_modeswitch.setup"
sha256sums="041aa3737de6e900e6cfde769afeff5c5091955a22401919abf29b7f24c6f598  usb-modeswitch-1.2.6.tar.bz2
8819b5dad54f4aa4738ba2420eca1a14739b2d6e42860c8743561de662115f4c  usb-modeswitch-data-20120815.tar.bz2
76c0fd9138a6d4a09d6bcee27feeb144c431aed163d556ef60a9c39352ec7f26  usb_modeswitch.setup"
sha512sums="7b600dbd22e1c1fed665410cecaf5218ad800519f43ddaf34f70dfa027d636135912fc77e03b94c787b4ccd9307de6e063f08816fcbabc5761d1c55d4da0551b  usb-modeswitch-1.2.6.tar.bz2
b667c5615b97fbd60322f564e70075d2a91d28dd6279de2710b41a00cd1310e59627d924b6ef17854803debba430145035fac04ffb4d8301cc49ae04f174da17  usb-modeswitch-data-20120815.tar.bz2
48bc921849c529059c35f00e9cb10e92fee32622d63291bbd7184039bbe4c4324591b4011b24cf9b6c4ed2a7ad90fe0d5287a58631de5114b36f70d4f6f3c250  usb_modeswitch.setup"
