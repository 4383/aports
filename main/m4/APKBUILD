# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=m4
pkgver=1.4.16
pkgrel=2
pkgdesc="GNU macro processor"
url="http://www.gnu.org/software/m4"
depends=
makedepends=texinfo
arch="all"
license="GPL"
subpackages="m4-doc"
source="ftp://ftp.gnu.org/gnu/m4/$pkgname-$pkgver.tar.gz
	http://dev.alpinelinux.org/~tteras/m4-1.4.16-gnulib-update.patch.gz
	"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	msg "Applying m4-1.4.16-gnulib-update.patch"
	gunzip < "$srcdir"/m4-1.4.16-gnulib-update.patch.gz | patch -Z -p1 || return 1
	update_config_sub || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make
}

package() {
	cd "$_builddir"
	make install DESTDIR="$pkgdir"
	rm -rf "$pkgdir"/usr/lib/charset.alias
	rmdir -p "$pkgdir"/usr/lib 2>/dev/null
	return 0
}

md5sums="a5dfb4f2b7370e9d34293d23fd09b280  m4-1.4.16.tar.gz
c22f770441aa5dc30521b93eb76f496d  m4-1.4.16-gnulib-update.patch.gz"
sha256sums="e9176a35bb13a1b08482359aa554ee8072794f58f00e4827bf0e06b570c827da  m4-1.4.16.tar.gz
66dc61cc20891bc3af88de1fe3907a05135686edbd750a570163a0035fb269cc  m4-1.4.16-gnulib-update.patch.gz"
sha512sums="633afe79feabe9764675dcfb79eb91e6ed09a89405bcbefec64afb6f422a269f35905ee3c02bfcbff75b911870926791ef5bdf0c6cf27b5b2b9c9ae55cd70cf6  m4-1.4.16.tar.gz
15b4d9776e0818000ed2ba64c8446b6404d9986d682fbcd5ca08b73fbc59cf0bec2f0441f293a2216d82e49bf934c4043a022a946dfe6665b6f262415f6356cd  m4-1.4.16-gnulib-update.patch.gz"
