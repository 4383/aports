# Contributor: Roger Pau Monne <roger.pau@entel.upc.edu>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=acpica
pkgver=20130517
pkgrel=0
pkgdesc="ACPI Component Architecture utilities"
url="http://www.acpica.org/"
arch="x86 x86_64"
license="custom"
depends=""
depends_dev="flex bison"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-doc iasl"
# license was found here:
# http://acpica.org/downloads/unix_source_code.php
source="https://acpica.org/sites/acpica/files/acpica-unix-$pkgver.tar.gz
	COPYING"

_builddir="$srcdir"/acpica-unix-$pkgver

build() {
	cd "$_builddir"

	# support gcc-4.6
	sed -i -e 's/-Werror//g' \
		-e 's/remove-destination//' \
		generate/unix/Makefile \
		generate/unix/Makefile.config \
		|| return 1
	
	case $CARCH in
		x86_64) _bits=64;;
		x86) _bits=32;;
	esac
	make BITSFLAG=-m$_bits || return 1
}

package() {
	cd "$_builddir"
	make install DESTDIR="$pkgdir"
	install -Dm644 "$srcdir"/COPYING "$pkgdir"/usr/share/licenses/acpica/COPYING
}

iasl() {
	pkgdesc="ACPI ASL compiler"
	mkdir -p "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/iasl "$subpkgdir"/usr/bin/
}


md5sums="7846a62551352d7dae6f93f8255e9d99  acpica-unix-20130517.tar.gz
7af813a48b9d1ce988aa72655f0fa61f  COPYING"
sha256sums="10410ea9f57a1a025635c7a4aadf3cf02880643401bdfad68e65ee291bb4ec98  acpica-unix-20130517.tar.gz
7d265c08321b2cc95e3facf1089b28563a8c2b9a6730a380fc456da988c7c9a6  COPYING"
sha512sums="6b79d5a5ded6d0e299c5193af261da261e37b4937953b2433559e1fdb0c18557c98dc82ef208d61098b77f9e01ca94ca0e92d40ee21808b6f8971a413cf44986  acpica-unix-20130517.tar.gz
7999047808e26bd83696cf11641a2ba99a986d89ac861cc95d79a9849d1ae1aef7eb107b1c472f1e886cf6556a78554ed6cc7af269b1e2671f3445d1a7ced268  COPYING"
