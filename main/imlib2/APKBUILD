# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=imlib2
pkgver=1.4.7
pkgrel=1
pkgdesc="Library that does image file loading and saving as well as rendering, manipulation, arbitrary polygon support"
url="http://sourceforge.net/projects/enlightenment/"
arch="all"
license="BSD"
subpackages="$pkgname-dev $pkgname-doc"
depends=
depends_dev="freetype-dev libxext-dev libsm-dev"
makedepends="$depends_dev tiff-dev giflib-dev bzip2-dev
	libpng-dev libid3tag-dev libjpeg-turbo-dev zlib-dev util-linux-dev"
source="http://downloads.sourceforge.net/enlightenment/$pkgname-$pkgver.tar.bz2
	CVE-2011-5326.patch
	CVE-2016-3994.patch
	CVE-2016-4024.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc/imlib2 \
		--x-libraries=/usr/lib \
		--disable-mmx \
		--disable-amd64 \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR=$pkgdir install || return 1
	rm "$pkgdir"/usr/lib/*.la \
		"$pkgdir"/usr/lib/imlib2/*/*.la || return 1
	install -Dm644 COPYING $pkgdir/usr/share/licenses/$pkgname/COPYING
}
md5sums="f2f1418c376da6125453f90f2d58d938  imlib2-1.4.7.tar.bz2
d7407b9b2559006a9b79fdc9ef66abdd  CVE-2011-5326.patch
6812844a42e7a790d30e0095b608025d  CVE-2016-3994.patch
5b78f464f0fa3a351da7ff7ce15d203f  CVE-2016-4024.patch"
sha256sums="35d733ce23ad7d338cff009095d37e656cb8a7a53717d53793a38320f9924701  imlib2-1.4.7.tar.bz2
90d7d54a79358a3a53fd2ae6265848c158ad53f8d2323ab5ab21fb0b6a390eec  CVE-2011-5326.patch
8c71ef322fcfbfcddc95fceb9f6778ea77673943039d48719cdde05011f9e372  CVE-2016-3994.patch
441b1bdf1e2a65905cd711c60df5a8d44b8bbf9125e21ab8ac1b2141f0aa5cd5  CVE-2016-4024.patch"
sha512sums="3954d6426efbe2fcfb755c74a0ea7c1c61e65c5dc3cbdcea88c9e5de6294de69439ac05c724d83f4703f121d70f6af2f860e2aa423296c30ef99f4bdd2e60db8  imlib2-1.4.7.tar.bz2
ec6cdb810f0d03a133764befd2fced9770ae09bfaa38cdd7ac7c0ac2a07248cfc9a50f3507f248f2dd994686ff8df7c33b1f66353bbec06767d55278dd0c7fae  CVE-2011-5326.patch
d056a47a91a77c129c455f74527db683cf98dd5b7301318ddf139b629ba98c2d55c8471fd53cde6eb87424e5709fe48d7cd7eb9a393d2f00e30b3517810a0989  CVE-2016-3994.patch
af06a82049ea7b5a13da19c550efe264183415040616f36284ece78fd6437f5ac5a287ea3ad7902e289f44ffdd06048bb37b931ebbd6ae80f4633d86c6992c21  CVE-2016-4024.patch"
