# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname="multipath-tools"
pkgver=0.4.9
pkgrel=6
pkgdesc="Device Mapper Multipathing Driver"
url="http://christophe.varoqui.free.fr/"
arch="all"
license="GPL"
depends="udev"
makedepends="lvm2-dev libaio-dev readline-dev ncurses-dev"
install=
subpackages="$pkgname-doc"
source="http://christophe.varoqui.free.fr/$pkgname/$pkgname-$pkgver.tar.bz2
	multipath-tools-0.4.9-build.patch
	multipath-tools-0.4.8-kparted-ext-partitions.patch
	multipath-tools-0.4.9-log_enquery_overflow.patch
	multipath-tools-0.4.9-buffer-overflows.patch
	"

_builddir="$srcdir"

prepare() {
	cd $_builddir
	find . -name Makefile -exec sed -i -e 's/glibc/uclibc/g' {} \;
	for i in ../*.patch
	do
		msg "Applying $i"
		patch -p1 < $i || return 1
	done
}

build() {
	cd $_builddir
	make -j1 prefix="/usr" \
		sysconfdir="/etc" \
		mandir="/usr/share/man" \
		infodir="/usr/share/info" || return 1
}

package() {
	cd $_builddir
	make DESTDIR="$pkgdir" install
	install -D -m644 ../$pkgname.conf $pkgdir/etc/multipath.conf
	install -D -m644 ../$pkgname.confd $pkgdir/etc/conf.d/multipathd
	install -D -m755 ../$pkgname.initd $pkgdir/etc/init.d/multipathd
}

md5sums="a6d4b48afc28f1f50f5ee4b1b06d2765  multipath-tools-0.4.9.tar.bz2
751a7e079fef26cced73e2fc31ad7f11  multipath-tools-0.4.9-build.patch
68ea053e02e9f5c4883b24b3f9bb2bf1  multipath-tools-0.4.8-kparted-ext-partitions.patch
00eae05e02f1b85062e998574ab1b833  multipath-tools-0.4.9-log_enquery_overflow.patch
c5aab36777b0304a3525533cdd31bddc  multipath-tools-0.4.9-buffer-overflows.patch"
sha256sums="8d44c8815144b5589cc3e604cb3fc16c76a028aef08aa1bec334ff70bf9ac712  multipath-tools-0.4.9.tar.bz2
004678610d0468c6d7be7ac5238b1162d41bf0a6e4423932ba503786650e5448  multipath-tools-0.4.9-build.patch
4cd2e75782dbaba715b85ef1ececdc130e24d7497897ceea9802c779e79c1c73  multipath-tools-0.4.8-kparted-ext-partitions.patch
43cedfbfdc1a5636e107bc3d388f0b03185b12761c3abb18424352f516d72b4b  multipath-tools-0.4.9-log_enquery_overflow.patch
1f9ca1d26fee69dc7d5c1b65a835d23e1b8dd8de6fd3678faf3e7b499611d15d  multipath-tools-0.4.9-buffer-overflows.patch"
sha512sums="ff4d74951b4ca6f95deb501876e5edec00b6880c98bd3f24452133c142a4118f186a5988e08151ecf5dc7348568eb434be19c31ee5257c5372997f44003eb540  multipath-tools-0.4.9.tar.bz2
123987a6da27234ab56d3301a22d392a752191a54d16bd78e301bd39dc7d39f777def9d141b3786e29626a1c503763d56d8f6233698ac470f55f9d508009b72b  multipath-tools-0.4.9-build.patch
9cce969e9e1a7816356fa2b624cae5f71b4291cd3383ca462a98bf6b68aa9111f8bb42d3105697746eced52a29ed4fb006957ccbda77d04da31a179715c64ff8  multipath-tools-0.4.8-kparted-ext-partitions.patch
acbdb4fc901acd8473b3dca2d0fe0b622d240c0ae02f4dda16bbb0d847f1fe05a849ec1916df1916e2c5f398cbf21b9c9f1c7b09429f3ee3ca6ea78d6996e1d3  multipath-tools-0.4.9-log_enquery_overflow.patch
5d17c452868d8e01ea171a4e734aeecc837d959d55a17de051ba006f1980d3b8c84f7d0d0db4f22c1c3f741ed074a1377a5ae8d8534f956e16b904ee1ee382aa  multipath-tools-0.4.9-buffer-overflows.patch"
