# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libpng
pkgver=1.5.15
pkgrel=1
pkgdesc="Portable Network Graphics library"
url="http://www.libpng.org/"
arch="all"
license="GPL"
depends=
depends_dev="zlib-dev"
makedepends="$depends_dev gawk"
subpackages="$pkgname-doc $pkgname-dev"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
	http://downloads.sourceforge.net/project/libpng-apng/libpng15/$pkgver/libpng-$pkgver-apng.patch.gz
	libpng15-CVE-2013-6954.patch
	"

_builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	gunzip -c "$srcdir"/libpng-$pkgver-apng.patch.gz | patch -p1 || return 1
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
		|| return 1
	make
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make DESTDIR="$pkgdir" install
	install -Dm644 LICENSE "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE || return 1
	rm -f "$pkgdir"/usr/lib/*.la
}

md5sums="ea24254980fd820964a710e4d2a947c7  libpng-1.5.15.tar.gz
3ae9ea7e4bd201f0b25e25cd6049b094  libpng-1.5.15-apng.patch.gz
8cdbf47318e9f4710a957a4704f1dd6e  libpng15-CVE-2013-6954.patch"
sha256sums="726224b7a6b5ad0032078bf3fb5a84ffb5ad683a33a62d67f7be5eb5bc37d076  libpng-1.5.15.tar.gz
e6c46fafd5fbea6250daa07c1b7be2b9571a7cc4c99e985c594666a33de52f6b  libpng-1.5.15-apng.patch.gz
0c039a6cf4476b239ffc9c9f92ed48aabc9678e30b9c982ab6996dfddf6696f2  libpng15-CVE-2013-6954.patch"
sha512sums="3d4f04bc33150177c9ca46543d92884dd3e6857494b99f7cc171fc90371b345495ae777b11bbed88978ec4a00daab632431b3efa78420b0abb659d5cf5690bc7  libpng-1.5.15.tar.gz
631f4bb60b5e0a09e8fcb794bb240d39beae832a6aca9dab2d382ba2444bb2f7cb5a72dd02976cbe0972371e4a6238aa00b017ac4d8956c5afc0ec8671dcdbd6  libpng-1.5.15-apng.patch.gz
d4b390479cadd7637f71e494709a7628671d61bacf10a522547f53be58acc08088e23867ae05047d7a9f53985c7eca78616f28ecec82e785fd18cde84ed9dd86  libpng15-CVE-2013-6954.patch"
