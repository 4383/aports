# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libxext
pkgver=1.3.1
pkgrel=2
pkgdesc="X11 miscellaneous extensions library"
url="http://xorg.freedesktop.org/"
arch="all"
license="custom"
depends=
depends_dev="xextproto libx11-dev libxau-dev"
makedepends="$depends_dev xproto
	libtool autoconf automake util-macros"
subpackages="$pkgname-dev $pkgname-doc"
source="http://xorg.freedesktop.org/releases/individual/lib/libXext-$pkgver.tar.bz2
	0001-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
	0002-integer-overflow-in-XcupGetReservedColormapEntries-C.patch
	0003-integer-overflow-in-XcupStoreColors-CVE-2013-1982-2-.patch
	0004-several-integer-overflows-in-XdbeGetVisualInfo-CVE-2.patch
	0005-integer-overflow-in-XeviGetVisualInfo-CVE-2013-1982-.patch
	0006-integer-overflow-in-XShapeGetRectangles-CVE-2013-198.patch
	0007-integer-overflow-in-XSyncListSystemCounters-CVE-2013.patch
	"


_builddir="$srcdir"/libXext-$pkgver
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	libtoolize --force && aclocal && autoheader && autoconf \
		&& automake --add-missing
}

build() {
	cd "$srcdir"/libXext-$pkgver
	./configure --prefix=/usr --sysconfdir=/etc
	make
}

package() {
	cd "$srcdir"/libXext-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
}
md5sums="71251a22bc47068d60a95f50ed2ec3cf  libXext-1.3.1.tar.bz2
e8571e1188293644413df6beb332c209  0001-Use-_XEatDataWords-to-avoid-overflow-of-rep.length-b.patch
3ae33cae5c48fa8cfaa2669a2f474377  0002-integer-overflow-in-XcupGetReservedColormapEntries-C.patch
be5437299e95d870d0c2555e994f9e99  0003-integer-overflow-in-XcupStoreColors-CVE-2013-1982-2-.patch
f10d0d95cd02a31b42ebd9c71b098e00  0004-several-integer-overflows-in-XdbeGetVisualInfo-CVE-2.patch
30d0d1e0d7e47444d767101c789129c6  0005-integer-overflow-in-XeviGetVisualInfo-CVE-2013-1982-.patch
0684b2e3ac5875c1642a77ba6194ec81  0006-integer-overflow-in-XShapeGetRectangles-CVE-2013-198.patch
1c60dbeb9032d3823616e7fcf1162c15  0007-integer-overflow-in-XSyncListSystemCounters-CVE-2013.patch"
