# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=haserl
pkgver=0.9.30
pkgrel=0
pkgdesc="Html And Shell Embedded Report Language"
url="http://haserl.sourceforge.net/"
arch="all"
license="GPL-2"
depends=
makedepends="lua5.1-dev automake autoconf"
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
	0001-Modernize-configure.ac-for-newer-autotools.patch
	0002-remove-the-generated-config.h.in.patch
	0003-use-pkg-config-to-find-Lua-CFLAGS-and-LIBS.patch
	0004-fix-compiler-warning-variable-retval-set-but-not-use.patch
	"

_builddir="$srcdir/$pkgname-$pkgver"
prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	sed -i -e 's/^        /\t/' src/Makefile.am || return 1
	rm -f src/haserl_lualib.inc

	aclocal && autoconf && autoheader && automake --add-missing || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--with-lua=lua5.1 \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir/" install
	chmod 4111 "$pkgdir"/usr/bin/haserl
}

md5sums="e25f1a13f7cfe5993e961803446cd718  haserl-0.9.30.tar.gz
70c13f4fcbc856fabd4988cbaa889b0d  0001-Modernize-configure.ac-for-newer-autotools.patch
5d03b8001deb2a3fccd5dec5debb073c  0002-remove-the-generated-config.h.in.patch
11871f1faf9d45d081896aa9ac02713a  0003-use-pkg-config-to-find-Lua-CFLAGS-and-LIBS.patch
3aa1e5ad8f7b9acf436617213798bf87  0004-fix-compiler-warning-variable-retval-set-but-not-use.patch"
sha256sums="01f9f942c58beb8eb6acd7fdbc5fa32e9156a9b8630992def7eb5a48c5f04b50  haserl-0.9.30.tar.gz
50a78f87142554800e680ba3d0b6aec899a0a0ce96309522fc9df04ac247ed73  0001-Modernize-configure.ac-for-newer-autotools.patch
ecc996c7adc877a35960fe09e9b89c86e5c475bc4133ff1df925562eb25d29c3  0002-remove-the-generated-config.h.in.patch
330ade0ae71d32de9db8aca58a8d87e924ba8cd097db352a580e448d5ccd2bbc  0003-use-pkg-config-to-find-Lua-CFLAGS-and-LIBS.patch
9fe2e3320798f635c801a148af85c2638df3a451427ffdc36893558da86c037c  0004-fix-compiler-warning-variable-retval-set-but-not-use.patch"
sha512sums="33b478c5cb5a53e8e696b9db36aaabe5961da3fa9d6199eb198d780ca9de9c1c9588f594a2ffd4ba0dd56c5ed6a1494ef4f67ae73f31bfa24cd6629b53dee806  haserl-0.9.30.tar.gz
00b219aad35513ba915e4b01d6e831738c1e4c3e06385dfd0a49ea3433faf44641bbfb24858e2933ccdc605388621a7ba89f7ca611fa5b28526697b255a8bc2e  0001-Modernize-configure.ac-for-newer-autotools.patch
a7ef9f6bc95c812730ff0067143c7e215f6acced3b30f3e2fc1c7174f730021d856b86350342fb3a7eb851b4d0af9561a00994b5b27949348f586c9989eb4e1d  0002-remove-the-generated-config.h.in.patch
8fa409c9a4d2e9225fcb89281c094e6edd1bd3a1ffe6d743f0c3ae66c33b9960aa4ecd460f9119c095a76a8b1c37da0722a7956a5525cce1b9843ea654195048  0003-use-pkg-config-to-find-Lua-CFLAGS-and-LIBS.patch
5062364c45106d1a3fadf05dcd0a5dc010f7acf0c1bd0914333abd735ac5a8a82c175694208484e5ab146b930dafd969d8245baf2e8f510cb05f57694c14ff58  0004-fix-compiler-warning-variable-retval-set-but-not-use.patch"
